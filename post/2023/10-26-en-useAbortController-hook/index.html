<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" href="../../../favicon.ico" />
		<meta name="viewport" content="width=device-width" />
		
		<link href="../../../_app/immutable/assets/0.6a9fc0ad.css" rel="stylesheet">
		<link rel="modulepreload" href="../../../_app/immutable/entry/start.c83bda82.js">
		<link rel="modulepreload" href="../../../_app/immutable/chunks/scheduler.6402f0dd.js">
		<link rel="modulepreload" href="../../../_app/immutable/chunks/singletons.fc3fa830.js">
		<link rel="modulepreload" href="../../../_app/immutable/chunks/index.1b92e39a.js">
		<link rel="modulepreload" href="../../../_app/immutable/entry/app.3a72c247.js">
		<link rel="modulepreload" href="../../../_app/immutable/chunks/index.0cc09f3a.js">
		<link rel="modulepreload" href="../../../_app/immutable/nodes/0.b539a797.js">
		<link rel="modulepreload" href="../../../_app/immutable/chunks/index.a82faf3f.js">
		<link rel="modulepreload" href="../../../_app/immutable/chunks/GithubMark.5170f17a.js">
		<link rel="modulepreload" href="../../../_app/immutable/chunks/store.be990f37.js">
		<link rel="modulepreload" href="../../../_app/immutable/nodes/5.49219826.js">
		<link rel="modulepreload" href="../../../_app/immutable/chunks/each.e59479a4.js">
		<link rel="modulepreload" href="../../../_app/immutable/chunks/Category.abbf0668.js">
		<link rel="modulepreload" href="../../../_app/immutable/chunks/MainSection.2c05b479.js"><title>useAbortController Hook : dlguswo333&#39;s blog</title><!-- HEAD_svelte-etxm8u_START --><!-- HEAD_svelte-etxm8u_END -->
		<!-- [TODO] For portability I can erase the following elements and inject them from index.ts when building? -->
		<title>dlguswo333's Blog</title>
		<meta name="google-site-verification" content="GIhlBkE7qu5AWLVmQ4w2lBcxEw-AumQhdQf_2zR2X4s" />
	</head>
	<body data-sveltekit-preload-data="hover">
		<script>
			const systemTheme= window.matchMedia('(prefers-color-scheme:dark)').matches ? 'dark' : 'light';
			const rootElement = document.querySelector('body');
			try {
				const storedValue = JSON.parse(localStorage.getItem('color-theme') || 'null');
				const currentTheme = storedValue === 'light' || storedValue === 'dark' ? storedValue : systemTheme;
				if(rootElement) {
  				rootElement.classList.add(currentTheme);
				}
			} catch {
				rootElement.classList.add(systemTheme);
			}
		</script>
		<div id="root">  <header class="p-2 sticky top-0 flex flex-row items-center justify-between border-b border-b-gray-300 bg-gray-50 dark:bg-[#2c3039] dark:border-b-gray-700"><div class="flex flex-row items-center gap-1"> <a href="/" class="inline-block h-8 w-8" data-svelte-h="svelte-htzscq"><span class="hidden">Go To Home</span> <img src="/favicon.svg" alt="Logo"></a> <button type="button" title="Toggle color theme" class="group"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" class="h-8 w-8 transition"><rect x="3" y="3" width="94" height="94" stroke-width="6" rx="16" ry="16" class="stroke-gray-600 fill-none"></rect></svg></button> </div> <div class="flex flex-row items-center"><a href="/categories/" class="h-8 flex items-center justify-center mr-2 last:mr-1 px-1 py-0.5 rounded hover:bg-gray-200 dark:hover:bg-slate-600 dark:hover:text-white">Categories</a> <a href="/tags/" class="h-8 flex items-center justify-center mr-2 last:mr-1 px-1 py-0.5 rounded hover:bg-gray-200 dark:hover:bg-slate-600 dark:hover:text-white">Tags</a> <a href="/about/" class="h-8 flex items-center justify-center mr-2 last:mr-1 px-1 py-0.5 rounded hover:bg-gray-200 dark:hover:bg-slate-600 dark:hover:text-white">About</a></div></header>  <div class="flex flex-row flex-grow justify-center p-2 lg:p-0 lg:pr-[300px]"> <aside class="w-[300px] overflow-hidden hidden mt-10 self-start md:!flex md:sticky md:top-14 flex-col justify-center items-center p-3
  "><div class="relative w-full"><ul class="max-h-[80vh] overflow-auto"> <li title="useEffect with AbortController" class="flex border-l-4 border-transparent hover:border-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 font-bold 
        "><a href="#1-useEffect-with-AbortController" class="relative z-10 py-0.5 whitespace-nowrap overflow-hidden break-all overflow-ellipsis flex-grow" style="padding-left: 0.3rem;">useEffect with AbortController</a> </li> <li title="Custom Hook with AbortController" class="flex border-l-4 border-transparent hover:border-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 font-bold 
        "><a href="#2-Custom-Hook-with-AbortController" class="relative z-10 py-0.5 whitespace-nowrap overflow-hidden break-all overflow-ellipsis flex-grow" style="padding-left: 0.3rem;">Custom Hook with AbortController</a> </li> <li title="Advanced Custom Hook with AbortController" class="flex border-l-4 border-transparent hover:border-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 font-bold 
        "><a href="#3-Advanced-Custom-Hook-with-AbortController" class="relative z-10 py-0.5 whitespace-nowrap overflow-hidden break-all overflow-ellipsis flex-grow" style="padding-left: 0.3rem;">Advanced Custom Hook with AbortController</a> </li> <li title="Return Callback and Abort Function" class="flex border-l-4 border-transparent hover:border-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700  
        "><a href="#4-Return-Callback-and-Abort-Function" class="relative z-10 py-0.5 whitespace-nowrap overflow-hidden break-all overflow-ellipsis flex-grow" style="padding-left: 0.9666666666666666rem;">Return Callback and Abort Function</a> </li> <li title="Manage AbortController with useRef" class="flex border-l-4 border-transparent hover:border-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700  
        "><a href="#5-Manage-AbortController-with-useRef" class="relative z-10 py-0.5 whitespace-nowrap overflow-hidden break-all overflow-ellipsis flex-grow" style="padding-left: 0.9666666666666666rem;">Manage AbortController with useRef</a> </li> <li title="Pass AbortController to Callback as a Parameter" class="flex border-l-4 border-transparent hover:border-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 font-bold 
        "><a href="#6-Pass-AbortController-to-Callback-as-a-Parameter" class="relative z-10 py-0.5 whitespace-nowrap overflow-hidden break-all overflow-ellipsis flex-grow" style="padding-left: 0.3rem;">Pass AbortController to Callback as a Parameter</a> </li> <li title="Pass Other Arguments as Parameters Together" class="flex border-l-4 border-transparent hover:border-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700  
        "><a href="#7-Pass-Other-Arguments-as-Parameters-Together" class="relative z-10 py-0.5 whitespace-nowrap overflow-hidden break-all overflow-ellipsis flex-grow" style="padding-left: 0.9666666666666666rem;">Pass Other Arguments as Parameters Together</a> </li> <li title="Typing with Typescript" class="flex border-l-4 border-transparent hover:border-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700  
        "><a href="#8-Typing-with-Typescript" class="relative z-10 py-0.5 whitespace-nowrap overflow-hidden break-all overflow-ellipsis flex-grow" style="padding-left: 1.6333333333333333rem;">Typing with Typescript</a> </li></ul> </div></aside>  <div class="flex flex-col justify-center min-w-0 my-10 md:my-15"><div class="max-w-[900px] flex flex-col items-center py-6 gap-3"><h1 class="text-4xl font-bold text-center">useAbortController Hook</h1> <span>2023-10-26 </span> <button class="px-2 py-0.5 rounded-lg shadow-md shadow-emerald-50 border-l-slate-100 bg-sky-300 text-white hover:bg-sky-500 dark:shadow-emerald-900 transition">/Programming</button> <div><button class="last:mr-0 bg-green-100 hover:bg-green-400 hover:text-white dark:text-black transition px-2 py-0.5 rounded-xl shadow-md dark:shadow-green-900 my-0.5" style="margin-right: 0.25rem; margin-left: 0.5rem">#web</button><button class="last:mr-0 bg-green-100 hover:bg-green-400 hover:text-white dark:text-black transition px-2 py-0.5 rounded-xl shadow-md dark:shadow-green-900 my-0.5" style="margin-right: 0.25rem; margin-left: 0rem">#react</button><button class="last:mr-0 bg-green-100 hover:bg-green-400 hover:text-white dark:text-black transition px-2 py-0.5 rounded-xl shadow-md dark:shadow-green-900 my-0.5" style="margin-right: 0.25rem; margin-left: 0rem">#javascript</button><button class="last:mr-0 bg-green-100 hover:bg-green-400 hover:text-white dark:text-black transition px-2 py-0.5 rounded-xl shadow-md dark:shadow-green-900 my-0.5" style="margin-right: 0.25rem; margin-left: 0rem">#typescript</button></div> <div>üåê
            <a class="last:mr-0 my-0.5 transition px-2 py-0.5 rounded-md border-2
    bg-lime-100 dark:text-black dark:shadow-green-900
    shadow-md hover:text-white hover:bg-lime-400" href="/post/2023/10-26-ko-useAbortController-hook/" style="margin-right: 0.25rem; margin-left: 0.25rem">ko</a><a class="last:mr-0 my-0.5 transition px-2 py-0.5 rounded-md border-2
    bg-lime-100 dark:text-black dark:shadow-green-900
    border-yellow-300 shadow-inner cursor-default bg-lime-50" href="/post/2023/10-26-en-useAbortController-hook/" style="margin-right: 0.25rem; margin-left: 0.25rem">en</a></div></div> <hr class="bg-gray-400 my-4">  <main class="max-w-[900px] w-full py-2 post"> <!-- HTML_TAG_START --><p>If you are developing a React project and trying to make a fetch request,
you are often said to call your request API inside <code>useEffect</code>.
This is because fetching data is most likely to be closely linked
to lifecycles of your React components.</p>
<blockquote>
<p><strong>Fetching data with Effects</strong><br>
You can use an Effect to fetch data for your component.
...
Writing data fetching directly in Effects gets repetitive and makes it difficult to add optimizations like caching and server rendering later. It‚Äôs easier to use a custom Hook‚Äîeither your own or maintained by the community.<br>
<a href="https://react.dev/reference/react/useEffect#fetching-data-with-effects">https://react.dev/reference/react/useEffect#fetching-data-with-effects</a></p>
</blockquote>
<p>Also, you may add a boolean value or <code>AbortController</code>
to cancel requests you had figured out to be not needed anymore.
This also prevents unwanted data race conditions.</p>
<blockquote>
<p>Note the <code>ignore</code> variable which is initialized to <code>false</code>, and is set to <code>true</code> during cleanup. This ensures your code doesn‚Äôt suffer from ‚Äúrace conditions‚Äù: network responses may arrive in a different order than you sent them.<br>
<a href="https://react.dev/reference/react/useEffect#fetching-data-with-effects">https://react.dev/reference/react/useEffect#fetching-data-with-effects</a></p>
</blockquote>
<p>Although using boolean value is good enough,
An abortController is a better option
since it is able to cancel ongoing fetch requests.</p>
<blockquote>
<p>The abort() method of the AbortController interface aborts a DOM request before it has completed. This is able to abort fetch requests, the consumption of any response bodies, or streams.<br>
<a href="https://developer.mozilla.org/en-US/docs/Web/API/AbortController/abort">https://developer.mozilla.org/en-US/docs/Web/API/AbortController/abort</a></p>
</blockquote>
<p>In this post, we are going to learn about how to use <code>AbortController</code> and extract
common logics and codes into a reusable custom hook in various ways.</p>
<h1 id="1-useEffect-with-AbortController">useEffect with AbortController</h1>
<p>The following codes are examples of
an <code>useEffect</code> that calls a fetch request with <code>AbortController</code>.</p>
<pre class="language-js"><code class="language-js code-highlight"><span class="code-line line-number" line="1"><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="2">  <span class="token keyword">const</span> controller <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AbortController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="3">  <span class="token keyword">const</span> <span class="token function-variable function">search</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="4">    <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword control-flow">await</span> axios<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">'/search'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="5">      <span class="token literal-property property">params</span><span class="token operator">:</span> <span class="token punctuation">{</span>keyword<span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="6">      <span class="token literal-property property">signal</span><span class="token operator">:</span> controller<span class="token punctuation">.</span><span class="token property-access">signal</span>
</span><span class="code-line line-number" line="7">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="8">    <span class="token function">setSearchResult</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="9">  <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="10">  <span class="token function">search</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="11">
</span><span class="code-line line-number" line="12">  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="13">    controller<span class="token punctuation">.</span><span class="token method function property-access">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="14">  <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="15"><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>keyword<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></code></pre>
<p>In this post, we are going to use <code>axios</code> for fetching data.
<code>axios</code> needs you to hand over <code>AbortController.signal</code> as <code>signal</code> key of the second parameter object.
Refer to <a href="https://axios-http.com/docs/cancellation"><code>axios</code> document</a> for more.</p>
<p>Everytime <code>keyword</code> changes, the cleanup function will abort the ongoing fetch request
and throw an error. Due to the error, <code>setSearchResult(result)</code> will not execute.
It is also recommended to wrap the fetch requests to handle <code>AbortError</code> or other unexpected errors.</p>
<blockquote>
<p>When abort() is called, the fetch() promise rejects with a <code>DOMException</code> named <code>AbortError</code>.<br>
<a href="https://developer.mozilla.org/en-US/docs/Web/API/AbortController">https://developer.mozilla.org/en-US/docs/Web/API/AbortController</a></p>
</blockquote>
<pre class="language-js"><code class="language-js code-highlight"><span class="code-line line-number" line="1"><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="2">  <span class="token keyword">const</span> controller <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AbortController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="3">  <span class="token keyword">const</span> <span class="token function-variable function">search</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="4">    <span class="token keyword control-flow">try</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="5">      <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword control-flow">await</span> axios<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">'/search'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="6">        <span class="token literal-property property">params</span><span class="token operator">:</span> <span class="token punctuation">{</span>keyword<span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="7">        <span class="token literal-property property">signal</span><span class="token operator">:</span> controller<span class="token punctuation">.</span><span class="token property-access">signal</span>
</span><span class="code-line line-number" line="8">      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="9">      <span class="token function">setSearchResult</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="10">    <span class="token punctuation">}</span> <span class="token keyword control-flow">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="11">      <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>e <span class="token keyword">instanceof</span> <span class="token class-name">Error</span> <span class="token operator">&#x26;&#x26;</span> e<span class="token punctuation">.</span><span class="token property-access">name</span> <span class="token operator">===</span> <span class="token string">'AbortError'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="12">        <span class="token comment">// Handle AbortError</span>
</span><span class="code-line line-number" line="13">      <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="14">        <span class="token comment">// Handle other errors</span>
</span><span class="code-line line-number" line="15">      <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="16">    <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="17">  <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="18">  <span class="token function">search</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="19">
</span><span class="code-line line-number" line="20">  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="21">    controller<span class="token punctuation">.</span><span class="token method function property-access">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="22">  <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="23"><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>keyword<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></code></pre>
<h1 id="2-Custom-Hook-with-AbortController">Custom Hook with AbortController</h1>
<p>If you want to reuse the code and make it as a custom hook, maybe you can do this:</p>
<pre class="language-js"><code class="language-js code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">const</span> useAbortController <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> params<span class="token punctuation">,</span> onFetchComplete<span class="token punctuation">,</span> onError</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="2">  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="3">    <span class="token keyword">const</span> controller <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AbortController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="4">    <span class="token keyword">const</span> <span class="token function-variable function">search</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="5">      <span class="token keyword control-flow">try</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="6">        <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword control-flow">await</span> axios<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="7">          params<span class="token punctuation">,</span>
</span><span class="code-line line-number" line="8">          <span class="token literal-property property">signal</span><span class="token operator">:</span> controller<span class="token punctuation">.</span><span class="token property-access">signal</span>
</span><span class="code-line line-number" line="9">        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="10">        <span class="token function">onFetchComplete</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="11">      <span class="token punctuation">}</span> <span class="token keyword control-flow">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="12">        <span class="token function">onError</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="13">      <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="14">    <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="15">    <span class="token function">search</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="16">
</span><span class="code-line line-number" line="17">    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="18">      controller<span class="token punctuation">.</span><span class="token method function property-access">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="19">    <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="20">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="21"><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>url<span class="token punctuation">,</span> params<span class="token punctuation">,</span> onFetchComplete<span class="token punctuation">,</span> onError<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></code></pre>
<p>And call the hook like this:</p>
<pre class="language-js"><code class="language-js code-highlight"><span class="code-line line-number" line="1"><span class="token function">useAbortController</span><span class="token punctuation">(</span><span class="token string">'/search'</span><span class="token punctuation">,</span> params<span class="token punctuation">,</span> setSearchResult<span class="token punctuation">,</span> onError<span class="token punctuation">)</span>
</span></code></pre>
<p>Be aware if you cannot gurantee the stabilities of each argument,
the <code>useEffect</code> will rerun everytime components rerender,
resulting in unnecessary repeated request calls or infinite rerenders in the worst case.</p>
<p>Also, this custom hook has some flaws.</p>
<ul>
<li><strong>You cannot call the <code>search</code> function on your demand</strong><br>
you might need to call the function on other circumstances,
such as on button clicked.
However Since the hook does not expose the request function, you just can't.</li>
<li><strong>You cannot cancel the <code>search</code> function.</strong><br>
Same reason as above.</li>
</ul>
<h1 id="3-Advanced-Custom-Hook-with-AbortController">Advanced Custom Hook with AbortController</h1>
<h2 id="4-Return-Callback-and-Abort-Function">Return Callback and Abort Function</h2>
<p>The custom hook shouldn't call fetch request inside itself;
it should wrap the fetch request with an <code>AbortController</code>
and return it back to the caller, together with an abort function.</p>
<pre class="language-jsx"><code class="language-jsx code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">const</span> <span class="token punctuation">[</span>search<span class="token punctuation">,</span> abortSearch<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useAbortController</span><span class="token punctuation">(</span>
</span><span class="code-line line-number" line="2">  url<span class="token punctuation">,</span>
</span><span class="code-line line-number" line="3">  params<span class="token punctuation">,</span>
</span><span class="code-line line-number" line="4">  setSearchResult<span class="token punctuation">,</span>
</span><span class="code-line line-number" line="5">  onError<span class="token punctuation">,</span>
</span><span class="code-line line-number" line="6"><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="7">
</span><span class="code-line line-number" line="8"><span class="token comment">// Use it like this:</span>
</span><span class="code-line line-number" line="9"><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>search<span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">Search</span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>button</span><span class="token punctuation">></span></span>
</span><span class="code-line line-number" line="10"><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>abortSearch<span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">Abort Search</span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>button</span><span class="token punctuation">></span></span>
</span></code></pre>
<p>The custom hook should create two functions with <code>useCallback</code>.
Also, <code>AbortController</code> instances should be shared between the two functions
with a help from <code>useState</code>.</p>
<pre class="language-js"><code class="language-js code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">const</span> useAbortController <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> params<span class="token punctuation">,</span> onFetchComplete<span class="token punctuation">,</span> onError</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="2">  <span class="token keyword">const</span> <span class="token punctuation">[</span>controller<span class="token punctuation">,</span> setController<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">AbortController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="3">
</span><span class="code-line line-number" line="4">  <span class="token keyword">const</span> request <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="5">    <span class="token keyword control-flow">try</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="6">      <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword control-flow">await</span> axios<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="7">        params<span class="token punctuation">,</span>
</span><span class="code-line line-number" line="8">        <span class="token literal-property property">signal</span><span class="token operator">:</span> controller<span class="token punctuation">.</span><span class="token property-access">signal</span>
</span><span class="code-line line-number" line="9">      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="10">      <span class="token function">onFetchComplete</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="11">    <span class="token punctuation">}</span> <span class="token keyword control-flow">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="12">      <span class="token function">onError</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="13">    <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="14">  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>controller<span class="token punctuation">,</span> url<span class="token punctuation">,</span> params<span class="token punctuation">,</span> onFetchComplete<span class="token punctuation">,</span> onError<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="15">
</span><span class="code-line line-number" line="16">  <span class="token keyword">const</span> abortRequest <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="17">    controller<span class="token punctuation">.</span><span class="token method function property-access">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="18">    <span class="token comment">// Create a new AbortController,</span>
</span><span class="code-line line-number" line="19">    <span class="token comment">// since you cannot use same AbortController more than once.</span>
</span><span class="code-line line-number" line="20">    <span class="token function">setController</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">AbortController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="21">  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>controller<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="22">
</span><span class="code-line line-number" line="23">  <span class="token keyword control-flow">return</span> <span class="token punctuation">[</span>callback<span class="token punctuation">,</span> abort<span class="token punctuation">]</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="24"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></code></pre>
<p>However, there is a flaw in the hook;
the <code>AbortController</code> is managed as a <strong>state</strong>.
You cannot reuse the same controller once you called <code>AbortController.abort()</code>.
t means you need to create new one after calling <code>AbortController.abort()</code>.
Thus the two functions should depend on <code>controller</code> state to get the latest <code>AbortController</code>.
This dependency presents us a problem; unnecessary rerenders.</p>
<ol>
<li>Call <code>abortRequest()</code> callback.</li>
<li><code>controller</code> state renews.</li>
<li><code>request</code> and <code>abortRequest</code> callbacks renews.</li>
<li>Components which call the hook rerender, also do their children.</li>
</ol>
<p>Futhermore, we may have a problem if we call the callback inside <code>useEffect</code>.
The effect should depend on <code>request</code> to use the latest value.
When we abort the callback, the effect reruns whether we like it or not.
Also, calling callback and returning abort cleanup function inside the same <code>useEffect</code>
result in an infinite rerenders.
Since these behaviors are due to the internal logics of this hook,
it should be avoided or it will confuse those who use the hook.</p>
<pre class="language-jsx"><code class="language-jsx code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">const</span> <span class="token punctuation">[</span>search<span class="token punctuation">,</span> abortSearch<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useAbortController</span><span class="token punctuation">(</span>
</span><span class="code-line line-number" line="2">  url<span class="token punctuation">,</span>
</span><span class="code-line line-number" line="3">  params<span class="token punctuation">,</span>
</span><span class="code-line line-number" line="4">  setSearchResult<span class="token punctuation">,</span>
</span><span class="code-line line-number" line="5">  onError<span class="token punctuation">,</span>
</span><span class="code-line line-number" line="6"><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="7">
</span><span class="code-line line-number" line="8"><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="9">  <span class="token function">search</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="10">
</span><span class="code-line line-number" line="11">  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="12">    <span class="token function">abortSearch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="13">  <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="14"><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>search<span class="token punctuation">,</span> abortSearch<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="15">
</span><span class="code-line line-number" line="16"><span class="token comment">// All I want to do is cancel searching,</span>
</span><span class="code-line line-number" line="17"><span class="token comment">// but search API is called when the button is pressed?</span>
</span><span class="code-line line-number" line="18"><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>abortSearch<span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">Cancel search</span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>button</span><span class="token punctuation">></span></span>
</span></code></pre>
<h2 id="5-Manage-AbortController-with-useRef">Manage AbortController with useRef</h2>
<p>Instead of managing <code>AbortController</code> with <code>useState</code>
and suffer from rerenders, we got a better option: <code>useRef</code>.</p>
<pre class="language-js"><code class="language-js code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">const</span> useAbortController <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> params<span class="token punctuation">,</span> onFetchComplete<span class="token punctuation">,</span> onError</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="2">  <span class="token keyword">const</span> controllerRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">AbortController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="3">
</span><span class="code-line line-number" line="4">  <span class="token keyword">const</span> request <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="5">    <span class="token keyword control-flow">try</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="6">      <span class="token keyword">const</span> signal <span class="token operator">=</span> controllerRef<span class="token punctuation">.</span><span class="token property-access">current</span><span class="token punctuation">.</span><span class="token property-access">signal</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="7">      <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword control-flow">await</span> axios<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="8">        params<span class="token punctuation">,</span>
</span><span class="code-line line-number" line="9">        signal
</span><span class="code-line line-number" line="10">      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="11">      onFetchComplete<span class="token operator">?.</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="12">    <span class="token punctuation">}</span> <span class="token keyword control-flow">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="13">      onError<span class="token operator">?.</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="14">    <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="15">  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>url<span class="token punctuation">,</span> params<span class="token punctuation">,</span> onFetchComplete<span class="token punctuation">,</span> onError<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="16">
</span><span class="code-line line-number" line="17">  <span class="token keyword">const</span> abortRequest <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="18">    controllerRef<span class="token punctuation">.</span><span class="token property-access">current</span><span class="token punctuation">.</span><span class="token method function property-access">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="19">    controllerRef<span class="token punctuation">.</span><span class="token property-access">current</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AbortController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="20">  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="21">
</span><span class="code-line line-number" line="22">  <span class="token keyword control-flow">return</span> <span class="token punctuation">[</span>callback<span class="token punctuation">,</span> abort<span class="token punctuation">]</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="23"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></code></pre>
<p>Now the hook does not incur any rerender or make you suffer from rerender.
<strong>Note</strong> that the <code>signal</code> variable is created and used
inside <code>request</code> callback.
<code>abort</code> function reassigns <code>controllerRef.current</code>,
which means <code>controllerRef.current</code> referred by <code>fetch</code>
might not be the <code>AbortController</code> instance you want.
It could be a new <code>AbortController</code>,
then <code>fetch</code> may run even though you called <code>abortRequest</code>.
Thus, we need to store <code>controllerRef.current</code> some place else
before we make a <code>fetch</code> call.</p>
<h1 id="6-Pass-AbortController-to-Callback-as-a-Parameter">Pass AbortController to Callback as a Parameter</h1>
<p>To further increase flexibility, we may come up with an idea
where <code>useAbortController</code> receives a callback, not an url.
This lets you pass single parameter only,
since you are now able to control <code>url</code>, <code>params</code>, <code>onFetchComplete</code>, <code>onError</code>
inside the callback, freely.</p>
<pre class="language-js"><code class="language-js code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">const</span> searchWithAbortController <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span>
</span><span class="code-line line-number" line="2">  <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">abortController</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="3">    <span class="token keyword control-flow">try</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="4">      <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword control-flow">await</span> axios<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">'/search'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="5">        <span class="token literal-property property">signal</span><span class="token operator">:</span> abortController<span class="token punctuation">.</span><span class="token property-access">signal</span>
</span><span class="code-line line-number" line="6">      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="7">      <span class="token comment">// Handle result</span>
</span><span class="code-line line-number" line="8">    <span class="token punctuation">}</span> <span class="token keyword control-flow">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="9">      <span class="token comment">// Handle errors</span>
</span><span class="code-line line-number" line="10">    <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="11">  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="12">
</span><span class="code-line line-number" line="13"><span class="token keyword">const</span> <span class="token punctuation">[</span>search<span class="token punctuation">,</span> abortSearch<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useAbortController</span><span class="token punctuation">(</span>searchWithAbortController<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></code></pre>
<p>We can do that easily with the following code.
This hook's role is to wrap a callback with an <code>AbortController</code> and that is all.
The code got much simpler because we let callers control responses and errors.
However callers' code may get complicated to handle those.
It has pros and cons.</p>
<pre class="language-js"><code class="language-js code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">const</span> useAbortController <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">cb</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="2">  <span class="token keyword">const</span> controllerRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">AbortController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="3">
</span><span class="code-line line-number" line="4">  <span class="token keyword">const</span> callback <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="5">    <span class="token keyword">const</span> controller <span class="token operator">=</span> controllerRef<span class="token punctuation">.</span><span class="token property-access">current</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="6">    <span class="token keyword control-flow">return</span> <span class="token function">cb</span><span class="token punctuation">(</span>controller<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="7">  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>cb<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="8">
</span><span class="code-line line-number" line="9">  <span class="token keyword">const</span> abort <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="10">    controllerRef<span class="token punctuation">.</span><span class="token property-access">current</span><span class="token punctuation">.</span><span class="token method function property-access">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="11">    controllerRef<span class="token punctuation">.</span><span class="token property-access">current</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AbortController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="12">  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="13">
</span><span class="code-line line-number" line="14">  <span class="token keyword control-flow">return</span> <span class="token punctuation">[</span>callback<span class="token punctuation">,</span> abort<span class="token punctuation">]</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="15"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></code></pre>
<h2 id="7-Pass-Other-Arguments-as-Parameters-Together">Pass Other Arguments as Parameters Together</h2>
<p>To keep things go further, we can pass
callback's arguments as parameters, not just <code>AbortController</code>.</p>
<pre class="language-js"><code class="language-js code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">const</span> useAbortController <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">cb</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="2">  <span class="token keyword">const</span> controllerRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">AbortController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="3">
</span><span class="code-line line-number" line="4">  <span class="token keyword">const</span> callback <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token spread operator">...</span>args</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="5">    <span class="token keyword">const</span> controller <span class="token operator">=</span> controllerRef<span class="token punctuation">.</span><span class="token property-access">current</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="6">    <span class="token keyword control-flow">return</span> <span class="token function">cb</span><span class="token punctuation">(</span>controller<span class="token punctuation">,</span> <span class="token spread operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="7">  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>cb<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="8">
</span><span class="code-line line-number" line="9">  <span class="token keyword">const</span> abort <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="10">    controllerRef<span class="token punctuation">.</span><span class="token property-access">current</span><span class="token punctuation">.</span><span class="token method function property-access">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="11">    controllerRef<span class="token punctuation">.</span><span class="token property-access">current</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AbortController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="12">  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="13">
</span><span class="code-line line-number" line="14">  <span class="token keyword control-flow">return</span> <span class="token punctuation">[</span>callback<span class="token punctuation">,</span> abort<span class="token punctuation">]</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="15"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></code></pre>
<p>This is quite useful pattern since we can call
the callback function just like before it was wrapped with <code>useAbortController</code>.</p>
<pre class="language-js"><code class="language-js code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">const</span> searchWithAbortController <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span>
</span><span class="code-line line-number" line="2">  <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">abortController<span class="token punctuation">,</span> keyword</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="3">    <span class="token keyword control-flow">try</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="4">      <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword control-flow">await</span> axios<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">'/search'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="5">        <span class="token literal-property property">params</span><span class="token operator">:</span> <span class="token punctuation">{</span>keyword<span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="6">        <span class="token literal-property property">signal</span><span class="token operator">:</span> abortController<span class="token punctuation">.</span><span class="token property-access">signal</span>
</span><span class="code-line line-number" line="7">      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="8">      <span class="token comment">// Handle result</span>
</span><span class="code-line line-number" line="9">    <span class="token punctuation">}</span> <span class="token keyword control-flow">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="10">      <span class="token comment">// Handle errors</span>
</span><span class="code-line line-number" line="11">    <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="12">  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="13">
</span><span class="code-line line-number" line="14"><span class="token keyword">const</span> <span class="token punctuation">[</span>search<span class="token punctuation">,</span> abortSearch<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useAbortController</span><span class="token punctuation">(</span>searchWithAbortController<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="15">
</span><span class="code-line line-number" line="16"><span class="token comment">// Like this. No need to care AbortController, just your arguments.</span>
</span><span class="code-line line-number" line="17"><span class="token function">search</span><span class="token punctuation">(</span><span class="token string">'keyword'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></code></pre>
<p>If you want <code>AbortController</code> to be the last parameter, simple send it to the last.</p>
<pre class="language-js"><code class="language-js code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">const</span> useAbortController <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">cb</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="2">  <span class="token keyword">const</span> controllerRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">AbortController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="3">
</span><span class="code-line line-number" line="4">  <span class="token keyword">const</span> callback <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token spread operator">...</span>args</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="5">    <span class="token keyword">const</span> controller <span class="token operator">=</span> controllerRef<span class="token punctuation">.</span><span class="token property-access">current</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="6">    <span class="token keyword control-flow">return</span> <span class="token function">cb</span><span class="token punctuation">(</span><span class="token spread operator">...</span>args<span class="token punctuation">,</span> controller<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="7">  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>cb<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="8">
</span><span class="code-line line-number" line="9">  <span class="token keyword">const</span> abort <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="10">    controllerRef<span class="token punctuation">.</span><span class="token property-access">current</span><span class="token punctuation">.</span><span class="token method function property-access">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="11">    controllerRef<span class="token punctuation">.</span><span class="token property-access">current</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AbortController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="12">  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="13">
</span><span class="code-line line-number" line="14">  <span class="token keyword control-flow">return</span> <span class="token punctuation">[</span>callback<span class="token punctuation">,</span> abort<span class="token punctuation">]</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="15"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="16">
</span><span class="code-line line-number" line="17"><span class="token keyword">const</span> searchWithAbortController <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span>
</span><span class="code-line line-number" line="18">  <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">keyword<span class="token punctuation">,</span> abortController</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="19">    <span class="token keyword control-flow">try</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="20">      <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword control-flow">await</span> axios<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">'/search'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="21">        <span class="token literal-property property">params</span><span class="token operator">:</span> <span class="token punctuation">{</span>keyword<span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="22">        <span class="token literal-property property">signal</span><span class="token operator">:</span> abortController<span class="token punctuation">.</span><span class="token property-access">signal</span>
</span><span class="code-line line-number" line="23">      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="24">      <span class="token comment">// Handle result</span>
</span><span class="code-line line-number" line="25">    <span class="token punctuation">}</span> <span class="token keyword control-flow">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="26">      <span class="token comment">// Handle errors</span>
</span><span class="code-line line-number" line="27">    <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="28">  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></code></pre>
<h3 id="8-Typing-with-Typescript">Typing with Typescript</h3>
<p>Now let us see how to type the hook with Typescript.
Keeping types is vital for developer experience when you curry functions.
Types will be lost if you do not take a good care of it in curry functions.
See the following Typescript code.
It works but every type is written as <code>unknown</code>.
We need more than this.</p>
<pre class="language-ts"><code class="language-ts code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">const</span> <span class="token function-variable function">useAbortController</span> <span class="token operator">=</span> <span class="token punctuation">(</span>
</span><span class="code-line line-number" line="2">  <span class="token function-variable function">cb</span><span class="token operator">:</span> <span class="token punctuation">(</span>controller<span class="token operator">:</span> AbortController<span class="token punctuation">,</span> <span class="token operator">...</span>args<span class="token operator">:</span> <span class="token builtin">unknown</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token builtin">unknown</span>
</span><span class="code-line line-number" line="3"><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="4">  <span class="token keyword">const</span> controllerRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">AbortController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="5">
</span><span class="code-line line-number" line="6">  <span class="token keyword">const</span> callback <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">...</span>cbArgs<span class="token operator">:</span> <span class="token builtin">unknown</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="7">    <span class="token keyword">const</span> controller <span class="token operator">=</span> controllerRef<span class="token punctuation">.</span>current<span class="token punctuation">;</span>
</span><span class="code-line line-number" line="8">    <span class="token keyword">return</span> <span class="token function">cb</span><span class="token punctuation">(</span>controller<span class="token punctuation">,</span> <span class="token operator">...</span>cbArgs<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="9">  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>cb<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="10">
</span><span class="code-line line-number" line="11">  <span class="token keyword">const</span> abort <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="12">    controllerRef<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="13">    controllerRef<span class="token punctuation">.</span>current <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AbortController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="14">  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="15">
</span><span class="code-line line-number" line="16">  <span class="token keyword">return</span> <span class="token punctuation">[</span>callback<span class="token punctuation">,</span> abort<span class="token punctuation">]</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="17"><span class="token punctuation">}</span><span class="token punctuation">;</span>
</span></code></pre>
<p>What we need is <em>generics</em>. By adding generic types to the hook,
the resultant functions automatically infer concrete types.</p>
<pre class="language-ts"><code class="language-ts code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">const</span> useAbortController <span class="token operator">=</span> <span class="token operator">&#x3C;</span>Args <span class="token keyword">extends</span> <span class="token class-name"><span class="token builtin">unknown</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> Ret<span class="token operator">></span>
</span><span class="code-line line-number" line="2">  <span class="token punctuation">(</span>
</span><span class="code-line line-number" line="3">    <span class="token function-variable function">cb</span><span class="token operator">:</span> <span class="token punctuation">(</span>controller<span class="token operator">:</span> AbortController<span class="token punctuation">,</span> <span class="token operator">...</span>args<span class="token operator">:</span> Args<span class="token punctuation">)</span> <span class="token operator">=></span> Ret
</span><span class="code-line line-number" line="4">  <span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="5">  <span class="token keyword">const</span> controllerRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">AbortController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="6">
</span><span class="code-line line-number" line="7">  <span class="token keyword">const</span> callback <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">...</span>cbArgs<span class="token operator">:</span> Args<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="8">    <span class="token keyword">const</span> controller <span class="token operator">=</span> controllerRef<span class="token punctuation">.</span>current<span class="token punctuation">;</span>
</span><span class="code-line line-number" line="9">    <span class="token keyword">return</span> <span class="token function">cb</span><span class="token punctuation">(</span>controller<span class="token punctuation">,</span> <span class="token operator">...</span>cbArgs<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="10">  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>cb<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="11">
</span><span class="code-line line-number" line="12">  <span class="token keyword">const</span> abort <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="13">    controllerRef<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="14">    controllerRef<span class="token punctuation">.</span>current <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AbortController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="15">  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="16">
</span><span class="code-line line-number" line="17">  <span class="token keyword">return</span> <span class="token punctuation">[</span>callback<span class="token punctuation">,</span> abort<span class="token punctuation">]</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="18"><span class="token punctuation">}</span><span class="token punctuation">;</span>
</span></code></pre>
<p>Now exported callbacks have specifically typed parameters
but themselves with ambiguous typings.
This is because we did not specify <code>useAbortController</code> return type.</p>
<p><img src="/img/2023-10-26-en-useAbortController-hook/useAbortController-typescript-1.png" alt="useAbortController-typescript-wrong-types"></p>
<p><img src="/img/2023-10-26-en-useAbortController-hook/useAbortController-typescript-2.png" alt="useAbortController-typescript-wrong-types"></p>
<p>We can solve this by explicitly typing it:</p>
<pre class="language-ts"><code class="language-ts code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">const</span> useAbortController <span class="token operator">=</span> <span class="token operator">&#x3C;</span>Args <span class="token keyword">extends</span> <span class="token class-name"><span class="token builtin">unknown</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> Ret<span class="token operator">></span>
</span><span class="code-line line-number" line="2">  <span class="token punctuation">(</span>
</span><span class="code-line line-number" line="3">    <span class="token function-variable function">cb</span><span class="token operator">:</span> <span class="token punctuation">(</span>controller<span class="token operator">:</span> AbortController<span class="token punctuation">,</span> <span class="token operator">...</span>args<span class="token operator">:</span> Args<span class="token punctuation">)</span> <span class="token operator">=></span> Ret
</span><span class="code-line line-number" line="4">  <span class="token punctuation">)</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function-variable function">callback</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token operator">:</span> Args<span class="token punctuation">)</span> <span class="token operator">=></span> Ret<span class="token punctuation">,</span> <span class="token function-variable function">abortCallback</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">void</span><span class="token punctuation">]</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
</span></code></pre>
<p>Or you can return the callback array <code>as const</code>.</p>
<pre class="language-ts"><code class="language-ts code-highlight"><span class="code-line line-number" line="1">  <span class="token keyword">return</span> <span class="token punctuation">[</span>callback<span class="token punctuation">,</span> abort<span class="token punctuation">]</span> <span class="token keyword">as</span> <span class="token keyword">const</span><span class="token punctuation">;</span>
</span></code></pre>
<p>Now the callbacks have correct typings :)</p>
<p>If you want <code>AbortController</code> to be the last parameter
in your Typescript code, it is a little tricky write,
but it is absolutely possible.</p>
<pre class="language-ts"><code class="language-ts code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">type</span> <span class="token class-name">ArgsWithController<span class="token operator">&#x3C;</span><span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token builtin">unknown</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token constant">T</span><span class="token punctuation">,</span> AbortController<span class="token punctuation">]</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="2">
</span><span class="code-line line-number" line="3"><span class="token keyword">const</span> useAbortController <span class="token operator">=</span> <span class="token operator">&#x3C;</span>Args <span class="token keyword">extends</span> <span class="token class-name"><span class="token builtin">unknown</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> Ret<span class="token operator">></span>
</span><span class="code-line line-number" line="4">  <span class="token punctuation">(</span>
</span><span class="code-line line-number" line="5">    <span class="token function-variable function">cb</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token operator">:</span> ArgsWithController<span class="token operator">&#x3C;</span>Args<span class="token operator">></span><span class="token punctuation">)</span> <span class="token operator">=></span> Ret
</span><span class="code-line line-number" line="6">  <span class="token punctuation">)</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function-variable function">callback</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token operator">:</span> Args<span class="token punctuation">)</span> <span class="token operator">=></span> Ret<span class="token punctuation">,</span> <span class="token function-variable function">abortCallback</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">void</span><span class="token punctuation">]</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="7">  <span class="token keyword">const</span> controllerRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">AbortController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="8">
</span><span class="code-line line-number" line="9">  <span class="token keyword">const</span> callback <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">...</span>cbArgs<span class="token operator">:</span> Args<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="10">    <span class="token keyword">const</span> controller <span class="token operator">=</span> controllerRef<span class="token punctuation">.</span>current<span class="token punctuation">;</span>
</span><span class="code-line line-number" line="11">    <span class="token keyword">return</span> <span class="token function">cb</span><span class="token punctuation">(</span><span class="token operator">...</span>cbArgs<span class="token punctuation">,</span> controller<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="12">  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>cb<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="13">
</span><span class="code-line line-number" line="14">  <span class="token keyword">const</span> abort <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="15">    controllerRef<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="16">    controllerRef<span class="token punctuation">.</span>current <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AbortController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="17">  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="18">
</span><span class="code-line line-number" line="19">  <span class="token keyword">return</span> <span class="token punctuation">[</span>callback<span class="token punctuation">,</span> abort<span class="token punctuation">]</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="20"><span class="token punctuation">}</span><span class="token punctuation">;</span>
</span></code></pre>
<p>I want to point out that Typescript exists to help you.
If you do not reuse the same logics or do not find it useful,
you are 100% fine not to use Typescript.
But once you write Typescript code that have concrete typings,
it will save you for many times.</p><!-- HTML_TAG_END --></main></div></div> <footer class="p-2 py-5 text-sm flex gap-1 flex-col md:flex-row items-center justify-between border-t border-gray-300 bg-gray-50 dark:border-gray-700 dark:bg-[#2c3039]"><div>¬©Ô∏è 2021~2023 dlguswo333; All rights reserved.</div> <div class="flex items-center"><a class="inline-flex items-center" href="https://github.com/dlguswo333/dlguswo333.github.io"><img class="inline h-4 w-4 mr-1" src="/github-mark.svg" alt="github-mark"></a>
    Built with Sveltekit.</div></footer>  
			
			<script>
				{
					__sveltekit_1n8x98b = {
						base: new URL("../../..", location).pathname.slice(0, -1),
						env: {}
					};

					const element = document.currentScript.parentElement;

					const data = [null,{"type":"data","data":{html:"\u003Cp>If you are developing a React project and trying to make a fetch request,\nyou are often said to call your request API inside \u003Ccode>useEffect\u003C/code>.\nThis is because fetching data is most likely to be closely linked\nto lifecycles of your React components.\u003C/p>\n\u003Cblockquote>\n\u003Cp>\u003Cstrong>Fetching data with Effects\u003C/strong>\u003Cbr>\nYou can use an Effect to fetch data for your component.\n...\nWriting data fetching directly in Effects gets repetitive and makes it difficult to add optimizations like caching and server rendering later. It‚Äôs easier to use a custom Hook‚Äîeither your own or maintained by the community.\u003Cbr>\n\u003Ca href=\"https://react.dev/reference/react/useEffect#fetching-data-with-effects\">https://react.dev/reference/react/useEffect#fetching-data-with-effects\u003C/a>\u003C/p>\n\u003C/blockquote>\n\u003Cp>Also, you may add a boolean value or \u003Ccode>AbortController\u003C/code>\nto cancel requests you had figured out to be not needed anymore.\nThis also prevents unwanted data race conditions.\u003C/p>\n\u003Cblockquote>\n\u003Cp>Note the \u003Ccode>ignore\u003C/code> variable which is initialized to \u003Ccode>false\u003C/code>, and is set to \u003Ccode>true\u003C/code> during cleanup. This ensures your code doesn‚Äôt suffer from ‚Äúrace conditions‚Äù: network responses may arrive in a different order than you sent them.\u003Cbr>\n\u003Ca href=\"https://react.dev/reference/react/useEffect#fetching-data-with-effects\">https://react.dev/reference/react/useEffect#fetching-data-with-effects\u003C/a>\u003C/p>\n\u003C/blockquote>\n\u003Cp>Although using boolean value is good enough,\nAn abortController is a better option\nsince it is able to cancel ongoing fetch requests.\u003C/p>\n\u003Cblockquote>\n\u003Cp>The abort() method of the AbortController interface aborts a DOM request before it has completed. This is able to abort fetch requests, the consumption of any response bodies, or streams.\u003Cbr>\n\u003Ca href=\"https://developer.mozilla.org/en-US/docs/Web/API/AbortController/abort\">https://developer.mozilla.org/en-US/docs/Web/API/AbortController/abort\u003C/a>\u003C/p>\n\u003C/blockquote>\n\u003Cp>In this post, we are going to learn about how to use \u003Ccode>AbortController\u003C/code> and extract\ncommon logics and codes into a reusable custom hook in various ways.\u003C/p>\n\u003Ch1 id=\"1-useEffect-with-AbortController\">useEffect with AbortController\u003C/h1>\n\u003Cp>The following codes are examples of\nan \u003Ccode>useEffect\u003C/code> that calls a fetch request with \u003Ccode>AbortController\u003C/code>.\u003C/p>\n\u003Cpre class=\"language-js\">\u003Ccode class=\"language-js code-highlight\">\u003Cspan class=\"code-line line-number\" line=\"1\">\u003Cspan class=\"token function\">useEffect\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token arrow operator\">=>\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"2\">  \u003Cspan class=\"token keyword\">const\u003C/span> controller \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token keyword\">new\u003C/span> \u003Cspan class=\"token class-name\">AbortController\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"3\">  \u003Cspan class=\"token keyword\">const\u003C/span> \u003Cspan class=\"token function-variable function\">search\u003C/span> \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token keyword\">async\u003C/span> \u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token arrow operator\">=>\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"4\">    \u003Cspan class=\"token keyword\">const\u003C/span> result \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token keyword control-flow\">await\u003C/span> axios\u003Cspan class=\"token punctuation\">.\u003C/span>\u003Cspan class=\"token method function property-access\">get\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token string\">'/search'\u003C/span>\u003Cspan class=\"token punctuation\">,\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"5\">      \u003Cspan class=\"token literal-property property\">params\u003C/span>\u003Cspan class=\"token operator\">:\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>keyword\u003Cspan class=\"token punctuation\">}\u003C/span>\u003Cspan class=\"token punctuation\">,\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"6\">      \u003Cspan class=\"token literal-property property\">signal\u003C/span>\u003Cspan class=\"token operator\">:\u003C/span> controller\u003Cspan class=\"token punctuation\">.\u003C/span>\u003Cspan class=\"token property-access\">signal\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"7\">    \u003Cspan class=\"token punctuation\">}\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"8\">    \u003Cspan class=\"token function\">setSearchResult\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>result\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"9\">  \u003Cspan class=\"token punctuation\">}\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"10\">  \u003Cspan class=\"token function\">search\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"11\">\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"12\">  \u003Cspan class=\"token keyword control-flow\">return\u003C/span> \u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token arrow operator\">=>\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"13\">    controller\u003Cspan class=\"token punctuation\">.\u003C/span>\u003Cspan class=\"token method function property-access\">abort\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"14\">  \u003Cspan class=\"token punctuation\">}\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"15\">\u003Cspan class=\"token punctuation\">}\u003C/span>\u003Cspan class=\"token punctuation\">,\u003C/span> \u003Cspan class=\"token punctuation\">[\u003C/span>keyword\u003Cspan class=\"token punctuation\">]\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>In this post, we are going to use \u003Ccode>axios\u003C/code> for fetching data.\n\u003Ccode>axios\u003C/code> needs you to hand over \u003Ccode>AbortController.signal\u003C/code> as \u003Ccode>signal\u003C/code> key of the second parameter object.\nRefer to \u003Ca href=\"https://axios-http.com/docs/cancellation\">\u003Ccode>axios\u003C/code> document\u003C/a> for more.\u003C/p>\n\u003Cp>Everytime \u003Ccode>keyword\u003C/code> changes, the cleanup function will abort the ongoing fetch request\nand throw an error. Due to the error, \u003Ccode>setSearchResult(result)\u003C/code> will not execute.\nIt is also recommended to wrap the fetch requests to handle \u003Ccode>AbortError\u003C/code> or other unexpected errors.\u003C/p>\n\u003Cblockquote>\n\u003Cp>When abort() is called, the fetch() promise rejects with a \u003Ccode>DOMException\u003C/code> named \u003Ccode>AbortError\u003C/code>.\u003Cbr>\n\u003Ca href=\"https://developer.mozilla.org/en-US/docs/Web/API/AbortController\">https://developer.mozilla.org/en-US/docs/Web/API/AbortController\u003C/a>\u003C/p>\n\u003C/blockquote>\n\u003Cpre class=\"language-js\">\u003Ccode class=\"language-js code-highlight\">\u003Cspan class=\"code-line line-number\" line=\"1\">\u003Cspan class=\"token function\">useEffect\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token arrow operator\">=>\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"2\">  \u003Cspan class=\"token keyword\">const\u003C/span> controller \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token keyword\">new\u003C/span> \u003Cspan class=\"token class-name\">AbortController\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"3\">  \u003Cspan class=\"token keyword\">const\u003C/span> \u003Cspan class=\"token function-variable function\">search\u003C/span> \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token keyword\">async\u003C/span> \u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token arrow operator\">=>\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"4\">    \u003Cspan class=\"token keyword control-flow\">try\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"5\">      \u003Cspan class=\"token keyword\">const\u003C/span> result \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token keyword control-flow\">await\u003C/span> axios\u003Cspan class=\"token punctuation\">.\u003C/span>\u003Cspan class=\"token method function property-access\">get\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token string\">'/search'\u003C/span>\u003Cspan class=\"token punctuation\">,\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"6\">        \u003Cspan class=\"token literal-property property\">params\u003C/span>\u003Cspan class=\"token operator\">:\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>keyword\u003Cspan class=\"token punctuation\">}\u003C/span>\u003Cspan class=\"token punctuation\">,\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"7\">        \u003Cspan class=\"token literal-property property\">signal\u003C/span>\u003Cspan class=\"token operator\">:\u003C/span> controller\u003Cspan class=\"token punctuation\">.\u003C/span>\u003Cspan class=\"token property-access\">signal\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"8\">      \u003Cspan class=\"token punctuation\">}\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"9\">      \u003Cspan class=\"token function\">setSearchResult\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>result\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"10\">    \u003Cspan class=\"token punctuation\">}\u003C/span> \u003Cspan class=\"token keyword control-flow\">catch\u003C/span> \u003Cspan class=\"token punctuation\">(\u003C/span>e\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"11\">      \u003Cspan class=\"token keyword control-flow\">if\u003C/span> \u003Cspan class=\"token punctuation\">(\u003C/span>e \u003Cspan class=\"token keyword\">instanceof\u003C/span> \u003Cspan class=\"token class-name\">Error\u003C/span> \u003Cspan class=\"token operator\">&#x26;&#x26;\u003C/span> e\u003Cspan class=\"token punctuation\">.\u003C/span>\u003Cspan class=\"token property-access\">name\u003C/span> \u003Cspan class=\"token operator\">===\u003C/span> \u003Cspan class=\"token string\">'AbortError'\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"12\">        \u003Cspan class=\"token comment\">// Handle AbortError\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"13\">      \u003Cspan class=\"token punctuation\">}\u003C/span> \u003Cspan class=\"token keyword control-flow\">else\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"14\">        \u003Cspan class=\"token comment\">// Handle other errors\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"15\">      \u003Cspan class=\"token punctuation\">}\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"16\">    \u003Cspan class=\"token punctuation\">}\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"17\">  \u003Cspan class=\"token punctuation\">}\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"18\">  \u003Cspan class=\"token function\">search\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"19\">\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"20\">  \u003Cspan class=\"token keyword control-flow\">return\u003C/span> \u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token arrow operator\">=>\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"21\">    controller\u003Cspan class=\"token punctuation\">.\u003C/span>\u003Cspan class=\"token method function property-access\">abort\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"22\">  \u003Cspan class=\"token punctuation\">}\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"23\">\u003Cspan class=\"token punctuation\">}\u003C/span>\u003Cspan class=\"token punctuation\">,\u003C/span> \u003Cspan class=\"token punctuation\">[\u003C/span>keyword\u003Cspan class=\"token punctuation\">]\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch1 id=\"2-Custom-Hook-with-AbortController\">Custom Hook with AbortController\u003C/h1>\n\u003Cp>If you want to reuse the code and make it as a custom hook, maybe you can do this:\u003C/p>\n\u003Cpre class=\"language-js\">\u003Ccode class=\"language-js code-highlight\">\u003Cspan class=\"code-line line-number\" line=\"1\">\u003Cspan class=\"token keyword\">const\u003C/span> useAbortController \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token parameter\">url\u003Cspan class=\"token punctuation\">,\u003C/span> params\u003Cspan class=\"token punctuation\">,\u003C/span> onFetchComplete\u003Cspan class=\"token punctuation\">,\u003C/span> onError\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token arrow operator\">=>\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"2\">  \u003Cspan class=\"token function\">useEffect\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token arrow operator\">=>\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"3\">    \u003Cspan class=\"token keyword\">const\u003C/span> controller \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token keyword\">new\u003C/span> \u003Cspan class=\"token class-name\">AbortController\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"4\">    \u003Cspan class=\"token keyword\">const\u003C/span> \u003Cspan class=\"token function-variable function\">search\u003C/span> \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token keyword\">async\u003C/span> \u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token arrow operator\">=>\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"5\">      \u003Cspan class=\"token keyword control-flow\">try\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"6\">        \u003Cspan class=\"token keyword\">const\u003C/span> result \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token keyword control-flow\">await\u003C/span> axios\u003Cspan class=\"token punctuation\">.\u003C/span>\u003Cspan class=\"token method function property-access\">get\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>url\u003Cspan class=\"token punctuation\">,\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"7\">          params\u003Cspan class=\"token punctuation\">,\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"8\">          \u003Cspan class=\"token literal-property property\">signal\u003C/span>\u003Cspan class=\"token operator\">:\u003C/span> controller\u003Cspan class=\"token punctuation\">.\u003C/span>\u003Cspan class=\"token property-access\">signal\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"9\">        \u003Cspan class=\"token punctuation\">}\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"10\">        \u003Cspan class=\"token function\">onFetchComplete\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>result\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"11\">      \u003Cspan class=\"token punctuation\">}\u003C/span> \u003Cspan class=\"token keyword control-flow\">catch\u003C/span> \u003Cspan class=\"token punctuation\">(\u003C/span>e\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"12\">        \u003Cspan class=\"token function\">onError\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>e\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"13\">      \u003Cspan class=\"token punctuation\">}\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"14\">    \u003Cspan class=\"token punctuation\">}\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"15\">    \u003Cspan class=\"token function\">search\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"16\">\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"17\">    \u003Cspan class=\"token keyword control-flow\">return\u003C/span> \u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token arrow operator\">=>\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"18\">      controller\u003Cspan class=\"token punctuation\">.\u003C/span>\u003Cspan class=\"token method function property-access\">abort\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"19\">    \u003Cspan class=\"token punctuation\">}\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"20\">  \u003Cspan class=\"token punctuation\">}\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"21\">\u003Cspan class=\"token punctuation\">}\u003C/span>\u003Cspan class=\"token punctuation\">,\u003C/span> \u003Cspan class=\"token punctuation\">[\u003C/span>url\u003Cspan class=\"token punctuation\">,\u003C/span> params\u003Cspan class=\"token punctuation\">,\u003C/span> onFetchComplete\u003Cspan class=\"token punctuation\">,\u003C/span> onError\u003Cspan class=\"token punctuation\">]\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>And call the hook like this:\u003C/p>\n\u003Cpre class=\"language-js\">\u003Ccode class=\"language-js code-highlight\">\u003Cspan class=\"code-line line-number\" line=\"1\">\u003Cspan class=\"token function\">useAbortController\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token string\">'/search'\u003C/span>\u003Cspan class=\"token punctuation\">,\u003C/span> params\u003Cspan class=\"token punctuation\">,\u003C/span> setSearchResult\u003Cspan class=\"token punctuation\">,\u003C/span> onError\u003Cspan class=\"token punctuation\">)\u003C/span>\n\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>Be aware if you cannot gurantee the stabilities of each argument,\nthe \u003Ccode>useEffect\u003C/code> will rerun everytime components rerender,\nresulting in unnecessary repeated request calls or infinite rerenders in the worst case.\u003C/p>\n\u003Cp>Also, this custom hook has some flaws.\u003C/p>\n\u003Cul>\n\u003Cli>\u003Cstrong>You cannot call the \u003Ccode>search\u003C/code> function on your demand\u003C/strong>\u003Cbr>\nyou might need to call the function on other circumstances,\nsuch as on button clicked.\nHowever Since the hook does not expose the request function, you just can't.\u003C/li>\n\u003Cli>\u003Cstrong>You cannot cancel the \u003Ccode>search\u003C/code> function.\u003C/strong>\u003Cbr>\nSame reason as above.\u003C/li>\n\u003C/ul>\n\u003Ch1 id=\"3-Advanced-Custom-Hook-with-AbortController\">Advanced Custom Hook with AbortController\u003C/h1>\n\u003Ch2 id=\"4-Return-Callback-and-Abort-Function\">Return Callback and Abort Function\u003C/h2>\n\u003Cp>The custom hook shouldn't call fetch request inside itself;\nit should wrap the fetch request with an \u003Ccode>AbortController\u003C/code>\nand return it back to the caller, together with an abort function.\u003C/p>\n\u003Cpre class=\"language-jsx\">\u003Ccode class=\"language-jsx code-highlight\">\u003Cspan class=\"code-line line-number\" line=\"1\">\u003Cspan class=\"token keyword\">const\u003C/span> \u003Cspan class=\"token punctuation\">[\u003C/span>search\u003Cspan class=\"token punctuation\">,\u003C/span> abortSearch\u003Cspan class=\"token punctuation\">]\u003C/span> \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token function\">useAbortController\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"2\">  url\u003Cspan class=\"token punctuation\">,\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"3\">  params\u003Cspan class=\"token punctuation\">,\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"4\">  setSearchResult\u003Cspan class=\"token punctuation\">,\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"5\">  onError\u003Cspan class=\"token punctuation\">,\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"6\">\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"7\">\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"8\">\u003Cspan class=\"token comment\">// Use it like this:\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"9\">\u003Cspan class=\"token tag\">\u003Cspan class=\"token tag\">\u003Cspan class=\"token punctuation\">&#x3C;\u003C/span>button\u003C/span> \u003Cspan class=\"token attr-name\">onClick\u003C/span>\u003Cspan class=\"token script language-javascript\">\u003Cspan class=\"token script-punctuation punctuation\">=\u003C/span>\u003Cspan class=\"token punctuation\">{\u003C/span>search\u003Cspan class=\"token punctuation\">}\u003C/span>\u003C/span>\u003Cspan class=\"token punctuation\">>\u003C/span>\u003C/span>\u003Cspan class=\"token plain-text\">Search\u003C/span>\u003Cspan class=\"token tag\">\u003Cspan class=\"token tag\">\u003Cspan class=\"token punctuation\">&#x3C;/\u003C/span>button\u003C/span>\u003Cspan class=\"token punctuation\">>\u003C/span>\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"10\">\u003Cspan class=\"token tag\">\u003Cspan class=\"token tag\">\u003Cspan class=\"token punctuation\">&#x3C;\u003C/span>button\u003C/span> \u003Cspan class=\"token attr-name\">onClick\u003C/span>\u003Cspan class=\"token script language-javascript\">\u003Cspan class=\"token script-punctuation punctuation\">=\u003C/span>\u003Cspan class=\"token punctuation\">{\u003C/span>abortSearch\u003Cspan class=\"token punctuation\">}\u003C/span>\u003C/span>\u003Cspan class=\"token punctuation\">>\u003C/span>\u003C/span>\u003Cspan class=\"token plain-text\">Abort Search\u003C/span>\u003Cspan class=\"token tag\">\u003Cspan class=\"token tag\">\u003Cspan class=\"token punctuation\">&#x3C;/\u003C/span>button\u003C/span>\u003Cspan class=\"token punctuation\">>\u003C/span>\u003C/span>\n\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>The custom hook should create two functions with \u003Ccode>useCallback\u003C/code>.\nAlso, \u003Ccode>AbortController\u003C/code> instances should be shared between the two functions\nwith a help from \u003Ccode>useState\u003C/code>.\u003C/p>\n\u003Cpre class=\"language-js\">\u003Ccode class=\"language-js code-highlight\">\u003Cspan class=\"code-line line-number\" line=\"1\">\u003Cspan class=\"token keyword\">const\u003C/span> useAbortController \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token parameter\">url\u003Cspan class=\"token punctuation\">,\u003C/span> params\u003Cspan class=\"token punctuation\">,\u003C/span> onFetchComplete\u003Cspan class=\"token punctuation\">,\u003C/span> onError\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token arrow operator\">=>\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"2\">  \u003Cspan class=\"token keyword\">const\u003C/span> \u003Cspan class=\"token punctuation\">[\u003C/span>controller\u003Cspan class=\"token punctuation\">,\u003C/span> setController\u003Cspan class=\"token punctuation\">]\u003C/span> \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token function\">useState\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token keyword\">new\u003C/span> \u003Cspan class=\"token class-name\">AbortController\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"3\">\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"4\">  \u003Cspan class=\"token keyword\">const\u003C/span> request \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token function\">useCallback\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token keyword\">async\u003C/span> \u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token arrow operator\">=>\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"5\">    \u003Cspan class=\"token keyword control-flow\">try\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"6\">      \u003Cspan class=\"token keyword\">const\u003C/span> result \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token keyword control-flow\">await\u003C/span> axios\u003Cspan class=\"token punctuation\">.\u003C/span>\u003Cspan class=\"token method function property-access\">get\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>url\u003Cspan class=\"token punctuation\">,\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"7\">        params\u003Cspan class=\"token punctuation\">,\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"8\">        \u003Cspan class=\"token literal-property property\">signal\u003C/span>\u003Cspan class=\"token operator\">:\u003C/span> controller\u003Cspan class=\"token punctuation\">.\u003C/span>\u003Cspan class=\"token property-access\">signal\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"9\">      \u003Cspan class=\"token punctuation\">}\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"10\">      \u003Cspan class=\"token function\">onFetchComplete\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>result\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"11\">    \u003Cspan class=\"token punctuation\">}\u003C/span> \u003Cspan class=\"token keyword control-flow\">catch\u003C/span> \u003Cspan class=\"token punctuation\">(\u003C/span>e\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"12\">      \u003Cspan class=\"token function\">onError\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>e\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"13\">    \u003Cspan class=\"token punctuation\">}\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"14\">  \u003Cspan class=\"token punctuation\">}\u003C/span>\u003Cspan class=\"token punctuation\">,\u003C/span> \u003Cspan class=\"token punctuation\">[\u003C/span>controller\u003Cspan class=\"token punctuation\">,\u003C/span> url\u003Cspan class=\"token punctuation\">,\u003C/span> params\u003Cspan class=\"token punctuation\">,\u003C/span> onFetchComplete\u003Cspan class=\"token punctuation\">,\u003C/span> onError\u003Cspan class=\"token punctuation\">]\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"15\">\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"16\">  \u003Cspan class=\"token keyword\">const\u003C/span> abortRequest \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token function\">useCallback\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token arrow operator\">=>\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"17\">    controller\u003Cspan class=\"token punctuation\">.\u003C/span>\u003Cspan class=\"token method function property-access\">abort\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"18\">    \u003Cspan class=\"token comment\">// Create a new AbortController,\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"19\">    \u003Cspan class=\"token comment\">// since you cannot use same AbortController more than once.\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"20\">    \u003Cspan class=\"token function\">setController\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token keyword\">new\u003C/span> \u003Cspan class=\"token class-name\">AbortController\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"21\">  \u003Cspan class=\"token punctuation\">}\u003C/span>\u003Cspan class=\"token punctuation\">,\u003C/span> \u003Cspan class=\"token punctuation\">[\u003C/span>controller\u003Cspan class=\"token punctuation\">]\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"22\">\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"23\">  \u003Cspan class=\"token keyword control-flow\">return\u003C/span> \u003Cspan class=\"token punctuation\">[\u003C/span>callback\u003Cspan class=\"token punctuation\">,\u003C/span> abort\u003Cspan class=\"token punctuation\">]\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"24\">\u003Cspan class=\"token punctuation\">}\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>However, there is a flaw in the hook;\nthe \u003Ccode>AbortController\u003C/code> is managed as a \u003Cstrong>state\u003C/strong>.\nYou cannot reuse the same controller once you called \u003Ccode>AbortController.abort()\u003C/code>.\nt means you need to create new one after calling \u003Ccode>AbortController.abort()\u003C/code>.\nThus the two functions should depend on \u003Ccode>controller\u003C/code> state to get the latest \u003Ccode>AbortController\u003C/code>.\nThis dependency presents us a problem; unnecessary rerenders.\u003C/p>\n\u003Col>\n\u003Cli>Call \u003Ccode>abortRequest()\u003C/code> callback.\u003C/li>\n\u003Cli>\u003Ccode>controller\u003C/code> state renews.\u003C/li>\n\u003Cli>\u003Ccode>request\u003C/code> and \u003Ccode>abortRequest\u003C/code> callbacks renews.\u003C/li>\n\u003Cli>Components which call the hook rerender, also do their children.\u003C/li>\n\u003C/ol>\n\u003Cp>Futhermore, we may have a problem if we call the callback inside \u003Ccode>useEffect\u003C/code>.\nThe effect should depend on \u003Ccode>request\u003C/code> to use the latest value.\nWhen we abort the callback, the effect reruns whether we like it or not.\nAlso, calling callback and returning abort cleanup function inside the same \u003Ccode>useEffect\u003C/code>\nresult in an infinite rerenders.\nSince these behaviors are due to the internal logics of this hook,\nit should be avoided or it will confuse those who use the hook.\u003C/p>\n\u003Cpre class=\"language-jsx\">\u003Ccode class=\"language-jsx code-highlight\">\u003Cspan class=\"code-line line-number\" line=\"1\">\u003Cspan class=\"token keyword\">const\u003C/span> \u003Cspan class=\"token punctuation\">[\u003C/span>search\u003Cspan class=\"token punctuation\">,\u003C/span> abortSearch\u003Cspan class=\"token punctuation\">]\u003C/span> \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token function\">useAbortController\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"2\">  url\u003Cspan class=\"token punctuation\">,\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"3\">  params\u003Cspan class=\"token punctuation\">,\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"4\">  setSearchResult\u003Cspan class=\"token punctuation\">,\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"5\">  onError\u003Cspan class=\"token punctuation\">,\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"6\">\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"7\">\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"8\">\u003Cspan class=\"token function\">useEffect\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token arrow operator\">=>\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"9\">  \u003Cspan class=\"token function\">search\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"10\">\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"11\">  \u003Cspan class=\"token keyword control-flow\">return\u003C/span> \u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token arrow operator\">=>\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"12\">    \u003Cspan class=\"token function\">abortSearch\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"13\">  \u003Cspan class=\"token punctuation\">}\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"14\">\u003Cspan class=\"token punctuation\">}\u003C/span>\u003Cspan class=\"token punctuation\">,\u003C/span> \u003Cspan class=\"token punctuation\">[\u003C/span>search\u003Cspan class=\"token punctuation\">,\u003C/span> abortSearch\u003Cspan class=\"token punctuation\">]\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"15\">\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"16\">\u003Cspan class=\"token comment\">// All I want to do is cancel searching,\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"17\">\u003Cspan class=\"token comment\">// but search API is called when the button is pressed?\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"18\">\u003Cspan class=\"token tag\">\u003Cspan class=\"token tag\">\u003Cspan class=\"token punctuation\">&#x3C;\u003C/span>button\u003C/span> \u003Cspan class=\"token attr-name\">onClick\u003C/span>\u003Cspan class=\"token script language-javascript\">\u003Cspan class=\"token script-punctuation punctuation\">=\u003C/span>\u003Cspan class=\"token punctuation\">{\u003C/span>abortSearch\u003Cspan class=\"token punctuation\">}\u003C/span>\u003C/span>\u003Cspan class=\"token punctuation\">>\u003C/span>\u003C/span>\u003Cspan class=\"token plain-text\">Cancel search\u003C/span>\u003Cspan class=\"token tag\">\u003Cspan class=\"token tag\">\u003Cspan class=\"token punctuation\">&#x3C;/\u003C/span>button\u003C/span>\u003Cspan class=\"token punctuation\">>\u003C/span>\u003C/span>\n\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch2 id=\"5-Manage-AbortController-with-useRef\">Manage AbortController with useRef\u003C/h2>\n\u003Cp>Instead of managing \u003Ccode>AbortController\u003C/code> with \u003Ccode>useState\u003C/code>\nand suffer from rerenders, we got a better option: \u003Ccode>useRef\u003C/code>.\u003C/p>\n\u003Cpre class=\"language-js\">\u003Ccode class=\"language-js code-highlight\">\u003Cspan class=\"code-line line-number\" line=\"1\">\u003Cspan class=\"token keyword\">const\u003C/span> useAbortController \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token parameter\">url\u003Cspan class=\"token punctuation\">,\u003C/span> params\u003Cspan class=\"token punctuation\">,\u003C/span> onFetchComplete\u003Cspan class=\"token punctuation\">,\u003C/span> onError\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token arrow operator\">=>\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"2\">  \u003Cspan class=\"token keyword\">const\u003C/span> controllerRef \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token function\">useRef\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token keyword\">new\u003C/span> \u003Cspan class=\"token class-name\">AbortController\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"3\">\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"4\">  \u003Cspan class=\"token keyword\">const\u003C/span> request \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token function\">useCallback\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token keyword\">async\u003C/span> \u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token arrow operator\">=>\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"5\">    \u003Cspan class=\"token keyword control-flow\">try\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"6\">      \u003Cspan class=\"token keyword\">const\u003C/span> signal \u003Cspan class=\"token operator\">=\u003C/span> controllerRef\u003Cspan class=\"token punctuation\">.\u003C/span>\u003Cspan class=\"token property-access\">current\u003C/span>\u003Cspan class=\"token punctuation\">.\u003C/span>\u003Cspan class=\"token property-access\">signal\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"7\">      \u003Cspan class=\"token keyword\">const\u003C/span> result \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token keyword control-flow\">await\u003C/span> axios\u003Cspan class=\"token punctuation\">.\u003C/span>\u003Cspan class=\"token method function property-access\">get\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>url\u003Cspan class=\"token punctuation\">,\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"8\">        params\u003Cspan class=\"token punctuation\">,\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"9\">        signal\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"10\">      \u003Cspan class=\"token punctuation\">}\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"11\">      onFetchComplete\u003Cspan class=\"token operator\">?.\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>result\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"12\">    \u003Cspan class=\"token punctuation\">}\u003C/span> \u003Cspan class=\"token keyword control-flow\">catch\u003C/span> \u003Cspan class=\"token punctuation\">(\u003C/span>e\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"13\">      onError\u003Cspan class=\"token operator\">?.\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>e\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"14\">    \u003Cspan class=\"token punctuation\">}\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"15\">  \u003Cspan class=\"token punctuation\">}\u003C/span>\u003Cspan class=\"token punctuation\">,\u003C/span> \u003Cspan class=\"token punctuation\">[\u003C/span>url\u003Cspan class=\"token punctuation\">,\u003C/span> params\u003Cspan class=\"token punctuation\">,\u003C/span> onFetchComplete\u003Cspan class=\"token punctuation\">,\u003C/span> onError\u003Cspan class=\"token punctuation\">]\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"16\">\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"17\">  \u003Cspan class=\"token keyword\">const\u003C/span> abortRequest \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token function\">useCallback\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token arrow operator\">=>\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"18\">    controllerRef\u003Cspan class=\"token punctuation\">.\u003C/span>\u003Cspan class=\"token property-access\">current\u003C/span>\u003Cspan class=\"token punctuation\">.\u003C/span>\u003Cspan class=\"token method function property-access\">abort\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"19\">    controllerRef\u003Cspan class=\"token punctuation\">.\u003C/span>\u003Cspan class=\"token property-access\">current\u003C/span> \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token keyword\">new\u003C/span> \u003Cspan class=\"token class-name\">AbortController\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"20\">  \u003Cspan class=\"token punctuation\">}\u003C/span>\u003Cspan class=\"token punctuation\">,\u003C/span> \u003Cspan class=\"token punctuation\">[\u003C/span>\u003Cspan class=\"token punctuation\">]\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"21\">\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"22\">  \u003Cspan class=\"token keyword control-flow\">return\u003C/span> \u003Cspan class=\"token punctuation\">[\u003C/span>callback\u003Cspan class=\"token punctuation\">,\u003C/span> abort\u003Cspan class=\"token punctuation\">]\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"23\">\u003Cspan class=\"token punctuation\">}\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>Now the hook does not incur any rerender or make you suffer from rerender.\n\u003Cstrong>Note\u003C/strong> that the \u003Ccode>signal\u003C/code> variable is created and used\ninside \u003Ccode>request\u003C/code> callback.\n\u003Ccode>abort\u003C/code> function reassigns \u003Ccode>controllerRef.current\u003C/code>,\nwhich means \u003Ccode>controllerRef.current\u003C/code> referred by \u003Ccode>fetch\u003C/code>\nmight not be the \u003Ccode>AbortController\u003C/code> instance you want.\nIt could be a new \u003Ccode>AbortController\u003C/code>,\nthen \u003Ccode>fetch\u003C/code> may run even though you called \u003Ccode>abortRequest\u003C/code>.\nThus, we need to store \u003Ccode>controllerRef.current\u003C/code> some place else\nbefore we make a \u003Ccode>fetch\u003C/code> call.\u003C/p>\n\u003Ch1 id=\"6-Pass-AbortController-to-Callback-as-a-Parameter\">Pass AbortController to Callback as a Parameter\u003C/h1>\n\u003Cp>To further increase flexibility, we may come up with an idea\nwhere \u003Ccode>useAbortController\u003C/code> receives a callback, not an url.\nThis lets you pass single parameter only,\nsince you are now able to control \u003Ccode>url\u003C/code>, \u003Ccode>params\u003C/code>, \u003Ccode>onFetchComplete\u003C/code>, \u003Ccode>onError\u003C/code>\ninside the callback, freely.\u003C/p>\n\u003Cpre class=\"language-js\">\u003Ccode class=\"language-js code-highlight\">\u003Cspan class=\"code-line line-number\" line=\"1\">\u003Cspan class=\"token keyword\">const\u003C/span> searchWithAbortController \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token function\">useCallback\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"2\">  \u003Cspan class=\"token keyword\">async\u003C/span> \u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token parameter\">abortController\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token arrow operator\">=>\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"3\">    \u003Cspan class=\"token keyword control-flow\">try\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"4\">      \u003Cspan class=\"token keyword\">const\u003C/span> result \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token keyword control-flow\">await\u003C/span> axios\u003Cspan class=\"token punctuation\">.\u003C/span>\u003Cspan class=\"token method function property-access\">get\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token string\">'/search'\u003C/span>\u003Cspan class=\"token punctuation\">,\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"5\">        \u003Cspan class=\"token literal-property property\">signal\u003C/span>\u003Cspan class=\"token operator\">:\u003C/span> abortController\u003Cspan class=\"token punctuation\">.\u003C/span>\u003Cspan class=\"token property-access\">signal\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"6\">      \u003Cspan class=\"token punctuation\">}\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"7\">      \u003Cspan class=\"token comment\">// Handle result\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"8\">    \u003Cspan class=\"token punctuation\">}\u003C/span> \u003Cspan class=\"token keyword control-flow\">catch\u003C/span> \u003Cspan class=\"token punctuation\">(\u003C/span>e\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"9\">      \u003Cspan class=\"token comment\">// Handle errors\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"10\">    \u003Cspan class=\"token punctuation\">}\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"11\">  \u003Cspan class=\"token punctuation\">}\u003C/span>\u003Cspan class=\"token punctuation\">,\u003C/span> \u003Cspan class=\"token punctuation\">[\u003C/span>\u003Cspan class=\"token punctuation\">]\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"12\">\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"13\">\u003Cspan class=\"token keyword\">const\u003C/span> \u003Cspan class=\"token punctuation\">[\u003C/span>search\u003Cspan class=\"token punctuation\">,\u003C/span> abortSearch\u003Cspan class=\"token punctuation\">]\u003C/span> \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token function\">useAbortController\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>searchWithAbortController\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>We can do that easily with the following code.\nThis hook's role is to wrap a callback with an \u003Ccode>AbortController\u003C/code> and that is all.\nThe code got much simpler because we let callers control responses and errors.\nHowever callers' code may get complicated to handle those.\nIt has pros and cons.\u003C/p>\n\u003Cpre class=\"language-js\">\u003Ccode class=\"language-js code-highlight\">\u003Cspan class=\"code-line line-number\" line=\"1\">\u003Cspan class=\"token keyword\">const\u003C/span> useAbortController \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token parameter\">cb\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token arrow operator\">=>\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"2\">  \u003Cspan class=\"token keyword\">const\u003C/span> controllerRef \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token function\">useRef\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token keyword\">new\u003C/span> \u003Cspan class=\"token class-name\">AbortController\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"3\">\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"4\">  \u003Cspan class=\"token keyword\">const\u003C/span> callback \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token function\">useCallback\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token arrow operator\">=>\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"5\">    \u003Cspan class=\"token keyword\">const\u003C/span> controller \u003Cspan class=\"token operator\">=\u003C/span> controllerRef\u003Cspan class=\"token punctuation\">.\u003C/span>\u003Cspan class=\"token property-access\">current\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"6\">    \u003Cspan class=\"token keyword control-flow\">return\u003C/span> \u003Cspan class=\"token function\">cb\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>controller\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"7\">  \u003Cspan class=\"token punctuation\">}\u003C/span>\u003Cspan class=\"token punctuation\">,\u003C/span> \u003Cspan class=\"token punctuation\">[\u003C/span>cb\u003Cspan class=\"token punctuation\">]\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"8\">\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"9\">  \u003Cspan class=\"token keyword\">const\u003C/span> abort \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token function\">useCallback\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token arrow operator\">=>\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"10\">    controllerRef\u003Cspan class=\"token punctuation\">.\u003C/span>\u003Cspan class=\"token property-access\">current\u003C/span>\u003Cspan class=\"token punctuation\">.\u003C/span>\u003Cspan class=\"token method function property-access\">abort\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"11\">    controllerRef\u003Cspan class=\"token punctuation\">.\u003C/span>\u003Cspan class=\"token property-access\">current\u003C/span> \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token keyword\">new\u003C/span> \u003Cspan class=\"token class-name\">AbortController\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"12\">  \u003Cspan class=\"token punctuation\">}\u003C/span>\u003Cspan class=\"token punctuation\">,\u003C/span> \u003Cspan class=\"token punctuation\">[\u003C/span>\u003Cspan class=\"token punctuation\">]\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"13\">\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"14\">  \u003Cspan class=\"token keyword control-flow\">return\u003C/span> \u003Cspan class=\"token punctuation\">[\u003C/span>callback\u003Cspan class=\"token punctuation\">,\u003C/span> abort\u003Cspan class=\"token punctuation\">]\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"15\">\u003Cspan class=\"token punctuation\">}\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch2 id=\"7-Pass-Other-Arguments-as-Parameters-Together\">Pass Other Arguments as Parameters Together\u003C/h2>\n\u003Cp>To keep things go further, we can pass\ncallback's arguments as parameters, not just \u003Ccode>AbortController\u003C/code>.\u003C/p>\n\u003Cpre class=\"language-js\">\u003Ccode class=\"language-js code-highlight\">\u003Cspan class=\"code-line line-number\" line=\"1\">\u003Cspan class=\"token keyword\">const\u003C/span> useAbortController \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token parameter\">cb\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token arrow operator\">=>\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"2\">  \u003Cspan class=\"token keyword\">const\u003C/span> controllerRef \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token function\">useRef\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token keyword\">new\u003C/span> \u003Cspan class=\"token class-name\">AbortController\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"3\">\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"4\">  \u003Cspan class=\"token keyword\">const\u003C/span> callback \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token function\">useCallback\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token parameter\">\u003Cspan class=\"token spread operator\">...\u003C/span>args\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token arrow operator\">=>\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"5\">    \u003Cspan class=\"token keyword\">const\u003C/span> controller \u003Cspan class=\"token operator\">=\u003C/span> controllerRef\u003Cspan class=\"token punctuation\">.\u003C/span>\u003Cspan class=\"token property-access\">current\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"6\">    \u003Cspan class=\"token keyword control-flow\">return\u003C/span> \u003Cspan class=\"token function\">cb\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>controller\u003Cspan class=\"token punctuation\">,\u003C/span> \u003Cspan class=\"token spread operator\">...\u003C/span>args\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"7\">  \u003Cspan class=\"token punctuation\">}\u003C/span>\u003Cspan class=\"token punctuation\">,\u003C/span> \u003Cspan class=\"token punctuation\">[\u003C/span>cb\u003Cspan class=\"token punctuation\">]\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"8\">\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"9\">  \u003Cspan class=\"token keyword\">const\u003C/span> abort \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token function\">useCallback\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token arrow operator\">=>\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"10\">    controllerRef\u003Cspan class=\"token punctuation\">.\u003C/span>\u003Cspan class=\"token property-access\">current\u003C/span>\u003Cspan class=\"token punctuation\">.\u003C/span>\u003Cspan class=\"token method function property-access\">abort\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"11\">    controllerRef\u003Cspan class=\"token punctuation\">.\u003C/span>\u003Cspan class=\"token property-access\">current\u003C/span> \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token keyword\">new\u003C/span> \u003Cspan class=\"token class-name\">AbortController\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"12\">  \u003Cspan class=\"token punctuation\">}\u003C/span>\u003Cspan class=\"token punctuation\">,\u003C/span> \u003Cspan class=\"token punctuation\">[\u003C/span>\u003Cspan class=\"token punctuation\">]\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"13\">\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"14\">  \u003Cspan class=\"token keyword control-flow\">return\u003C/span> \u003Cspan class=\"token punctuation\">[\u003C/span>callback\u003Cspan class=\"token punctuation\">,\u003C/span> abort\u003Cspan class=\"token punctuation\">]\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"15\">\u003Cspan class=\"token punctuation\">}\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>This is quite useful pattern since we can call\nthe callback function just like before it was wrapped with \u003Ccode>useAbortController\u003C/code>.\u003C/p>\n\u003Cpre class=\"language-js\">\u003Ccode class=\"language-js code-highlight\">\u003Cspan class=\"code-line line-number\" line=\"1\">\u003Cspan class=\"token keyword\">const\u003C/span> searchWithAbortController \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token function\">useCallback\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"2\">  \u003Cspan class=\"token keyword\">async\u003C/span> \u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token parameter\">abortController\u003Cspan class=\"token punctuation\">,\u003C/span> keyword\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token arrow operator\">=>\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"3\">    \u003Cspan class=\"token keyword control-flow\">try\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"4\">      \u003Cspan class=\"token keyword\">const\u003C/span> result \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token keyword control-flow\">await\u003C/span> axios\u003Cspan class=\"token punctuation\">.\u003C/span>\u003Cspan class=\"token method function property-access\">get\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token string\">'/search'\u003C/span>\u003Cspan class=\"token punctuation\">,\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"5\">        \u003Cspan class=\"token literal-property property\">params\u003C/span>\u003Cspan class=\"token operator\">:\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>keyword\u003Cspan class=\"token punctuation\">}\u003C/span>\u003Cspan class=\"token punctuation\">,\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"6\">        \u003Cspan class=\"token literal-property property\">signal\u003C/span>\u003Cspan class=\"token operator\">:\u003C/span> abortController\u003Cspan class=\"token punctuation\">.\u003C/span>\u003Cspan class=\"token property-access\">signal\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"7\">      \u003Cspan class=\"token punctuation\">}\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"8\">      \u003Cspan class=\"token comment\">// Handle result\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"9\">    \u003Cspan class=\"token punctuation\">}\u003C/span> \u003Cspan class=\"token keyword control-flow\">catch\u003C/span> \u003Cspan class=\"token punctuation\">(\u003C/span>e\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"10\">      \u003Cspan class=\"token comment\">// Handle errors\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"11\">    \u003Cspan class=\"token punctuation\">}\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"12\">  \u003Cspan class=\"token punctuation\">}\u003C/span>\u003Cspan class=\"token punctuation\">,\u003C/span> \u003Cspan class=\"token punctuation\">[\u003C/span>\u003Cspan class=\"token punctuation\">]\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"13\">\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"14\">\u003Cspan class=\"token keyword\">const\u003C/span> \u003Cspan class=\"token punctuation\">[\u003C/span>search\u003Cspan class=\"token punctuation\">,\u003C/span> abortSearch\u003Cspan class=\"token punctuation\">]\u003C/span> \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token function\">useAbortController\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>searchWithAbortController\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"15\">\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"16\">\u003Cspan class=\"token comment\">// Like this. No need to care AbortController, just your arguments.\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"17\">\u003Cspan class=\"token function\">search\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token string\">'keyword'\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>If you want \u003Ccode>AbortController\u003C/code> to be the last parameter, simple send it to the last.\u003C/p>\n\u003Cpre class=\"language-js\">\u003Ccode class=\"language-js code-highlight\">\u003Cspan class=\"code-line line-number\" line=\"1\">\u003Cspan class=\"token keyword\">const\u003C/span> useAbortController \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token parameter\">cb\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token arrow operator\">=>\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"2\">  \u003Cspan class=\"token keyword\">const\u003C/span> controllerRef \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token function\">useRef\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token keyword\">new\u003C/span> \u003Cspan class=\"token class-name\">AbortController\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"3\">\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"4\">  \u003Cspan class=\"token keyword\">const\u003C/span> callback \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token function\">useCallback\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token parameter\">\u003Cspan class=\"token spread operator\">...\u003C/span>args\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token arrow operator\">=>\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"5\">    \u003Cspan class=\"token keyword\">const\u003C/span> controller \u003Cspan class=\"token operator\">=\u003C/span> controllerRef\u003Cspan class=\"token punctuation\">.\u003C/span>\u003Cspan class=\"token property-access\">current\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"6\">    \u003Cspan class=\"token keyword control-flow\">return\u003C/span> \u003Cspan class=\"token function\">cb\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token spread operator\">...\u003C/span>args\u003Cspan class=\"token punctuation\">,\u003C/span> controller\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"7\">  \u003Cspan class=\"token punctuation\">}\u003C/span>\u003Cspan class=\"token punctuation\">,\u003C/span> \u003Cspan class=\"token punctuation\">[\u003C/span>cb\u003Cspan class=\"token punctuation\">]\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"8\">\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"9\">  \u003Cspan class=\"token keyword\">const\u003C/span> abort \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token function\">useCallback\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token arrow operator\">=>\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"10\">    controllerRef\u003Cspan class=\"token punctuation\">.\u003C/span>\u003Cspan class=\"token property-access\">current\u003C/span>\u003Cspan class=\"token punctuation\">.\u003C/span>\u003Cspan class=\"token method function property-access\">abort\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"11\">    controllerRef\u003Cspan class=\"token punctuation\">.\u003C/span>\u003Cspan class=\"token property-access\">current\u003C/span> \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token keyword\">new\u003C/span> \u003Cspan class=\"token class-name\">AbortController\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"12\">  \u003Cspan class=\"token punctuation\">}\u003C/span>\u003Cspan class=\"token punctuation\">,\u003C/span> \u003Cspan class=\"token punctuation\">[\u003C/span>\u003Cspan class=\"token punctuation\">]\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"13\">\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"14\">  \u003Cspan class=\"token keyword control-flow\">return\u003C/span> \u003Cspan class=\"token punctuation\">[\u003C/span>callback\u003Cspan class=\"token punctuation\">,\u003C/span> abort\u003Cspan class=\"token punctuation\">]\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"15\">\u003Cspan class=\"token punctuation\">}\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"16\">\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"17\">\u003Cspan class=\"token keyword\">const\u003C/span> searchWithAbortController \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token function\">useCallback\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"18\">  \u003Cspan class=\"token keyword\">async\u003C/span> \u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token parameter\">keyword\u003Cspan class=\"token punctuation\">,\u003C/span> abortController\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token arrow operator\">=>\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"19\">    \u003Cspan class=\"token keyword control-flow\">try\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"20\">      \u003Cspan class=\"token keyword\">const\u003C/span> result \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token keyword control-flow\">await\u003C/span> axios\u003Cspan class=\"token punctuation\">.\u003C/span>\u003Cspan class=\"token method function property-access\">get\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token string\">'/search'\u003C/span>\u003Cspan class=\"token punctuation\">,\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"21\">        \u003Cspan class=\"token literal-property property\">params\u003C/span>\u003Cspan class=\"token operator\">:\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>keyword\u003Cspan class=\"token punctuation\">}\u003C/span>\u003Cspan class=\"token punctuation\">,\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"22\">        \u003Cspan class=\"token literal-property property\">signal\u003C/span>\u003Cspan class=\"token operator\">:\u003C/span> abortController\u003Cspan class=\"token punctuation\">.\u003C/span>\u003Cspan class=\"token property-access\">signal\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"23\">      \u003Cspan class=\"token punctuation\">}\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"24\">      \u003Cspan class=\"token comment\">// Handle result\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"25\">    \u003Cspan class=\"token punctuation\">}\u003C/span> \u003Cspan class=\"token keyword control-flow\">catch\u003C/span> \u003Cspan class=\"token punctuation\">(\u003C/span>e\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"26\">      \u003Cspan class=\"token comment\">// Handle errors\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"27\">    \u003Cspan class=\"token punctuation\">}\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"28\">  \u003Cspan class=\"token punctuation\">}\u003C/span>\u003Cspan class=\"token punctuation\">,\u003C/span> \u003Cspan class=\"token punctuation\">[\u003C/span>\u003Cspan class=\"token punctuation\">]\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch3 id=\"8-Typing-with-Typescript\">Typing with Typescript\u003C/h3>\n\u003Cp>Now let us see how to type the hook with Typescript.\nKeeping types is vital for developer experience when you curry functions.\nTypes will be lost if you do not take a good care of it in curry functions.\nSee the following Typescript code.\nIt works but every type is written as \u003Ccode>unknown\u003C/code>.\nWe need more than this.\u003C/p>\n\u003Cpre class=\"language-ts\">\u003Ccode class=\"language-ts code-highlight\">\u003Cspan class=\"code-line line-number\" line=\"1\">\u003Cspan class=\"token keyword\">const\u003C/span> \u003Cspan class=\"token function-variable function\">useAbortController\u003C/span> \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token punctuation\">(\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"2\">  \u003Cspan class=\"token function-variable function\">cb\u003C/span>\u003Cspan class=\"token operator\">:\u003C/span> \u003Cspan class=\"token punctuation\">(\u003C/span>controller\u003Cspan class=\"token operator\">:\u003C/span> AbortController\u003Cspan class=\"token punctuation\">,\u003C/span> \u003Cspan class=\"token operator\">...\u003C/span>args\u003Cspan class=\"token operator\">:\u003C/span> \u003Cspan class=\"token builtin\">unknown\u003C/span>\u003Cspan class=\"token punctuation\">[\u003C/span>\u003Cspan class=\"token punctuation\">]\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token operator\">=>\u003C/span> \u003Cspan class=\"token builtin\">unknown\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"3\">\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token operator\">=>\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"4\">  \u003Cspan class=\"token keyword\">const\u003C/span> controllerRef \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token function\">useRef\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token keyword\">new\u003C/span> \u003Cspan class=\"token class-name\">AbortController\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"5\">\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"6\">  \u003Cspan class=\"token keyword\">const\u003C/span> callback \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token function\">useCallback\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token operator\">...\u003C/span>cbArgs\u003Cspan class=\"token operator\">:\u003C/span> \u003Cspan class=\"token builtin\">unknown\u003C/span>\u003Cspan class=\"token punctuation\">[\u003C/span>\u003Cspan class=\"token punctuation\">]\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token operator\">=>\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"7\">    \u003Cspan class=\"token keyword\">const\u003C/span> controller \u003Cspan class=\"token operator\">=\u003C/span> controllerRef\u003Cspan class=\"token punctuation\">.\u003C/span>current\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"8\">    \u003Cspan class=\"token keyword\">return\u003C/span> \u003Cspan class=\"token function\">cb\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>controller\u003Cspan class=\"token punctuation\">,\u003C/span> \u003Cspan class=\"token operator\">...\u003C/span>cbArgs\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"9\">  \u003Cspan class=\"token punctuation\">}\u003C/span>\u003Cspan class=\"token punctuation\">,\u003C/span> \u003Cspan class=\"token punctuation\">[\u003C/span>cb\u003Cspan class=\"token punctuation\">]\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"10\">\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"11\">  \u003Cspan class=\"token keyword\">const\u003C/span> abort \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token function\">useCallback\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token operator\">=>\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"12\">    controllerRef\u003Cspan class=\"token punctuation\">.\u003C/span>current\u003Cspan class=\"token punctuation\">.\u003C/span>\u003Cspan class=\"token function\">abort\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"13\">    controllerRef\u003Cspan class=\"token punctuation\">.\u003C/span>current \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token keyword\">new\u003C/span> \u003Cspan class=\"token class-name\">AbortController\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"14\">  \u003Cspan class=\"token punctuation\">}\u003C/span>\u003Cspan class=\"token punctuation\">,\u003C/span> \u003Cspan class=\"token punctuation\">[\u003C/span>\u003Cspan class=\"token punctuation\">]\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"15\">\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"16\">  \u003Cspan class=\"token keyword\">return\u003C/span> \u003Cspan class=\"token punctuation\">[\u003C/span>callback\u003Cspan class=\"token punctuation\">,\u003C/span> abort\u003Cspan class=\"token punctuation\">]\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"17\">\u003Cspan class=\"token punctuation\">}\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>What we need is \u003Cem>generics\u003C/em>. By adding generic types to the hook,\nthe resultant functions automatically infer concrete types.\u003C/p>\n\u003Cpre class=\"language-ts\">\u003Ccode class=\"language-ts code-highlight\">\u003Cspan class=\"code-line line-number\" line=\"1\">\u003Cspan class=\"token keyword\">const\u003C/span> useAbortController \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token operator\">&#x3C;\u003C/span>Args \u003Cspan class=\"token keyword\">extends\u003C/span> \u003Cspan class=\"token class-name\">\u003Cspan class=\"token builtin\">unknown\u003C/span>\u003C/span>\u003Cspan class=\"token punctuation\">[\u003C/span>\u003Cspan class=\"token punctuation\">]\u003C/span>\u003Cspan class=\"token punctuation\">,\u003C/span> Ret\u003Cspan class=\"token operator\">>\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"2\">  \u003Cspan class=\"token punctuation\">(\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"3\">    \u003Cspan class=\"token function-variable function\">cb\u003C/span>\u003Cspan class=\"token operator\">:\u003C/span> \u003Cspan class=\"token punctuation\">(\u003C/span>controller\u003Cspan class=\"token operator\">:\u003C/span> AbortController\u003Cspan class=\"token punctuation\">,\u003C/span> \u003Cspan class=\"token operator\">...\u003C/span>args\u003Cspan class=\"token operator\">:\u003C/span> Args\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token operator\">=>\u003C/span> Ret\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"4\">  \u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token operator\">=>\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"5\">  \u003Cspan class=\"token keyword\">const\u003C/span> controllerRef \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token function\">useRef\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token keyword\">new\u003C/span> \u003Cspan class=\"token class-name\">AbortController\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"6\">\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"7\">  \u003Cspan class=\"token keyword\">const\u003C/span> callback \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token function\">useCallback\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token operator\">...\u003C/span>cbArgs\u003Cspan class=\"token operator\">:\u003C/span> Args\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token operator\">=>\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"8\">    \u003Cspan class=\"token keyword\">const\u003C/span> controller \u003Cspan class=\"token operator\">=\u003C/span> controllerRef\u003Cspan class=\"token punctuation\">.\u003C/span>current\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"9\">    \u003Cspan class=\"token keyword\">return\u003C/span> \u003Cspan class=\"token function\">cb\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>controller\u003Cspan class=\"token punctuation\">,\u003C/span> \u003Cspan class=\"token operator\">...\u003C/span>cbArgs\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"10\">  \u003Cspan class=\"token punctuation\">}\u003C/span>\u003Cspan class=\"token punctuation\">,\u003C/span> \u003Cspan class=\"token punctuation\">[\u003C/span>cb\u003Cspan class=\"token punctuation\">]\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"11\">\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"12\">  \u003Cspan class=\"token keyword\">const\u003C/span> abort \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token function\">useCallback\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token operator\">=>\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"13\">    controllerRef\u003Cspan class=\"token punctuation\">.\u003C/span>current\u003Cspan class=\"token punctuation\">.\u003C/span>\u003Cspan class=\"token function\">abort\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"14\">    controllerRef\u003Cspan class=\"token punctuation\">.\u003C/span>current \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token keyword\">new\u003C/span> \u003Cspan class=\"token class-name\">AbortController\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"15\">  \u003Cspan class=\"token punctuation\">}\u003C/span>\u003Cspan class=\"token punctuation\">,\u003C/span> \u003Cspan class=\"token punctuation\">[\u003C/span>\u003Cspan class=\"token punctuation\">]\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"16\">\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"17\">  \u003Cspan class=\"token keyword\">return\u003C/span> \u003Cspan class=\"token punctuation\">[\u003C/span>callback\u003Cspan class=\"token punctuation\">,\u003C/span> abort\u003Cspan class=\"token punctuation\">]\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"18\">\u003Cspan class=\"token punctuation\">}\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>Now exported callbacks have specifically typed parameters\nbut themselves with ambiguous typings.\nThis is because we did not specify \u003Ccode>useAbortController\u003C/code> return type.\u003C/p>\n\u003Cp>\u003Cimg src=\"/img/2023-10-26-en-useAbortController-hook/useAbortController-typescript-1.png\" alt=\"useAbortController-typescript-wrong-types\">\u003C/p>\n\u003Cp>\u003Cimg src=\"/img/2023-10-26-en-useAbortController-hook/useAbortController-typescript-2.png\" alt=\"useAbortController-typescript-wrong-types\">\u003C/p>\n\u003Cp>We can solve this by explicitly typing it:\u003C/p>\n\u003Cpre class=\"language-ts\">\u003Ccode class=\"language-ts code-highlight\">\u003Cspan class=\"code-line line-number\" line=\"1\">\u003Cspan class=\"token keyword\">const\u003C/span> useAbortController \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token operator\">&#x3C;\u003C/span>Args \u003Cspan class=\"token keyword\">extends\u003C/span> \u003Cspan class=\"token class-name\">\u003Cspan class=\"token builtin\">unknown\u003C/span>\u003C/span>\u003Cspan class=\"token punctuation\">[\u003C/span>\u003Cspan class=\"token punctuation\">]\u003C/span>\u003Cspan class=\"token punctuation\">,\u003C/span> Ret\u003Cspan class=\"token operator\">>\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"2\">  \u003Cspan class=\"token punctuation\">(\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"3\">    \u003Cspan class=\"token function-variable function\">cb\u003C/span>\u003Cspan class=\"token operator\">:\u003C/span> \u003Cspan class=\"token punctuation\">(\u003C/span>controller\u003Cspan class=\"token operator\">:\u003C/span> AbortController\u003Cspan class=\"token punctuation\">,\u003C/span> \u003Cspan class=\"token operator\">...\u003C/span>args\u003Cspan class=\"token operator\">:\u003C/span> Args\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token operator\">=>\u003C/span> Ret\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"4\">  \u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token operator\">:\u003C/span> \u003Cspan class=\"token punctuation\">[\u003C/span>\u003Cspan class=\"token function-variable function\">callback\u003C/span>\u003Cspan class=\"token operator\">:\u003C/span> \u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token operator\">...\u003C/span>args\u003Cspan class=\"token operator\">:\u003C/span> Args\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token operator\">=>\u003C/span> Ret\u003Cspan class=\"token punctuation\">,\u003C/span> \u003Cspan class=\"token function-variable function\">abortCallback\u003C/span>\u003Cspan class=\"token operator\">:\u003C/span> \u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token operator\">=>\u003C/span> \u003Cspan class=\"token keyword\">void\u003C/span>\u003Cspan class=\"token punctuation\">]\u003C/span> \u003Cspan class=\"token operator\">=>\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>Or you can return the callback array \u003Ccode>as const\u003C/code>.\u003C/p>\n\u003Cpre class=\"language-ts\">\u003Ccode class=\"language-ts code-highlight\">\u003Cspan class=\"code-line line-number\" line=\"1\">  \u003Cspan class=\"token keyword\">return\u003C/span> \u003Cspan class=\"token punctuation\">[\u003C/span>callback\u003Cspan class=\"token punctuation\">,\u003C/span> abort\u003Cspan class=\"token punctuation\">]\u003C/span> \u003Cspan class=\"token keyword\">as\u003C/span> \u003Cspan class=\"token keyword\">const\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>Now the callbacks have correct typings :)\u003C/p>\n\u003Cp>If you want \u003Ccode>AbortController\u003C/code> to be the last parameter\nin your Typescript code, it is a little tricky write,\nbut it is absolutely possible.\u003C/p>\n\u003Cpre class=\"language-ts\">\u003Ccode class=\"language-ts code-highlight\">\u003Cspan class=\"code-line line-number\" line=\"1\">\u003Cspan class=\"token keyword\">type\u003C/span> \u003Cspan class=\"token class-name\">ArgsWithController\u003Cspan class=\"token operator\">&#x3C;\u003C/span>\u003Cspan class=\"token constant\">T\u003C/span> \u003Cspan class=\"token keyword\">extends\u003C/span> \u003Cspan class=\"token builtin\">unknown\u003C/span>\u003Cspan class=\"token punctuation\">[\u003C/span>\u003Cspan class=\"token punctuation\">]\u003C/span>\u003Cspan class=\"token operator\">>\u003C/span>\u003C/span> \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token punctuation\">[\u003C/span>\u003Cspan class=\"token operator\">...\u003C/span>\u003Cspan class=\"token constant\">T\u003C/span>\u003Cspan class=\"token punctuation\">,\u003C/span> AbortController\u003Cspan class=\"token punctuation\">]\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"2\">\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"3\">\u003Cspan class=\"token keyword\">const\u003C/span> useAbortController \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token operator\">&#x3C;\u003C/span>Args \u003Cspan class=\"token keyword\">extends\u003C/span> \u003Cspan class=\"token class-name\">\u003Cspan class=\"token builtin\">unknown\u003C/span>\u003C/span>\u003Cspan class=\"token punctuation\">[\u003C/span>\u003Cspan class=\"token punctuation\">]\u003C/span>\u003Cspan class=\"token punctuation\">,\u003C/span> Ret\u003Cspan class=\"token operator\">>\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"4\">  \u003Cspan class=\"token punctuation\">(\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"5\">    \u003Cspan class=\"token function-variable function\">cb\u003C/span>\u003Cspan class=\"token operator\">:\u003C/span> \u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token operator\">...\u003C/span>args\u003Cspan class=\"token operator\">:\u003C/span> ArgsWithController\u003Cspan class=\"token operator\">&#x3C;\u003C/span>Args\u003Cspan class=\"token operator\">>\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token operator\">=>\u003C/span> Ret\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"6\">  \u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token operator\">:\u003C/span> \u003Cspan class=\"token punctuation\">[\u003C/span>\u003Cspan class=\"token function-variable function\">callback\u003C/span>\u003Cspan class=\"token operator\">:\u003C/span> \u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token operator\">...\u003C/span>args\u003Cspan class=\"token operator\">:\u003C/span> Args\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token operator\">=>\u003C/span> Ret\u003Cspan class=\"token punctuation\">,\u003C/span> \u003Cspan class=\"token function-variable function\">abortCallback\u003C/span>\u003Cspan class=\"token operator\">:\u003C/span> \u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token operator\">=>\u003C/span> \u003Cspan class=\"token keyword\">void\u003C/span>\u003Cspan class=\"token punctuation\">]\u003C/span> \u003Cspan class=\"token operator\">=>\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"7\">  \u003Cspan class=\"token keyword\">const\u003C/span> controllerRef \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token function\">useRef\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token keyword\">new\u003C/span> \u003Cspan class=\"token class-name\">AbortController\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"8\">\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"9\">  \u003Cspan class=\"token keyword\">const\u003C/span> callback \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token function\">useCallback\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token operator\">...\u003C/span>cbArgs\u003Cspan class=\"token operator\">:\u003C/span> Args\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token operator\">=>\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"10\">    \u003Cspan class=\"token keyword\">const\u003C/span> controller \u003Cspan class=\"token operator\">=\u003C/span> controllerRef\u003Cspan class=\"token punctuation\">.\u003C/span>current\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"11\">    \u003Cspan class=\"token keyword\">return\u003C/span> \u003Cspan class=\"token function\">cb\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token operator\">...\u003C/span>cbArgs\u003Cspan class=\"token punctuation\">,\u003C/span> controller\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"12\">  \u003Cspan class=\"token punctuation\">}\u003C/span>\u003Cspan class=\"token punctuation\">,\u003C/span> \u003Cspan class=\"token punctuation\">[\u003C/span>cb\u003Cspan class=\"token punctuation\">]\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"13\">\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"14\">  \u003Cspan class=\"token keyword\">const\u003C/span> abort \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token function\">useCallback\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token operator\">=>\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"15\">    controllerRef\u003Cspan class=\"token punctuation\">.\u003C/span>current\u003Cspan class=\"token punctuation\">.\u003C/span>\u003Cspan class=\"token function\">abort\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"16\">    controllerRef\u003Cspan class=\"token punctuation\">.\u003C/span>current \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token keyword\">new\u003C/span> \u003Cspan class=\"token class-name\">AbortController\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"17\">  \u003Cspan class=\"token punctuation\">}\u003C/span>\u003Cspan class=\"token punctuation\">,\u003C/span> \u003Cspan class=\"token punctuation\">[\u003C/span>\u003Cspan class=\"token punctuation\">]\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"18\">\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"19\">  \u003Cspan class=\"token keyword\">return\u003C/span> \u003Cspan class=\"token punctuation\">[\u003C/span>callback\u003Cspan class=\"token punctuation\">,\u003C/span> abort\u003Cspan class=\"token punctuation\">]\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"20\">\u003Cspan class=\"token punctuation\">}\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>I want to point out that Typescript exists to help you.\nIf you do not reuse the same logics or do not find it useful,\nyou are 100% fine not to use Typescript.\nBut once you write Typescript code that have concrete typings,\nit will save you for many times.\u003C/p>",frontmatter:{toc:true,title:"useAbortController Hook",category:["Programming"],tags:["web","react","javascript","typescript"],author:["Ïù¥ÌòÑÏû¨"]},date:"2023-10-26",lang:"en",id:"10-26-en-useAbortController-hook",tocData:[{depth:1,id:"1-useEffect-with-AbortController",text:"useEffect with AbortController"},{depth:1,id:"2-Custom-Hook-with-AbortController",text:"Custom Hook with AbortController"},{depth:1,id:"3-Advanced-Custom-Hook-with-AbortController",text:"Advanced Custom Hook with AbortController"},{depth:2,id:"4-Return-Callback-and-Abort-Function",text:"Return Callback and Abort Function"},{depth:2,id:"5-Manage-AbortController-with-useRef",text:"Manage AbortController with useRef"},{depth:1,id:"6-Pass-AbortController-to-Callback-as-a-Parameter",text:"Pass AbortController to Callback as a Parameter"},{depth:2,id:"7-Pass-Other-Arguments-as-Parameters-Together",text:"Pass Other Arguments as Parameters Together"},{depth:3,id:"8-Typing-with-Typescript",text:"Typing with Typescript"}],langs:["ko","en"]},"uses":{"params":["year","slug"]}}];

					Promise.all([
						import("../../../_app/immutable/entry/start.c83bda82.js"),
						import("../../../_app/immutable/entry/app.3a72c247.js")
					]).then(([kit, app]) => {
						kit.start(app, element, {
							node_ids: [0, 5],
							data,
							form: null,
							error: null
						});
					});
				}
			</script>
		</div>
	</body>
</html>
