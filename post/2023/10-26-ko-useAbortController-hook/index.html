<!DOCTYPE html>
<html lang="ko">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" href="../../../favicon.ico" />
		<meta name="viewport" content="width=device-width" />
		
		<link href="../../../_app/immutable/assets/0.fcd7d0f0.css" rel="stylesheet">
		<link rel="modulepreload" href="../../../_app/immutable/entry/start.7b02dd09.js">
		<link rel="modulepreload" href="../../../_app/immutable/chunks/scheduler.6402f0dd.js">
		<link rel="modulepreload" href="../../../_app/immutable/chunks/singletons.15171e31.js">
		<link rel="modulepreload" href="../../../_app/immutable/chunks/index.1b92e39a.js">
		<link rel="modulepreload" href="../../../_app/immutable/entry/app.beba005d.js">
		<link rel="modulepreload" href="../../../_app/immutable/chunks/index.0cc09f3a.js">
		<link rel="modulepreload" href="../../../_app/immutable/nodes/0.4aa59b97.js">
		<link rel="modulepreload" href="../../../_app/immutable/chunks/index.a82faf3f.js">
		<link rel="modulepreload" href="../../../_app/immutable/chunks/GithubMark.5170f17a.js">
		<link rel="modulepreload" href="../../../_app/immutable/chunks/store.be990f37.js">
		<link rel="modulepreload" href="../../../_app/immutable/nodes/5.e38b54f4.js">
		<link rel="modulepreload" href="../../../_app/immutable/chunks/each.e59479a4.js">
		<link rel="modulepreload" href="../../../_app/immutable/chunks/Category.a9d34eee.js">
		<link rel="modulepreload" href="../../../_app/immutable/chunks/MainSection.4262151e.js"><title>useAbortController 훅 : dlguswo333&#39;s blog</title><!-- HEAD_svelte-etxm8u_START --><!-- HEAD_svelte-etxm8u_END -->
		<!-- [TODO] For portability I can erase the following elements and inject them from index.ts when building? -->
		<title>dlguswo333's Blog</title>
		<meta name="google-site-verification" content="GIhlBkE7qu5AWLVmQ4w2lBcxEw-AumQhdQf_2zR2X4s" />
	</head>
	<body data-sveltekit-preload-data="hover">
		<script>
			const systemTheme= window.matchMedia('(prefers-color-scheme:dark)').matches ? 'dark' : 'light';
			const rootElement = document.querySelector('body');
			try {
				const storedValue = JSON.parse(localStorage.getItem('color-theme') || 'null');
				const currentTheme = storedValue === 'light' || storedValue === 'dark' ? storedValue : systemTheme;
				if(rootElement) {
  				rootElement.classList.add(currentTheme);
				}
			} catch {
				rootElement.classList.add(systemTheme);
			}
		</script>
		<div id="root">  <header class="z-10 p-2 sticky top-0 flex flex-row items-center justify-between border-b border-b-gray-300 bg-gray-50 dark:bg-[#2c3039] dark:border-b-gray-700"><div class="flex flex-row items-center gap-1"> <a href="/" class="inline-block h-8 w-8" data-svelte-h="svelte-htzscq"><span class="hidden">Go To Home</span> <img src="/favicon.svg" alt="Logo"></a> <button type="button" title="Toggle color theme" class="group"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" class="h-8 w-8 transition"><rect x="3" y="3" width="94" height="94" stroke-width="6" rx="16" ry="16" class="stroke-gray-600 fill-none"></rect></svg></button> </div> <div class="flex flex-row items-center"><a href="/categories/" class="h-8 flex items-center justify-center mr-2 last:mr-1 px-1 py-0.5 rounded hover:bg-gray-200 dark:hover:bg-slate-600 dark:hover:text-white">Categories</a> <a href="/tags/" class="h-8 flex items-center justify-center mr-2 last:mr-1 px-1 py-0.5 rounded hover:bg-gray-200 dark:hover:bg-slate-600 dark:hover:text-white">Tags</a> <a href="/about/" class="h-8 flex items-center justify-center mr-2 last:mr-1 px-1 py-0.5 rounded hover:bg-gray-200 dark:hover:bg-slate-600 dark:hover:text-white">About</a></div></header>  <div class="flex flex-row flex-grow justify-center p-2 lg:p-0 lg:pr-[300px]"> <aside class="w-[300px] overflow-hidden hidden mt-10 self-start md:!flex md:sticky md:top-14 flex-col justify-center items-center p-3
  "><div class="relative w-full"><ul class="max-h-[80vh] overflow-auto"> <li title="useEffect 내 AbortController" class="flex border-l-4 border-transparent hover:border-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 font-bold 
        "><a href="#1-useEffect-내-AbortController" class="relative z-10 py-0.5 whitespace-nowrap overflow-hidden break-all overflow-ellipsis flex-grow" style="padding-left: 0.3rem;">useEffect 내 AbortController</a> </li> <li title="AbortController 커스텀 훅으로 만들기" class="flex border-l-4 border-transparent hover:border-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 font-bold 
        "><a href="#2-AbortController-커스텀-훅으로-만들기" class="relative z-10 py-0.5 whitespace-nowrap overflow-hidden break-all overflow-ellipsis flex-grow" style="padding-left: 0.3rem;">AbortController 커스텀 훅으로 만들기</a> </li> <li title="더 고도화된 AbortController 커스텀 훅 만들기" class="flex border-l-4 border-transparent hover:border-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 font-bold 
        "><a href="#3-더-고도화된-AbortController-커스텀-훅-만들기" class="relative z-10 py-0.5 whitespace-nowrap overflow-hidden break-all overflow-ellipsis flex-grow" style="padding-left: 0.3rem;">더 고도화된 AbortController 커스텀 훅 만들기</a> </li> <li title="콜백과 Abort 함수를 리턴하기" class="flex border-l-4 border-transparent hover:border-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700  
        "><a href="#4-콜백과-Abort-함수를-리턴하기" class="relative z-10 py-0.5 whitespace-nowrap overflow-hidden break-all overflow-ellipsis flex-grow" style="padding-left: 0.9666666666666666rem;">콜백과 Abort 함수를 리턴하기</a> </li> <li title="useRef로 AbortController 관리하기" class="flex border-l-4 border-transparent hover:border-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700  
        "><a href="#5-useRef로-AbortController-관리하기" class="relative z-10 py-0.5 whitespace-nowrap overflow-hidden break-all overflow-ellipsis flex-grow" style="padding-left: 0.9666666666666666rem;">useRef로 AbortController 관리하기</a> </li> <li title="AbortController를 콜백의 파라미터로 전달하기" class="flex border-l-4 border-transparent hover:border-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 font-bold 
        "><a href="#6-AbortController를-콜백의-파라미터로-전달하기" class="relative z-10 py-0.5 whitespace-nowrap overflow-hidden break-all overflow-ellipsis flex-grow" style="padding-left: 0.3rem;">AbortController를 콜백의 파라미터로 전달하기</a> </li> <li title="파라미터의 콜백에 다른 인자도 전달하기" class="flex border-l-4 border-transparent hover:border-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700  
        "><a href="#7-파라미터의-콜백에-다른-인자도-전달하기" class="relative z-10 py-0.5 whitespace-nowrap overflow-hidden break-all overflow-ellipsis flex-grow" style="padding-left: 0.9666666666666666rem;">파라미터의 콜백에 다른 인자도 전달하기</a> </li> <li title="Typescript로 타이핑 하기" class="flex border-l-4 border-transparent hover:border-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700  
        "><a href="#8-Typescript로-타이핑-하기" class="relative z-10 py-0.5 whitespace-nowrap overflow-hidden break-all overflow-ellipsis flex-grow" style="padding-left: 1.6333333333333333rem;">Typescript로 타이핑 하기</a> </li></ul> </div></aside>  <div class="flex flex-col justify-center min-w-0 my-10 md:my-15"><div class="max-w-[900px] flex flex-col items-center py-6 gap-3"><h1 class="text-4xl font-bold text-center">useAbortController 훅</h1> <span>2023-10-26 </span> <button class="px-2 py-0.5 rounded-lg shadow-md shadow-emerald-50 border-l-slate-100 bg-sky-300 text-white hover:bg-sky-500 dark:shadow-emerald-900 transition">/Programming</button> <div><button class="last:mr-0 bg-green-100 hover:bg-green-400 hover:text-white dark:text-black transition px-2 py-0.5 rounded-xl shadow-md dark:shadow-green-900 my-0.5" style="margin-right: 0.25rem; margin-left: 0.5rem">#web</button><button class="last:mr-0 bg-green-100 hover:bg-green-400 hover:text-white dark:text-black transition px-2 py-0.5 rounded-xl shadow-md dark:shadow-green-900 my-0.5" style="margin-right: 0.25rem; margin-left: 0rem">#react</button><button class="last:mr-0 bg-green-100 hover:bg-green-400 hover:text-white dark:text-black transition px-2 py-0.5 rounded-xl shadow-md dark:shadow-green-900 my-0.5" style="margin-right: 0.25rem; margin-left: 0rem">#javascript</button><button class="last:mr-0 bg-green-100 hover:bg-green-400 hover:text-white dark:text-black transition px-2 py-0.5 rounded-xl shadow-md dark:shadow-green-900 my-0.5" style="margin-right: 0.25rem; margin-left: 0rem">#typescript</button></div> <div>🌐
            <a class="last:mr-0 my-0.5 transition px-2 py-0.5 rounded-md border-2
    bg-lime-100 dark:text-black dark:shadow-green-900
    border-yellow-300 shadow-inner cursor-default bg-lime-50" href="/post/2023/10-26-ko-useAbortController-hook/" style="margin-right: 0.25rem; margin-left: 0.25rem">ko</a><a class="last:mr-0 my-0.5 transition px-2 py-0.5 rounded-md border-2
    bg-lime-100 dark:text-black dark:shadow-green-900
    shadow-md hover:text-white hover:bg-lime-400" href="/post/2023/10-26-en-useAbortController-hook/" style="margin-right: 0.25rem; margin-left: 0.25rem">en</a></div></div> <hr class="bg-gray-400 my-4">  <main class="max-w-[900px] w-full py-2 post"> <!-- HTML_TAG_START --><p>리액트 프로젝트를 진행하다 보면 fetch 리퀘스트를 보내야 할 때가 오죠.
그럴 때는 <code>useEffect</code> 내에서 API를 호출하라는 말을 하곤 합니다.
데이터를 가져오는 것은 리액트 컴포넌트의 수명 주기와 깊은 연관이 있기 때문입니다.</p>
<blockquote>
<p><strong>Fetching data with Effects</strong><br>
You can use an Effect to fetch data for your component.
...
Writing data fetching directly in Effects gets repetitive and makes it difficult to add optimizations like caching and server rendering later. It’s easier to use a custom Hook—either your own or maintained by the community.<br>
<a href="https://react.dev/reference/react/useEffect#fetching-data-with-effects">https://react.dev/reference/react/useEffect#fetching-data-with-effects</a></p>
</blockquote>
<p>또한, 리퀘스트를 취소하기 위해 boolean 값 또는 <code>AbortController</code>를 사용할 수 있습니다.
이는 원치 않는 <code>race condition</code>도 예방해줄 수 있죠.</p>
<blockquote>
<p>Note the <code>ignore</code> variable which is initialized to <code>false</code>, and is set to <code>true</code> during cleanup. This ensures your code doesn’t suffer from “race conditions”: network responses may arrive in a different order than you sent them.<br>
<a href="https://react.dev/reference/react/useEffect#fetching-data-with-effects">https://react.dev/reference/react/useEffect#fetching-data-with-effects</a></p>
</blockquote>
<p>boolean 값 하나로도 충분하긴 하지만
진행 중인 fetch 리퀘스트도 취소할 수 있는 기능이 있는
<code>AbortController</code>가 더 나은 옵션이라 할 수 있습니다.</p>
<blockquote>
<p>The abort() method of the AbortController interface aborts a DOM request before it has completed. This is able to abort fetch requests, the consumption of any response bodies, or streams.<br>
<a href="https://developer.mozilla.org/en-US/docs/Web/API/AbortController/abort">https://developer.mozilla.org/en-US/docs/Web/API/AbortController/abort</a></p>
</blockquote>
<p>이번 포스트에선 <code>AbortController</code>를 쓰는 법, 그리고 리액트 프로젝트에서 공통 로직과 코드를 훅으로
분리해 재활용하는 여러 가지 방법을 소개합니다.</p>
<h1 id="1-useEffect-내-AbortController">useEffect 내 AbortController</h1>
<p>다음 코드는 fetch 리퀘스트를 <code>AbortController</code>와 함께 <code>useEffect</code> 내에서 사용하는 예시입니다.</p>
<pre class="language-js"><code class="language-js code-highlight"><span class="code-line line-number" line="1"><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="2">  <span class="token keyword">const</span> controller <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AbortController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="3">  <span class="token keyword">const</span> <span class="token function-variable function">search</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="4">    <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword control-flow">await</span> axios<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">'/search'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="5">      <span class="token literal-property property">params</span><span class="token operator">:</span> <span class="token punctuation">{</span>keyword<span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="6">      <span class="token literal-property property">signal</span><span class="token operator">:</span> controller<span class="token punctuation">.</span><span class="token property-access">signal</span>
</span><span class="code-line line-number" line="7">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="8">    <span class="token function">setSearchResult</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="9">  <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="10">  <span class="token function">search</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="11">
</span><span class="code-line line-number" line="12">  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="13">    controller<span class="token punctuation">.</span><span class="token method function property-access">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="14">  <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="15"><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>keyword<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></code></pre>
<p>이 포스트에선 <code>axios</code>를 사용해 데이터를 가져옵니다.
<code>axios</code>는 <code>AbortController.signal</code>을 두번째 파라미터 오브젝트의 <code>signal</code> 속성으로 건네 주어야 합니다.
자세한 내용은 <a href="https://axios-http.com/docs/cancellation"><code>axios</code> 문서</a>를 참고하세요.</p>
<p><code>keyword</code> state가 바뀔 때마다, cleanup 함수가 실행되면서
진행 중인 fetch 리퀘스트를 취소하고 에러를 던집니다.
이 에러에 의해 아래 줄의 <code>setSearchResult(result)</code>가 실행 되지 않고 스킵되는 것입니다.
또한 취소 시 발생하는 <code>AbortError</code>를 처리하기 위해, 또는 의도치 않은 네트워크 에러 등을 방지하기 위해서라도
try catch로 감싸는 것이 바람직합니다.</p>
<blockquote>
<p>When abort() is called, the fetch() promise rejects with a <code>DOMException</code> named <code>AbortError</code>.<br>
<a href="https://developer.mozilla.org/en-US/docs/Web/API/AbortController">https://developer.mozilla.org/en-US/docs/Web/API/AbortController</a></p>
</blockquote>
<pre class="language-js"><code class="language-js code-highlight"><span class="code-line line-number" line="1"><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="2">  <span class="token keyword">const</span> controller <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AbortController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="3">  <span class="token keyword">const</span> <span class="token function-variable function">search</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="4">    <span class="token keyword control-flow">try</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="5">      <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword control-flow">await</span> axios<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">'/search'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="6">        <span class="token literal-property property">params</span><span class="token operator">:</span> <span class="token punctuation">{</span>keyword<span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="7">        <span class="token literal-property property">signal</span><span class="token operator">:</span> controller<span class="token punctuation">.</span><span class="token property-access">signal</span>
</span><span class="code-line line-number" line="8">      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="9">      <span class="token function">setSearchResult</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="10">    <span class="token punctuation">}</span> <span class="token keyword control-flow">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="11">      <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>e <span class="token keyword">instanceof</span> <span class="token class-name">Error</span> <span class="token operator">&#x26;&#x26;</span> e<span class="token punctuation">.</span><span class="token property-access">name</span> <span class="token operator">===</span> <span class="token string">'AbortError'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="12">        <span class="token comment">// Handle AbortError</span>
</span><span class="code-line line-number" line="13">      <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="14">        <span class="token comment">// Handle other errors</span>
</span><span class="code-line line-number" line="15">      <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="16">    <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="17">  <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="18">  <span class="token function">search</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="19">
</span><span class="code-line line-number" line="20">  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="21">    controller<span class="token punctuation">.</span><span class="token method function property-access">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="22">  <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="23"><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>keyword<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></code></pre>
<h1 id="2-AbortController-커스텀-훅으로-만들기">AbortController 커스텀 훅으로 만들기</h1>
<p>만약 코드를 커스텀 훅으로 재활용하고 싶다면 다음과 같이 가능하겠죠.</p>
<pre class="language-js"><code class="language-js code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">const</span> useAbortController <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> params<span class="token punctuation">,</span> onFetchComplete<span class="token punctuation">,</span> onError</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="2">  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="3">    <span class="token keyword">const</span> controller <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AbortController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="4">    <span class="token keyword">const</span> <span class="token function-variable function">search</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="5">      <span class="token keyword control-flow">try</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="6">        <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword control-flow">await</span> axios<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="7">          params<span class="token punctuation">,</span>
</span><span class="code-line line-number" line="8">          <span class="token literal-property property">signal</span><span class="token operator">:</span> controller<span class="token punctuation">.</span><span class="token property-access">signal</span>
</span><span class="code-line line-number" line="9">        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="10">        <span class="token function">onFetchComplete</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="11">      <span class="token punctuation">}</span> <span class="token keyword control-flow">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="12">        <span class="token function">onError</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="13">      <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="14">    <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="15">    <span class="token function">search</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="16">
</span><span class="code-line line-number" line="17">    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="18">      controller<span class="token punctuation">.</span><span class="token method function property-access">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="19">    <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="20">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="21"><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>url<span class="token punctuation">,</span> params<span class="token punctuation">,</span> onFetchComplete<span class="token punctuation">,</span> onError<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></code></pre>
<p>이 훅은 이렇게 사용할 수 있습니다.</p>
<pre class="language-js"><code class="language-js code-highlight"><span class="code-line line-number" line="1"><span class="token function">useAbortController</span><span class="token punctuation">(</span><span class="token string">'/search'</span><span class="token punctuation">,</span> params<span class="token punctuation">,</span> setSearchResult<span class="token punctuation">,</span> onError<span class="token punctuation">)</span>
</span></code></pre>
<p>하지만 각 argument의 stability를 보장해야 합니다.
만약 리렌더링 때마다 각 argument가 재생성되어 리액트가 <strong>변경</strong> 되었다고 판단 시
매번 <code>useEffect</code>가 실행 되므로 불필요한 리퀘스트, 최악의 경우 무한 리렌더링이 발생할 수 있습니다.</p>
<p>또한 이 훅은 <code>search</code>와 <code>abort</code> 콜백을 필요할 때 부를 수 없다는 단점이 있습니다.
시작/취소 버튼을 클릭할 때와 같이 콜백을 필요할 때 부를 경우가 있을텐데요,
해당 훅은 콜백을 <code>useEffect</code>에 감싸고 외부에 노출하지 않기 때문에 원할 때 부르는 것이 불가능합니다.</p>
<h1 id="3-더-고도화된-AbortController-커스텀-훅-만들기">더 고도화된 AbortController 커스텀 훅 만들기</h1>
<h2 id="4-콜백과-Abort-함수를-리턴하기">콜백과 Abort 함수를 리턴하기</h2>
<p>따라서 커스텀 훅이 내부적으로 fetch 리퀘스트를 알아서 부르기 보다는,
리퀘스트를 <code>AbortController</code>와 함께 동작하도록 고도화 한 함수를 만들어
abort 함수와 함께 호출 컴포넌트에게 전달해 주어야 합니다.</p>
<pre class="language-jsx"><code class="language-jsx code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">const</span> <span class="token punctuation">[</span>search<span class="token punctuation">,</span> abortSearch<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useAbortController</span><span class="token punctuation">(</span>
</span><span class="code-line line-number" line="2">  url<span class="token punctuation">,</span>
</span><span class="code-line line-number" line="3">  params<span class="token punctuation">,</span>
</span><span class="code-line line-number" line="4">  setSearchResult<span class="token punctuation">,</span>
</span><span class="code-line line-number" line="5">  onError<span class="token punctuation">,</span>
</span><span class="code-line line-number" line="6"><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="7">
</span><span class="code-line line-number" line="8"><span class="token comment">// Use it like this:</span>
</span><span class="code-line line-number" line="9"><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>search<span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">Search</span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>button</span><span class="token punctuation">></span></span>
</span><span class="code-line line-number" line="10"><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>abortSearch<span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">Abort Search</span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>button</span><span class="token punctuation">></span></span>
</span></code></pre>
<p>우리가 만들 훅은 리액트의 <code>useCallback</code>을 사용해 두 콜백을 생성해야 합니다.
또한 동일 <code>AbortController</code> 인스턴스를 <code>useState</code>를 사용해 두 콜백 간 공유할 수 있어야 합니다.</p>
<pre class="language-js"><code class="language-js code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">const</span> useAbortController <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> params<span class="token punctuation">,</span> onFetchComplete<span class="token punctuation">,</span> onError</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="2">  <span class="token keyword">const</span> <span class="token punctuation">[</span>controller<span class="token punctuation">,</span> setController<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">AbortController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="3">
</span><span class="code-line line-number" line="4">  <span class="token keyword">const</span> request <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="5">    <span class="token keyword control-flow">try</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="6">      <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword control-flow">await</span> axios<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="7">        params<span class="token punctuation">,</span>
</span><span class="code-line line-number" line="8">        <span class="token literal-property property">signal</span><span class="token operator">:</span> controller<span class="token punctuation">.</span><span class="token property-access">signal</span>
</span><span class="code-line line-number" line="9">      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="10">      <span class="token function">onFetchComplete</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="11">    <span class="token punctuation">}</span> <span class="token keyword control-flow">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="12">      <span class="token function">onError</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="13">    <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="14">  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>controller<span class="token punctuation">,</span> url<span class="token punctuation">,</span> params<span class="token punctuation">,</span> onFetchComplete<span class="token punctuation">,</span> onError<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="15">
</span><span class="code-line line-number" line="16">  <span class="token keyword">const</span> abortRequest <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="17">    controller<span class="token punctuation">.</span><span class="token method function property-access">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="18">    <span class="token comment">// Create a new AbortController,</span>
</span><span class="code-line line-number" line="19">    <span class="token comment">// since you cannot use same AbortController more than once.</span>
</span><span class="code-line line-number" line="20">    <span class="token function">setController</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">AbortController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="21">  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>controller<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="22">
</span><span class="code-line line-number" line="23">  <span class="token keyword control-flow">return</span> <span class="token punctuation">[</span>callback<span class="token punctuation">,</span> abort<span class="token punctuation">]</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="24"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></code></pre>
<p>하지만 위 훅에는 결함이 하나 있는데, 바로 <code>AbortController</code>가 <code>state</code>로 관리 된다는 것입니다.
한번 <code>AbortController.abort()</code>를 호출하면 그 컨트롤러는 재사용할 수 없죠.
따라서 <code>AbortController.abort()</code> 호출 후 새로운 <code>AbortController</code>를 생성해 다음 abort에 사용해야 합니다.
그러므로 최신 <code>AbortController</code>를 사용하기 위해선 두 콜백이 <code>controller</code> state에 의존해야 합니다.
이 의존성은 불필요한 리렌더링이라는 문제를 만들어 냅니다.</p>
<ol>
<li><code>abortRequest()</code> 콜백 호출.</li>
<li><code>controller</code> state 갱신.</li>
<li><code>request</code>와 <code>abortRequest</code> 콜백 갱신.</li>
<li>훅을 사용하는 컴포넌트와 그 자식 컴포넌트들 리렌더링.</li>
</ol>
<p>게다가 <code>request</code> state에 의존하는 이 콜백을 <code>useEffect</code> 내에서 부르면
또 다른 이슈가 발생합니다.
abort 콜백 호출 시 effect는 우리의 의도와는 상관 없이 무조건 재실행합니다.
또한 effect 내에선 <code>request</code>를 호출하고 그 effect의 cleanup 함수에서 <code>abort</code>를 호출하면
무한 리렌더링이 발생합니다.
이러한 동작들은 훅의 내부 로직에 의한 것이기 때문에
내부를 볼 수 없는 훅을 사용하는 입장에선 굉장히 혼란스러울 것입니다.</p>
<pre class="language-jsx"><code class="language-jsx code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">const</span> <span class="token punctuation">[</span>search<span class="token punctuation">,</span> abortSearch<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useAbortController</span><span class="token punctuation">(</span>
</span><span class="code-line line-number" line="2">  url<span class="token punctuation">,</span>
</span><span class="code-line line-number" line="3">  params<span class="token punctuation">,</span>
</span><span class="code-line line-number" line="4">  setSearchResult<span class="token punctuation">,</span>
</span><span class="code-line line-number" line="5">  onError<span class="token punctuation">,</span>
</span><span class="code-line line-number" line="6"><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="7">
</span><span class="code-line line-number" line="8"><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="9">  <span class="token function">search</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="10">
</span><span class="code-line line-number" line="11">  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="12">    <span class="token function">abortSearch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="13">  <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="14"><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>search<span class="token punctuation">,</span> abortSearch<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="15">
</span><span class="code-line line-number" line="16"><span class="token comment">// All I want to do is cancel searching,</span>
</span><span class="code-line line-number" line="17"><span class="token comment">// but search API is called when the button is pressed?</span>
</span><span class="code-line line-number" line="18"><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>abortSearch<span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">Cancel Search</span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>button</span><span class="token punctuation">></span></span>
</span></code></pre>
<h2 id="5-useRef로-AbortController-관리하기">useRef로 AbortController 관리하기</h2>
<p><code>AbortController</code>를 <code>useState</code>가 아닌 <code>useRef</code>로 관리하면
리렌더링 이슈를 해결할 수 있습니다.</p>
<pre class="language-js"><code class="language-js code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">const</span> useAbortController <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> params<span class="token punctuation">,</span> onFetchComplete<span class="token punctuation">,</span> onError</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="2">  <span class="token keyword">const</span> controllerRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">AbortController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="3">
</span><span class="code-line line-number" line="4">  <span class="token keyword">const</span> request <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="5">    <span class="token keyword control-flow">try</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="6">      <span class="token keyword">const</span> signal <span class="token operator">=</span> controllerRef<span class="token punctuation">.</span><span class="token property-access">current</span><span class="token punctuation">.</span><span class="token property-access">signal</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="7">      <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword control-flow">await</span> axios<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="8">        params<span class="token punctuation">,</span>
</span><span class="code-line line-number" line="9">        signal
</span><span class="code-line line-number" line="10">      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="11">      onFetchComplete<span class="token operator">?.</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="12">    <span class="token punctuation">}</span> <span class="token keyword control-flow">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="13">      onError<span class="token operator">?.</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="14">    <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="15">  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>url<span class="token punctuation">,</span> params<span class="token punctuation">,</span> onFetchComplete<span class="token punctuation">,</span> onError<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="16">
</span><span class="code-line line-number" line="17">  <span class="token keyword">const</span> abortRequest <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="18">    controllerRef<span class="token punctuation">.</span><span class="token property-access">current</span><span class="token punctuation">.</span><span class="token method function property-access">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="19">    controllerRef<span class="token punctuation">.</span><span class="token property-access">current</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AbortController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="20">  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="21">
</span><span class="code-line line-number" line="22">  <span class="token keyword control-flow">return</span> <span class="token punctuation">[</span>callback<span class="token punctuation">,</span> abort<span class="token punctuation">]</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="23"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></code></pre>
<p>이제 리렌더링 이슈에서 해방되었습니다.
<code>request</code> 콜백 내 <code>signal</code> 변수가 새로 정의된 것에 주의하세요.
<code>abort</code> 콜백은 <code>controllerRef.current</code>를 업데이트 합니다.
따라서 <code>abort</code> 콜백 호출 후, <code>fetch</code> 함수 내 <code>controllerRef.current</code>는
우리가 원하는 <code>AbortController</code>가 아닐 수도 있다는 것이죠.
만약 <code>fetch</code> 전 <code>abort</code> 콜백을 호출했다면 <code>fetch</code>가 참조하는
<code>AbortController</code>는 새 인스턴스일 수 있으며 그렇다면
방금 호출한 <code>abort</code>는 리퀘스트를 취소하지 못합니다.
따라서 <code>fetch</code> 호출 직전 <code>controllerRef.current</code>를 다른 변수에
저장해 사용해야 합니다.</p>
<h1 id="6-AbortController를-콜백의-파라미터로-전달하기">AbortController를 콜백의 파라미터로 전달하기</h1>
<p>유연성을 더 높이기 위해 url이 아니라, <code>AbortController</code>를 받는 콜백을
훅의 파라미터로 받을 수도 있습니다.
이렇게 되면 <code>url</code>, <code>params</code>, <code>onFetchComplete</code>, <code>onError</code>
이렇게 파라미터 여러 개가 아닌 파라미터로 넘겨줄 콜백 하나에서 전부 처리가 가능합니다.</p>
<pre class="language-js"><code class="language-js code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">const</span> searchWithAbortController <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span>
</span><span class="code-line line-number" line="2">  <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">abortController</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="3">    <span class="token keyword control-flow">try</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="4">      <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword control-flow">await</span> axios<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">'/search'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="5">        <span class="token literal-property property">signal</span><span class="token operator">:</span> abortController<span class="token punctuation">.</span><span class="token property-access">signal</span>
</span><span class="code-line line-number" line="6">      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="7">      <span class="token comment">// Handle result</span>
</span><span class="code-line line-number" line="8">    <span class="token punctuation">}</span> <span class="token keyword control-flow">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="9">      <span class="token comment">// Handle errors</span>
</span><span class="code-line line-number" line="10">    <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="11">  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="12">
</span><span class="code-line line-number" line="13"><span class="token keyword">const</span> <span class="token punctuation">[</span>search<span class="token punctuation">,</span> abortSearch<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useAbortController</span><span class="token punctuation">(</span>searchWithAbortController<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></code></pre>
<p>이러한 훅은 다음과 같이 정의할 수 있습니다.
이 훅의 역할은 파라미터로 받은 콜백에 <code>AbortController</code>를 바르는 게 다입니다.
훅을 호출하는 쪽에 응답과 에러를 처리하도록 역할을 넘겼기 때문에 훅의 코드가 굉장히 간결합니다.
하지만 반대로 호출하는 쪽의 코드가 더 복잡해지겠죠.</p>
<pre class="language-js"><code class="language-js code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">const</span> useAbortController <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">cb</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="2">  <span class="token keyword">const</span> controllerRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">AbortController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="3">
</span><span class="code-line line-number" line="4">  <span class="token keyword">const</span> callback <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="5">    <span class="token keyword">const</span> controller <span class="token operator">=</span> controllerRef<span class="token punctuation">.</span><span class="token property-access">current</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="6">    <span class="token keyword control-flow">return</span> <span class="token function">cb</span><span class="token punctuation">(</span>controller<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="7">  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>cb<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="8">
</span><span class="code-line line-number" line="9">  <span class="token keyword">const</span> abort <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="10">    controllerRef<span class="token punctuation">.</span><span class="token property-access">current</span><span class="token punctuation">.</span><span class="token method function property-access">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="11">    controllerRef<span class="token punctuation">.</span><span class="token property-access">current</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AbortController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="12">  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="13">
</span><span class="code-line line-number" line="14">  <span class="token keyword control-flow">return</span> <span class="token punctuation">[</span>callback<span class="token punctuation">,</span> abort<span class="token punctuation">]</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="15"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></code></pre>
<h2 id="7-파라미터의-콜백에-다른-인자도-전달하기">파라미터의 콜백에 다른 인자도 전달하기</h2>
<p>여기서 더 고도화를 해보죠. 콜백이 <code>AbortController</code> 뿐 아니라
다른 인자도 받을 수 있으면 얼마나 좋을까요?</p>
<pre class="language-js"><code class="language-js code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">const</span> useAbortController <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">cb</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="2">  <span class="token keyword">const</span> controllerRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">AbortController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="3">
</span><span class="code-line line-number" line="4">  <span class="token keyword">const</span> callback <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token spread operator">...</span>args</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="5">    <span class="token keyword">const</span> controller <span class="token operator">=</span> controllerRef<span class="token punctuation">.</span><span class="token property-access">current</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="6">    <span class="token keyword control-flow">return</span> <span class="token function">cb</span><span class="token punctuation">(</span>controller<span class="token punctuation">,</span> <span class="token spread operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="7">  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>cb<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="8">
</span><span class="code-line line-number" line="9">  <span class="token keyword">const</span> abort <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="10">    controllerRef<span class="token punctuation">.</span><span class="token property-access">current</span><span class="token punctuation">.</span><span class="token method function property-access">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="11">    controllerRef<span class="token punctuation">.</span><span class="token property-access">current</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AbortController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="12">  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="13">
</span><span class="code-line line-number" line="14">  <span class="token keyword control-flow">return</span> <span class="token punctuation">[</span>callback<span class="token punctuation">,</span> abort<span class="token punctuation">]</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="15"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></code></pre>
<p>이러한 패턴은 <code>useAbortController</code> 훅으로 감싸기 전의 원래 함수와
파라미터가 일치하기 때문에 호출 시 굉장히 편리합니다.</p>
<pre class="language-js"><code class="language-js code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">const</span> searchWithAbortController <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span>
</span><span class="code-line line-number" line="2">  <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">abortController<span class="token punctuation">,</span> keyword</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="3">    <span class="token keyword control-flow">try</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="4">      <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword control-flow">await</span> axios<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">'/search'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="5">        <span class="token literal-property property">params</span><span class="token operator">:</span> <span class="token punctuation">{</span>keyword<span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="6">        <span class="token literal-property property">signal</span><span class="token operator">:</span> abortController<span class="token punctuation">.</span><span class="token property-access">signal</span>
</span><span class="code-line line-number" line="7">      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="8">      <span class="token comment">// Handle result</span>
</span><span class="code-line line-number" line="9">    <span class="token punctuation">}</span> <span class="token keyword control-flow">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="10">      <span class="token comment">// Handle errors</span>
</span><span class="code-line line-number" line="11">    <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="12">  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="13">
</span><span class="code-line line-number" line="14"><span class="token keyword">const</span> <span class="token punctuation">[</span>search<span class="token punctuation">,</span> abortSearch<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useAbortController</span><span class="token punctuation">(</span>searchWithAbortController<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="15">
</span><span class="code-line line-number" line="16"><span class="token comment">// Like this. No need to care AbortController, just your arguments.</span>
</span><span class="code-line line-number" line="17"><span class="token function">search</span><span class="token punctuation">(</span><span class="token string">'keyword'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></code></pre>
<p>만약 <code>AbortController</code>가 파라미터의 마지막에 오길 바란다면, 다음과 같이 보내면 됩니다.</p>
<pre class="language-js"><code class="language-js code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">const</span> useAbortController <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">cb</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="2">  <span class="token keyword">const</span> controllerRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">AbortController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="3">
</span><span class="code-line line-number" line="4">  <span class="token keyword">const</span> callback <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token spread operator">...</span>args</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="5">    <span class="token keyword">const</span> controller <span class="token operator">=</span> controllerRef<span class="token punctuation">.</span><span class="token property-access">current</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="6">    <span class="token keyword control-flow">return</span> <span class="token function">cb</span><span class="token punctuation">(</span><span class="token spread operator">...</span>args<span class="token punctuation">,</span> controller<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="7">  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>cb<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="8">
</span><span class="code-line line-number" line="9">  <span class="token keyword">const</span> abort <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="10">    controllerRef<span class="token punctuation">.</span><span class="token property-access">current</span><span class="token punctuation">.</span><span class="token method function property-access">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="11">    controllerRef<span class="token punctuation">.</span><span class="token property-access">current</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AbortController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="12">  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="13">
</span><span class="code-line line-number" line="14">  <span class="token keyword control-flow">return</span> <span class="token punctuation">[</span>callback<span class="token punctuation">,</span> abort<span class="token punctuation">]</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="15"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="16">
</span><span class="code-line line-number" line="17"><span class="token keyword">const</span> searchWithAbortController <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span>
</span><span class="code-line line-number" line="18">  <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">keyword<span class="token punctuation">,</span> abortController</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="19">    <span class="token keyword control-flow">try</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="20">      <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword control-flow">await</span> axios<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">'/search'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="21">        <span class="token literal-property property">params</span><span class="token operator">:</span> <span class="token punctuation">{</span>keyword<span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="22">        <span class="token literal-property property">signal</span><span class="token operator">:</span> abortController<span class="token punctuation">.</span><span class="token property-access">signal</span>
</span><span class="code-line line-number" line="23">      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="24">      <span class="token comment">// Handle result</span>
</span><span class="code-line line-number" line="25">    <span class="token punctuation">}</span> <span class="token keyword control-flow">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="26">      <span class="token comment">// Handle errors</span>
</span><span class="code-line line-number" line="27">    <span class="token punctuation">}</span>
</span><span class="code-line line-number" line="28">  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></code></pre>
<h3 id="8-Typescript로-타이핑-하기">Typescript로 타이핑 하기</h3>
<p>이제 이 훅을 어떻게 타입스크립트로 짤 수 있을지 봅시다.
currying 함수 작성 시 타입이 Deprecated 되지 않게 하는 것은 DX에 적지 않은 영향을 미칩니다.
신경 써서 작성하지 않으면 currying 함수의 타입은 날라가게 되죠.
다음 타입스크립트 코드를 봅시다.
동작은 하지만 모든 타입이 <code>unknown</code>입니다. 이건 아니죠.</p>
<pre class="language-ts"><code class="language-ts code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">const</span> <span class="token function-variable function">useAbortController</span> <span class="token operator">=</span> <span class="token punctuation">(</span>
</span><span class="code-line line-number" line="2">  <span class="token function-variable function">cb</span><span class="token operator">:</span> <span class="token punctuation">(</span>controller<span class="token operator">:</span> AbortController<span class="token punctuation">,</span> <span class="token operator">...</span>args<span class="token operator">:</span> <span class="token builtin">unknown</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token builtin">unknown</span>
</span><span class="code-line line-number" line="3"><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="4">  <span class="token keyword">const</span> controllerRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">AbortController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="5">
</span><span class="code-line line-number" line="6">  <span class="token keyword">const</span> callback <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">...</span>cbArgs<span class="token operator">:</span> <span class="token builtin">unknown</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="7">    <span class="token keyword">const</span> controller <span class="token operator">=</span> controllerRef<span class="token punctuation">.</span>current<span class="token punctuation">;</span>
</span><span class="code-line line-number" line="8">    <span class="token keyword">return</span> <span class="token function">cb</span><span class="token punctuation">(</span>controller<span class="token punctuation">,</span> <span class="token operator">...</span>cbArgs<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="9">  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>cb<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="10">
</span><span class="code-line line-number" line="11">  <span class="token keyword">const</span> abort <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="12">    controllerRef<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="13">    controllerRef<span class="token punctuation">.</span>current <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AbortController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="14">  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="15">
</span><span class="code-line line-number" line="16">  <span class="token keyword">return</span> <span class="token punctuation">[</span>callback<span class="token punctuation">,</span> abort<span class="token punctuation">]</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="17"><span class="token punctuation">}</span><span class="token punctuation">;</span>
</span></code></pre>
<p>여기서 필요한 것은 <em>generics</em>입니다.
제네릭 타입을 훅에 추가함으로써 리턴 하는 함수는 자동으로 상세한 타입을 가지게 됩니다.</p>
<pre class="language-ts"><code class="language-ts code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">const</span> useAbortController <span class="token operator">=</span> <span class="token operator">&#x3C;</span>Args <span class="token keyword">extends</span> <span class="token class-name"><span class="token builtin">unknown</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> Ret<span class="token operator">></span>
</span><span class="code-line line-number" line="2">  <span class="token punctuation">(</span>
</span><span class="code-line line-number" line="3">    <span class="token function-variable function">cb</span><span class="token operator">:</span> <span class="token punctuation">(</span>controller<span class="token operator">:</span> AbortController<span class="token punctuation">,</span> <span class="token operator">...</span>args<span class="token operator">:</span> Args<span class="token punctuation">)</span> <span class="token operator">=></span> Ret
</span><span class="code-line line-number" line="4">  <span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="5">  <span class="token keyword">const</span> controllerRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">AbortController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="6">
</span><span class="code-line line-number" line="7">  <span class="token keyword">const</span> callback <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">...</span>cbArgs<span class="token operator">:</span> Args<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="8">    <span class="token keyword">const</span> controller <span class="token operator">=</span> controllerRef<span class="token punctuation">.</span>current<span class="token punctuation">;</span>
</span><span class="code-line line-number" line="9">    <span class="token keyword">return</span> <span class="token function">cb</span><span class="token punctuation">(</span>controller<span class="token punctuation">,</span> <span class="token operator">...</span>cbArgs<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="10">  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>cb<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="11">
</span><span class="code-line line-number" line="12">  <span class="token keyword">const</span> abort <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="13">    controllerRef<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="14">    controllerRef<span class="token punctuation">.</span>current <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AbortController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="15">  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="16">
</span><span class="code-line line-number" line="17">  <span class="token keyword">return</span> <span class="token punctuation">[</span>callback<span class="token punctuation">,</span> abort<span class="token punctuation">]</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="18"><span class="token punctuation">}</span><span class="token punctuation">;</span>
</span></code></pre>
<p>이제 노출되는 콜백 파라미터는 자세한 타입을 가지게 되나 함수 자체의 타이핑은
모호한데요.
이 훅의 리턴 타입이 무엇인지 명시하지 않았기 때문입니다.</p>
<p><img src="/img/2023-10-26-en-useAbortController-hook/useAbortController-typescript-1.png" alt="useAbortController-typescript-wrong-types"></p>
<p><img src="/img/2023-10-26-en-useAbortController-hook/useAbortController-typescript-2.png" alt="useAbortController-typescript-wrong-types"></p>
<p>다음과 같이 상세한 타입을 줌으로써 해결하거나,</p>
<pre class="language-ts"><code class="language-ts code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">const</span> useAbortController <span class="token operator">=</span> <span class="token operator">&#x3C;</span>Args <span class="token keyword">extends</span> <span class="token class-name"><span class="token builtin">unknown</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> Ret<span class="token operator">></span>
</span><span class="code-line line-number" line="2">  <span class="token punctuation">(</span>
</span><span class="code-line line-number" line="3">    <span class="token function-variable function">cb</span><span class="token operator">:</span> <span class="token punctuation">(</span>controller<span class="token operator">:</span> AbortController<span class="token punctuation">,</span> <span class="token operator">...</span>args<span class="token operator">:</span> Args<span class="token punctuation">)</span> <span class="token operator">=></span> Ret
</span><span class="code-line line-number" line="4">  <span class="token punctuation">)</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function-variable function">callback</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token operator">:</span> Args<span class="token punctuation">)</span> <span class="token operator">=></span> Ret<span class="token punctuation">,</span> <span class="token function-variable function">abortCallback</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">void</span><span class="token punctuation">]</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
</span></code></pre>
<p>리턴하는 콜백 어레이에 <code>as const</code>를 줘서 해결할 수 있습니다.</p>
<pre class="language-ts"><code class="language-ts code-highlight"><span class="code-line line-number" line="1">  <span class="token keyword">return</span> <span class="token punctuation">[</span>callback<span class="token punctuation">,</span> abort<span class="token punctuation">]</span> <span class="token keyword">as</span> <span class="token keyword">const</span><span class="token punctuation">;</span>
</span></code></pre>
<p>이제 콜백은 자세한 타입을 갖게 되었습니다.  :)</p>
<p>만약 훅에서 <code>AbortController</code>가 마지막 파라미터로 오게 만들고 싶다면
타입스크립트로 작성하긴 까다롭긴 하나 100% 가능합니다.</p>
<pre class="language-ts"><code class="language-ts code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">type</span> <span class="token class-name">ArgsWithController<span class="token operator">&#x3C;</span><span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token builtin">unknown</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token constant">T</span><span class="token punctuation">,</span> AbortController<span class="token punctuation">]</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="2">
</span><span class="code-line line-number" line="3"><span class="token keyword">const</span> useAbortController <span class="token operator">=</span> <span class="token operator">&#x3C;</span>Args <span class="token keyword">extends</span> <span class="token class-name"><span class="token builtin">unknown</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> Ret<span class="token operator">></span>
</span><span class="code-line line-number" line="4">  <span class="token punctuation">(</span>
</span><span class="code-line line-number" line="5">    <span class="token function-variable function">cb</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token operator">:</span> ArgsWithController<span class="token operator">&#x3C;</span>Args<span class="token operator">></span><span class="token punctuation">)</span> <span class="token operator">=></span> Ret
</span><span class="code-line line-number" line="6">  <span class="token punctuation">)</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function-variable function">callback</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token operator">:</span> Args<span class="token punctuation">)</span> <span class="token operator">=></span> Ret<span class="token punctuation">,</span> <span class="token function-variable function">abortCallback</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">void</span><span class="token punctuation">]</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="7">  <span class="token keyword">const</span> controllerRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">AbortController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="8">
</span><span class="code-line line-number" line="9">  <span class="token keyword">const</span> callback <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">...</span>cbArgs<span class="token operator">:</span> Args<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="10">    <span class="token keyword">const</span> controller <span class="token operator">=</span> controllerRef<span class="token punctuation">.</span>current<span class="token punctuation">;</span>
</span><span class="code-line line-number" line="11">    <span class="token keyword">return</span> <span class="token function">cb</span><span class="token punctuation">(</span><span class="token operator">...</span>cbArgs<span class="token punctuation">,</span> controller<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="12">  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>cb<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="13">
</span><span class="code-line line-number" line="14">  <span class="token keyword">const</span> abort <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="15">    controllerRef<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="16">    controllerRef<span class="token punctuation">.</span>current <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AbortController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="17">  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="18">
</span><span class="code-line line-number" line="19">  <span class="token keyword">return</span> <span class="token punctuation">[</span>callback<span class="token punctuation">,</span> abort<span class="token punctuation">]</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="20"><span class="token punctuation">}</span><span class="token punctuation">;</span>
</span></code></pre>
<p>타입스크립트는 개발자를 돕기 위해 탄생한 언어라는 것을 말씀 드리고 싶습니다.
만약 같은 로직을 재활용할 일이 없거나, 타입스크립트가 그다지 유용하다고 느끼지 않는다면
타입스크립트를 사용하지 않아도 괜찮습니다.
하지만 상세한 타이핑과 함께 한번 작성된 타입스크립트 코드는 여러분을 여러 번 구할 것입니다.</p><!-- HTML_TAG_END --></main></div></div> <footer class="p-2 py-5 text-sm flex gap-1 flex-col md:flex-row items-center justify-between border-t border-gray-300 bg-gray-50 dark:border-gray-700 dark:bg-[#2c3039]"><div>© 2021~2024 dlguswo333; All rights reserved.</div> <div class="flex items-center"><a class="inline-flex items-center" href="https://github.com/dlguswo333/dlguswo333.github.io"><img class="inline h-4 w-4 mr-1" src="/github-mark.svg" alt="github-mark"></a>
    Built with Sveltekit.</div></footer>  
			
			<script>
				{
					__sveltekit_8m5s7y = {
						base: new URL("../../..", location).pathname.slice(0, -1),
						env: {}
					};

					const element = document.currentScript.parentElement;

					const data = [null,{"type":"data","data":{html:"\u003Cp>리액트 프로젝트를 진행하다 보면 fetch 리퀘스트를 보내야 할 때가 오죠.\n그럴 때는 \u003Ccode>useEffect\u003C/code> 내에서 API를 호출하라는 말을 하곤 합니다.\n데이터를 가져오는 것은 리액트 컴포넌트의 수명 주기와 깊은 연관이 있기 때문입니다.\u003C/p>\n\u003Cblockquote>\n\u003Cp>\u003Cstrong>Fetching data with Effects\u003C/strong>\u003Cbr>\nYou can use an Effect to fetch data for your component.\n...\nWriting data fetching directly in Effects gets repetitive and makes it difficult to add optimizations like caching and server rendering later. It’s easier to use a custom Hook—either your own or maintained by the community.\u003Cbr>\n\u003Ca href=\"https://react.dev/reference/react/useEffect#fetching-data-with-effects\">https://react.dev/reference/react/useEffect#fetching-data-with-effects\u003C/a>\u003C/p>\n\u003C/blockquote>\n\u003Cp>또한, 리퀘스트를 취소하기 위해 boolean 값 또는 \u003Ccode>AbortController\u003C/code>를 사용할 수 있습니다.\n이는 원치 않는 \u003Ccode>race condition\u003C/code>도 예방해줄 수 있죠.\u003C/p>\n\u003Cblockquote>\n\u003Cp>Note the \u003Ccode>ignore\u003C/code> variable which is initialized to \u003Ccode>false\u003C/code>, and is set to \u003Ccode>true\u003C/code> during cleanup. This ensures your code doesn’t suffer from “race conditions”: network responses may arrive in a different order than you sent them.\u003Cbr>\n\u003Ca href=\"https://react.dev/reference/react/useEffect#fetching-data-with-effects\">https://react.dev/reference/react/useEffect#fetching-data-with-effects\u003C/a>\u003C/p>\n\u003C/blockquote>\n\u003Cp>boolean 값 하나로도 충분하긴 하지만\n진행 중인 fetch 리퀘스트도 취소할 수 있는 기능이 있는\n\u003Ccode>AbortController\u003C/code>가 더 나은 옵션이라 할 수 있습니다.\u003C/p>\n\u003Cblockquote>\n\u003Cp>The abort() method of the AbortController interface aborts a DOM request before it has completed. This is able to abort fetch requests, the consumption of any response bodies, or streams.\u003Cbr>\n\u003Ca href=\"https://developer.mozilla.org/en-US/docs/Web/API/AbortController/abort\">https://developer.mozilla.org/en-US/docs/Web/API/AbortController/abort\u003C/a>\u003C/p>\n\u003C/blockquote>\n\u003Cp>이번 포스트에선 \u003Ccode>AbortController\u003C/code>를 쓰는 법, 그리고 리액트 프로젝트에서 공통 로직과 코드를 훅으로\n분리해 재활용하는 여러 가지 방법을 소개합니다.\u003C/p>\n\u003Ch1 id=\"1-useEffect-내-AbortController\">useEffect 내 AbortController\u003C/h1>\n\u003Cp>다음 코드는 fetch 리퀘스트를 \u003Ccode>AbortController\u003C/code>와 함께 \u003Ccode>useEffect\u003C/code> 내에서 사용하는 예시입니다.\u003C/p>\n\u003Cpre class=\"language-js\">\u003Ccode class=\"language-js code-highlight\">\u003Cspan class=\"code-line line-number\" line=\"1\">\u003Cspan class=\"token function\">useEffect\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token arrow operator\">=>\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"2\">  \u003Cspan class=\"token keyword\">const\u003C/span> controller \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token keyword\">new\u003C/span> \u003Cspan class=\"token class-name\">AbortController\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"3\">  \u003Cspan class=\"token keyword\">const\u003C/span> \u003Cspan class=\"token function-variable function\">search\u003C/span> \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token keyword\">async\u003C/span> \u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token arrow operator\">=>\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"4\">    \u003Cspan class=\"token keyword\">const\u003C/span> result \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token keyword control-flow\">await\u003C/span> axios\u003Cspan class=\"token punctuation\">.\u003C/span>\u003Cspan class=\"token method function property-access\">get\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token string\">'/search'\u003C/span>\u003Cspan class=\"token punctuation\">,\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"5\">      \u003Cspan class=\"token literal-property property\">params\u003C/span>\u003Cspan class=\"token operator\">:\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>keyword\u003Cspan class=\"token punctuation\">}\u003C/span>\u003Cspan class=\"token punctuation\">,\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"6\">      \u003Cspan class=\"token literal-property property\">signal\u003C/span>\u003Cspan class=\"token operator\">:\u003C/span> controller\u003Cspan class=\"token punctuation\">.\u003C/span>\u003Cspan class=\"token property-access\">signal\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"7\">    \u003Cspan class=\"token punctuation\">}\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"8\">    \u003Cspan class=\"token function\">setSearchResult\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>result\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"9\">  \u003Cspan class=\"token punctuation\">}\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"10\">  \u003Cspan class=\"token function\">search\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"11\">\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"12\">  \u003Cspan class=\"token keyword control-flow\">return\u003C/span> \u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token arrow operator\">=>\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"13\">    controller\u003Cspan class=\"token punctuation\">.\u003C/span>\u003Cspan class=\"token method function property-access\">abort\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"14\">  \u003Cspan class=\"token punctuation\">}\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"15\">\u003Cspan class=\"token punctuation\">}\u003C/span>\u003Cspan class=\"token punctuation\">,\u003C/span> \u003Cspan class=\"token punctuation\">[\u003C/span>keyword\u003Cspan class=\"token punctuation\">]\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>이 포스트에선 \u003Ccode>axios\u003C/code>를 사용해 데이터를 가져옵니다.\n\u003Ccode>axios\u003C/code>는 \u003Ccode>AbortController.signal\u003C/code>을 두번째 파라미터 오브젝트의 \u003Ccode>signal\u003C/code> 속성으로 건네 주어야 합니다.\n자세한 내용은 \u003Ca href=\"https://axios-http.com/docs/cancellation\">\u003Ccode>axios\u003C/code> 문서\u003C/a>를 참고하세요.\u003C/p>\n\u003Cp>\u003Ccode>keyword\u003C/code> state가 바뀔 때마다, cleanup 함수가 실행되면서\n진행 중인 fetch 리퀘스트를 취소하고 에러를 던집니다.\n이 에러에 의해 아래 줄의 \u003Ccode>setSearchResult(result)\u003C/code>가 실행 되지 않고 스킵되는 것입니다.\n또한 취소 시 발생하는 \u003Ccode>AbortError\u003C/code>를 처리하기 위해, 또는 의도치 않은 네트워크 에러 등을 방지하기 위해서라도\ntry catch로 감싸는 것이 바람직합니다.\u003C/p>\n\u003Cblockquote>\n\u003Cp>When abort() is called, the fetch() promise rejects with a \u003Ccode>DOMException\u003C/code> named \u003Ccode>AbortError\u003C/code>.\u003Cbr>\n\u003Ca href=\"https://developer.mozilla.org/en-US/docs/Web/API/AbortController\">https://developer.mozilla.org/en-US/docs/Web/API/AbortController\u003C/a>\u003C/p>\n\u003C/blockquote>\n\u003Cpre class=\"language-js\">\u003Ccode class=\"language-js code-highlight\">\u003Cspan class=\"code-line line-number\" line=\"1\">\u003Cspan class=\"token function\">useEffect\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token arrow operator\">=>\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"2\">  \u003Cspan class=\"token keyword\">const\u003C/span> controller \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token keyword\">new\u003C/span> \u003Cspan class=\"token class-name\">AbortController\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"3\">  \u003Cspan class=\"token keyword\">const\u003C/span> \u003Cspan class=\"token function-variable function\">search\u003C/span> \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token keyword\">async\u003C/span> \u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token arrow operator\">=>\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"4\">    \u003Cspan class=\"token keyword control-flow\">try\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"5\">      \u003Cspan class=\"token keyword\">const\u003C/span> result \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token keyword control-flow\">await\u003C/span> axios\u003Cspan class=\"token punctuation\">.\u003C/span>\u003Cspan class=\"token method function property-access\">get\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token string\">'/search'\u003C/span>\u003Cspan class=\"token punctuation\">,\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"6\">        \u003Cspan class=\"token literal-property property\">params\u003C/span>\u003Cspan class=\"token operator\">:\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>keyword\u003Cspan class=\"token punctuation\">}\u003C/span>\u003Cspan class=\"token punctuation\">,\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"7\">        \u003Cspan class=\"token literal-property property\">signal\u003C/span>\u003Cspan class=\"token operator\">:\u003C/span> controller\u003Cspan class=\"token punctuation\">.\u003C/span>\u003Cspan class=\"token property-access\">signal\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"8\">      \u003Cspan class=\"token punctuation\">}\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"9\">      \u003Cspan class=\"token function\">setSearchResult\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>result\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"10\">    \u003Cspan class=\"token punctuation\">}\u003C/span> \u003Cspan class=\"token keyword control-flow\">catch\u003C/span> \u003Cspan class=\"token punctuation\">(\u003C/span>e\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"11\">      \u003Cspan class=\"token keyword control-flow\">if\u003C/span> \u003Cspan class=\"token punctuation\">(\u003C/span>e \u003Cspan class=\"token keyword\">instanceof\u003C/span> \u003Cspan class=\"token class-name\">Error\u003C/span> \u003Cspan class=\"token operator\">&#x26;&#x26;\u003C/span> e\u003Cspan class=\"token punctuation\">.\u003C/span>\u003Cspan class=\"token property-access\">name\u003C/span> \u003Cspan class=\"token operator\">===\u003C/span> \u003Cspan class=\"token string\">'AbortError'\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"12\">        \u003Cspan class=\"token comment\">// Handle AbortError\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"13\">      \u003Cspan class=\"token punctuation\">}\u003C/span> \u003Cspan class=\"token keyword control-flow\">else\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"14\">        \u003Cspan class=\"token comment\">// Handle other errors\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"15\">      \u003Cspan class=\"token punctuation\">}\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"16\">    \u003Cspan class=\"token punctuation\">}\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"17\">  \u003Cspan class=\"token punctuation\">}\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"18\">  \u003Cspan class=\"token function\">search\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"19\">\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"20\">  \u003Cspan class=\"token keyword control-flow\">return\u003C/span> \u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token arrow operator\">=>\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"21\">    controller\u003Cspan class=\"token punctuation\">.\u003C/span>\u003Cspan class=\"token method function property-access\">abort\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"22\">  \u003Cspan class=\"token punctuation\">}\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"23\">\u003Cspan class=\"token punctuation\">}\u003C/span>\u003Cspan class=\"token punctuation\">,\u003C/span> \u003Cspan class=\"token punctuation\">[\u003C/span>keyword\u003Cspan class=\"token punctuation\">]\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch1 id=\"2-AbortController-커스텀-훅으로-만들기\">AbortController 커스텀 훅으로 만들기\u003C/h1>\n\u003Cp>만약 코드를 커스텀 훅으로 재활용하고 싶다면 다음과 같이 가능하겠죠.\u003C/p>\n\u003Cpre class=\"language-js\">\u003Ccode class=\"language-js code-highlight\">\u003Cspan class=\"code-line line-number\" line=\"1\">\u003Cspan class=\"token keyword\">const\u003C/span> useAbortController \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token parameter\">url\u003Cspan class=\"token punctuation\">,\u003C/span> params\u003Cspan class=\"token punctuation\">,\u003C/span> onFetchComplete\u003Cspan class=\"token punctuation\">,\u003C/span> onError\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token arrow operator\">=>\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"2\">  \u003Cspan class=\"token function\">useEffect\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token arrow operator\">=>\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"3\">    \u003Cspan class=\"token keyword\">const\u003C/span> controller \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token keyword\">new\u003C/span> \u003Cspan class=\"token class-name\">AbortController\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"4\">    \u003Cspan class=\"token keyword\">const\u003C/span> \u003Cspan class=\"token function-variable function\">search\u003C/span> \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token keyword\">async\u003C/span> \u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token arrow operator\">=>\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"5\">      \u003Cspan class=\"token keyword control-flow\">try\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"6\">        \u003Cspan class=\"token keyword\">const\u003C/span> result \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token keyword control-flow\">await\u003C/span> axios\u003Cspan class=\"token punctuation\">.\u003C/span>\u003Cspan class=\"token method function property-access\">get\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>url\u003Cspan class=\"token punctuation\">,\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"7\">          params\u003Cspan class=\"token punctuation\">,\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"8\">          \u003Cspan class=\"token literal-property property\">signal\u003C/span>\u003Cspan class=\"token operator\">:\u003C/span> controller\u003Cspan class=\"token punctuation\">.\u003C/span>\u003Cspan class=\"token property-access\">signal\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"9\">        \u003Cspan class=\"token punctuation\">}\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"10\">        \u003Cspan class=\"token function\">onFetchComplete\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>result\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"11\">      \u003Cspan class=\"token punctuation\">}\u003C/span> \u003Cspan class=\"token keyword control-flow\">catch\u003C/span> \u003Cspan class=\"token punctuation\">(\u003C/span>e\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"12\">        \u003Cspan class=\"token function\">onError\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>e\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"13\">      \u003Cspan class=\"token punctuation\">}\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"14\">    \u003Cspan class=\"token punctuation\">}\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"15\">    \u003Cspan class=\"token function\">search\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"16\">\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"17\">    \u003Cspan class=\"token keyword control-flow\">return\u003C/span> \u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token arrow operator\">=>\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"18\">      controller\u003Cspan class=\"token punctuation\">.\u003C/span>\u003Cspan class=\"token method function property-access\">abort\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"19\">    \u003Cspan class=\"token punctuation\">}\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"20\">  \u003Cspan class=\"token punctuation\">}\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"21\">\u003Cspan class=\"token punctuation\">}\u003C/span>\u003Cspan class=\"token punctuation\">,\u003C/span> \u003Cspan class=\"token punctuation\">[\u003C/span>url\u003Cspan class=\"token punctuation\">,\u003C/span> params\u003Cspan class=\"token punctuation\">,\u003C/span> onFetchComplete\u003Cspan class=\"token punctuation\">,\u003C/span> onError\u003Cspan class=\"token punctuation\">]\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>이 훅은 이렇게 사용할 수 있습니다.\u003C/p>\n\u003Cpre class=\"language-js\">\u003Ccode class=\"language-js code-highlight\">\u003Cspan class=\"code-line line-number\" line=\"1\">\u003Cspan class=\"token function\">useAbortController\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token string\">'/search'\u003C/span>\u003Cspan class=\"token punctuation\">,\u003C/span> params\u003Cspan class=\"token punctuation\">,\u003C/span> setSearchResult\u003Cspan class=\"token punctuation\">,\u003C/span> onError\u003Cspan class=\"token punctuation\">)\u003C/span>\n\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>하지만 각 argument의 stability를 보장해야 합니다.\n만약 리렌더링 때마다 각 argument가 재생성되어 리액트가 \u003Cstrong>변경\u003C/strong> 되었다고 판단 시\n매번 \u003Ccode>useEffect\u003C/code>가 실행 되므로 불필요한 리퀘스트, 최악의 경우 무한 리렌더링이 발생할 수 있습니다.\u003C/p>\n\u003Cp>또한 이 훅은 \u003Ccode>search\u003C/code>와 \u003Ccode>abort\u003C/code> 콜백을 필요할 때 부를 수 없다는 단점이 있습니다.\n시작/취소 버튼을 클릭할 때와 같이 콜백을 필요할 때 부를 경우가 있을텐데요,\n해당 훅은 콜백을 \u003Ccode>useEffect\u003C/code>에 감싸고 외부에 노출하지 않기 때문에 원할 때 부르는 것이 불가능합니다.\u003C/p>\n\u003Ch1 id=\"3-더-고도화된-AbortController-커스텀-훅-만들기\">더 고도화된 AbortController 커스텀 훅 만들기\u003C/h1>\n\u003Ch2 id=\"4-콜백과-Abort-함수를-리턴하기\">콜백과 Abort 함수를 리턴하기\u003C/h2>\n\u003Cp>따라서 커스텀 훅이 내부적으로 fetch 리퀘스트를 알아서 부르기 보다는,\n리퀘스트를 \u003Ccode>AbortController\u003C/code>와 함께 동작하도록 고도화 한 함수를 만들어\nabort 함수와 함께 호출 컴포넌트에게 전달해 주어야 합니다.\u003C/p>\n\u003Cpre class=\"language-jsx\">\u003Ccode class=\"language-jsx code-highlight\">\u003Cspan class=\"code-line line-number\" line=\"1\">\u003Cspan class=\"token keyword\">const\u003C/span> \u003Cspan class=\"token punctuation\">[\u003C/span>search\u003Cspan class=\"token punctuation\">,\u003C/span> abortSearch\u003Cspan class=\"token punctuation\">]\u003C/span> \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token function\">useAbortController\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"2\">  url\u003Cspan class=\"token punctuation\">,\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"3\">  params\u003Cspan class=\"token punctuation\">,\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"4\">  setSearchResult\u003Cspan class=\"token punctuation\">,\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"5\">  onError\u003Cspan class=\"token punctuation\">,\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"6\">\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"7\">\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"8\">\u003Cspan class=\"token comment\">// Use it like this:\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"9\">\u003Cspan class=\"token tag\">\u003Cspan class=\"token tag\">\u003Cspan class=\"token punctuation\">&#x3C;\u003C/span>button\u003C/span> \u003Cspan class=\"token attr-name\">onClick\u003C/span>\u003Cspan class=\"token script language-javascript\">\u003Cspan class=\"token script-punctuation punctuation\">=\u003C/span>\u003Cspan class=\"token punctuation\">{\u003C/span>search\u003Cspan class=\"token punctuation\">}\u003C/span>\u003C/span>\u003Cspan class=\"token punctuation\">>\u003C/span>\u003C/span>\u003Cspan class=\"token plain-text\">Search\u003C/span>\u003Cspan class=\"token tag\">\u003Cspan class=\"token tag\">\u003Cspan class=\"token punctuation\">&#x3C;/\u003C/span>button\u003C/span>\u003Cspan class=\"token punctuation\">>\u003C/span>\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"10\">\u003Cspan class=\"token tag\">\u003Cspan class=\"token tag\">\u003Cspan class=\"token punctuation\">&#x3C;\u003C/span>button\u003C/span> \u003Cspan class=\"token attr-name\">onClick\u003C/span>\u003Cspan class=\"token script language-javascript\">\u003Cspan class=\"token script-punctuation punctuation\">=\u003C/span>\u003Cspan class=\"token punctuation\">{\u003C/span>abortSearch\u003Cspan class=\"token punctuation\">}\u003C/span>\u003C/span>\u003Cspan class=\"token punctuation\">>\u003C/span>\u003C/span>\u003Cspan class=\"token plain-text\">Abort Search\u003C/span>\u003Cspan class=\"token tag\">\u003Cspan class=\"token tag\">\u003Cspan class=\"token punctuation\">&#x3C;/\u003C/span>button\u003C/span>\u003Cspan class=\"token punctuation\">>\u003C/span>\u003C/span>\n\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>우리가 만들 훅은 리액트의 \u003Ccode>useCallback\u003C/code>을 사용해 두 콜백을 생성해야 합니다.\n또한 동일 \u003Ccode>AbortController\u003C/code> 인스턴스를 \u003Ccode>useState\u003C/code>를 사용해 두 콜백 간 공유할 수 있어야 합니다.\u003C/p>\n\u003Cpre class=\"language-js\">\u003Ccode class=\"language-js code-highlight\">\u003Cspan class=\"code-line line-number\" line=\"1\">\u003Cspan class=\"token keyword\">const\u003C/span> useAbortController \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token parameter\">url\u003Cspan class=\"token punctuation\">,\u003C/span> params\u003Cspan class=\"token punctuation\">,\u003C/span> onFetchComplete\u003Cspan class=\"token punctuation\">,\u003C/span> onError\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token arrow operator\">=>\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"2\">  \u003Cspan class=\"token keyword\">const\u003C/span> \u003Cspan class=\"token punctuation\">[\u003C/span>controller\u003Cspan class=\"token punctuation\">,\u003C/span> setController\u003Cspan class=\"token punctuation\">]\u003C/span> \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token function\">useState\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token keyword\">new\u003C/span> \u003Cspan class=\"token class-name\">AbortController\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"3\">\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"4\">  \u003Cspan class=\"token keyword\">const\u003C/span> request \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token function\">useCallback\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token keyword\">async\u003C/span> \u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token arrow operator\">=>\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"5\">    \u003Cspan class=\"token keyword control-flow\">try\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"6\">      \u003Cspan class=\"token keyword\">const\u003C/span> result \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token keyword control-flow\">await\u003C/span> axios\u003Cspan class=\"token punctuation\">.\u003C/span>\u003Cspan class=\"token method function property-access\">get\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>url\u003Cspan class=\"token punctuation\">,\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"7\">        params\u003Cspan class=\"token punctuation\">,\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"8\">        \u003Cspan class=\"token literal-property property\">signal\u003C/span>\u003Cspan class=\"token operator\">:\u003C/span> controller\u003Cspan class=\"token punctuation\">.\u003C/span>\u003Cspan class=\"token property-access\">signal\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"9\">      \u003Cspan class=\"token punctuation\">}\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"10\">      \u003Cspan class=\"token function\">onFetchComplete\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>result\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"11\">    \u003Cspan class=\"token punctuation\">}\u003C/span> \u003Cspan class=\"token keyword control-flow\">catch\u003C/span> \u003Cspan class=\"token punctuation\">(\u003C/span>e\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"12\">      \u003Cspan class=\"token function\">onError\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>e\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"13\">    \u003Cspan class=\"token punctuation\">}\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"14\">  \u003Cspan class=\"token punctuation\">}\u003C/span>\u003Cspan class=\"token punctuation\">,\u003C/span> \u003Cspan class=\"token punctuation\">[\u003C/span>controller\u003Cspan class=\"token punctuation\">,\u003C/span> url\u003Cspan class=\"token punctuation\">,\u003C/span> params\u003Cspan class=\"token punctuation\">,\u003C/span> onFetchComplete\u003Cspan class=\"token punctuation\">,\u003C/span> onError\u003Cspan class=\"token punctuation\">]\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"15\">\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"16\">  \u003Cspan class=\"token keyword\">const\u003C/span> abortRequest \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token function\">useCallback\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token arrow operator\">=>\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"17\">    controller\u003Cspan class=\"token punctuation\">.\u003C/span>\u003Cspan class=\"token method function property-access\">abort\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"18\">    \u003Cspan class=\"token comment\">// Create a new AbortController,\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"19\">    \u003Cspan class=\"token comment\">// since you cannot use same AbortController more than once.\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"20\">    \u003Cspan class=\"token function\">setController\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token keyword\">new\u003C/span> \u003Cspan class=\"token class-name\">AbortController\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"21\">  \u003Cspan class=\"token punctuation\">}\u003C/span>\u003Cspan class=\"token punctuation\">,\u003C/span> \u003Cspan class=\"token punctuation\">[\u003C/span>controller\u003Cspan class=\"token punctuation\">]\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"22\">\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"23\">  \u003Cspan class=\"token keyword control-flow\">return\u003C/span> \u003Cspan class=\"token punctuation\">[\u003C/span>callback\u003Cspan class=\"token punctuation\">,\u003C/span> abort\u003Cspan class=\"token punctuation\">]\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"24\">\u003Cspan class=\"token punctuation\">}\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>하지만 위 훅에는 결함이 하나 있는데, 바로 \u003Ccode>AbortController\u003C/code>가 \u003Ccode>state\u003C/code>로 관리 된다는 것입니다.\n한번 \u003Ccode>AbortController.abort()\u003C/code>를 호출하면 그 컨트롤러는 재사용할 수 없죠.\n따라서 \u003Ccode>AbortController.abort()\u003C/code> 호출 후 새로운 \u003Ccode>AbortController\u003C/code>를 생성해 다음 abort에 사용해야 합니다.\n그러므로 최신 \u003Ccode>AbortController\u003C/code>를 사용하기 위해선 두 콜백이 \u003Ccode>controller\u003C/code> state에 의존해야 합니다.\n이 의존성은 불필요한 리렌더링이라는 문제를 만들어 냅니다.\u003C/p>\n\u003Col>\n\u003Cli>\u003Ccode>abortRequest()\u003C/code> 콜백 호출.\u003C/li>\n\u003Cli>\u003Ccode>controller\u003C/code> state 갱신.\u003C/li>\n\u003Cli>\u003Ccode>request\u003C/code>와 \u003Ccode>abortRequest\u003C/code> 콜백 갱신.\u003C/li>\n\u003Cli>훅을 사용하는 컴포넌트와 그 자식 컴포넌트들 리렌더링.\u003C/li>\n\u003C/ol>\n\u003Cp>게다가 \u003Ccode>request\u003C/code> state에 의존하는 이 콜백을 \u003Ccode>useEffect\u003C/code> 내에서 부르면\n또 다른 이슈가 발생합니다.\nabort 콜백 호출 시 effect는 우리의 의도와는 상관 없이 무조건 재실행합니다.\n또한 effect 내에선 \u003Ccode>request\u003C/code>를 호출하고 그 effect의 cleanup 함수에서 \u003Ccode>abort\u003C/code>를 호출하면\n무한 리렌더링이 발생합니다.\n이러한 동작들은 훅의 내부 로직에 의한 것이기 때문에\n내부를 볼 수 없는 훅을 사용하는 입장에선 굉장히 혼란스러울 것입니다.\u003C/p>\n\u003Cpre class=\"language-jsx\">\u003Ccode class=\"language-jsx code-highlight\">\u003Cspan class=\"code-line line-number\" line=\"1\">\u003Cspan class=\"token keyword\">const\u003C/span> \u003Cspan class=\"token punctuation\">[\u003C/span>search\u003Cspan class=\"token punctuation\">,\u003C/span> abortSearch\u003Cspan class=\"token punctuation\">]\u003C/span> \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token function\">useAbortController\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"2\">  url\u003Cspan class=\"token punctuation\">,\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"3\">  params\u003Cspan class=\"token punctuation\">,\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"4\">  setSearchResult\u003Cspan class=\"token punctuation\">,\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"5\">  onError\u003Cspan class=\"token punctuation\">,\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"6\">\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"7\">\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"8\">\u003Cspan class=\"token function\">useEffect\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token arrow operator\">=>\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"9\">  \u003Cspan class=\"token function\">search\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"10\">\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"11\">  \u003Cspan class=\"token keyword control-flow\">return\u003C/span> \u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token arrow operator\">=>\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"12\">    \u003Cspan class=\"token function\">abortSearch\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"13\">  \u003Cspan class=\"token punctuation\">}\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"14\">\u003Cspan class=\"token punctuation\">}\u003C/span>\u003Cspan class=\"token punctuation\">,\u003C/span> \u003Cspan class=\"token punctuation\">[\u003C/span>search\u003Cspan class=\"token punctuation\">,\u003C/span> abortSearch\u003Cspan class=\"token punctuation\">]\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"15\">\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"16\">\u003Cspan class=\"token comment\">// All I want to do is cancel searching,\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"17\">\u003Cspan class=\"token comment\">// but search API is called when the button is pressed?\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"18\">\u003Cspan class=\"token tag\">\u003Cspan class=\"token tag\">\u003Cspan class=\"token punctuation\">&#x3C;\u003C/span>button\u003C/span> \u003Cspan class=\"token attr-name\">onClick\u003C/span>\u003Cspan class=\"token script language-javascript\">\u003Cspan class=\"token script-punctuation punctuation\">=\u003C/span>\u003Cspan class=\"token punctuation\">{\u003C/span>abortSearch\u003Cspan class=\"token punctuation\">}\u003C/span>\u003C/span>\u003Cspan class=\"token punctuation\">>\u003C/span>\u003C/span>\u003Cspan class=\"token plain-text\">Cancel Search\u003C/span>\u003Cspan class=\"token tag\">\u003Cspan class=\"token tag\">\u003Cspan class=\"token punctuation\">&#x3C;/\u003C/span>button\u003C/span>\u003Cspan class=\"token punctuation\">>\u003C/span>\u003C/span>\n\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch2 id=\"5-useRef로-AbortController-관리하기\">useRef로 AbortController 관리하기\u003C/h2>\n\u003Cp>\u003Ccode>AbortController\u003C/code>를 \u003Ccode>useState\u003C/code>가 아닌 \u003Ccode>useRef\u003C/code>로 관리하면\n리렌더링 이슈를 해결할 수 있습니다.\u003C/p>\n\u003Cpre class=\"language-js\">\u003Ccode class=\"language-js code-highlight\">\u003Cspan class=\"code-line line-number\" line=\"1\">\u003Cspan class=\"token keyword\">const\u003C/span> useAbortController \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token parameter\">url\u003Cspan class=\"token punctuation\">,\u003C/span> params\u003Cspan class=\"token punctuation\">,\u003C/span> onFetchComplete\u003Cspan class=\"token punctuation\">,\u003C/span> onError\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token arrow operator\">=>\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"2\">  \u003Cspan class=\"token keyword\">const\u003C/span> controllerRef \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token function\">useRef\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token keyword\">new\u003C/span> \u003Cspan class=\"token class-name\">AbortController\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"3\">\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"4\">  \u003Cspan class=\"token keyword\">const\u003C/span> request \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token function\">useCallback\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token keyword\">async\u003C/span> \u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token arrow operator\">=>\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"5\">    \u003Cspan class=\"token keyword control-flow\">try\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"6\">      \u003Cspan class=\"token keyword\">const\u003C/span> signal \u003Cspan class=\"token operator\">=\u003C/span> controllerRef\u003Cspan class=\"token punctuation\">.\u003C/span>\u003Cspan class=\"token property-access\">current\u003C/span>\u003Cspan class=\"token punctuation\">.\u003C/span>\u003Cspan class=\"token property-access\">signal\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"7\">      \u003Cspan class=\"token keyword\">const\u003C/span> result \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token keyword control-flow\">await\u003C/span> axios\u003Cspan class=\"token punctuation\">.\u003C/span>\u003Cspan class=\"token method function property-access\">get\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>url\u003Cspan class=\"token punctuation\">,\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"8\">        params\u003Cspan class=\"token punctuation\">,\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"9\">        signal\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"10\">      \u003Cspan class=\"token punctuation\">}\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"11\">      onFetchComplete\u003Cspan class=\"token operator\">?.\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>result\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"12\">    \u003Cspan class=\"token punctuation\">}\u003C/span> \u003Cspan class=\"token keyword control-flow\">catch\u003C/span> \u003Cspan class=\"token punctuation\">(\u003C/span>e\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"13\">      onError\u003Cspan class=\"token operator\">?.\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>e\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"14\">    \u003Cspan class=\"token punctuation\">}\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"15\">  \u003Cspan class=\"token punctuation\">}\u003C/span>\u003Cspan class=\"token punctuation\">,\u003C/span> \u003Cspan class=\"token punctuation\">[\u003C/span>url\u003Cspan class=\"token punctuation\">,\u003C/span> params\u003Cspan class=\"token punctuation\">,\u003C/span> onFetchComplete\u003Cspan class=\"token punctuation\">,\u003C/span> onError\u003Cspan class=\"token punctuation\">]\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"16\">\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"17\">  \u003Cspan class=\"token keyword\">const\u003C/span> abortRequest \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token function\">useCallback\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token arrow operator\">=>\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"18\">    controllerRef\u003Cspan class=\"token punctuation\">.\u003C/span>\u003Cspan class=\"token property-access\">current\u003C/span>\u003Cspan class=\"token punctuation\">.\u003C/span>\u003Cspan class=\"token method function property-access\">abort\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"19\">    controllerRef\u003Cspan class=\"token punctuation\">.\u003C/span>\u003Cspan class=\"token property-access\">current\u003C/span> \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token keyword\">new\u003C/span> \u003Cspan class=\"token class-name\">AbortController\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"20\">  \u003Cspan class=\"token punctuation\">}\u003C/span>\u003Cspan class=\"token punctuation\">,\u003C/span> \u003Cspan class=\"token punctuation\">[\u003C/span>\u003Cspan class=\"token punctuation\">]\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"21\">\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"22\">  \u003Cspan class=\"token keyword control-flow\">return\u003C/span> \u003Cspan class=\"token punctuation\">[\u003C/span>callback\u003Cspan class=\"token punctuation\">,\u003C/span> abort\u003Cspan class=\"token punctuation\">]\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"23\">\u003Cspan class=\"token punctuation\">}\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>이제 리렌더링 이슈에서 해방되었습니다.\n\u003Ccode>request\u003C/code> 콜백 내 \u003Ccode>signal\u003C/code> 변수가 새로 정의된 것에 주의하세요.\n\u003Ccode>abort\u003C/code> 콜백은 \u003Ccode>controllerRef.current\u003C/code>를 업데이트 합니다.\n따라서 \u003Ccode>abort\u003C/code> 콜백 호출 후, \u003Ccode>fetch\u003C/code> 함수 내 \u003Ccode>controllerRef.current\u003C/code>는\n우리가 원하는 \u003Ccode>AbortController\u003C/code>가 아닐 수도 있다는 것이죠.\n만약 \u003Ccode>fetch\u003C/code> 전 \u003Ccode>abort\u003C/code> 콜백을 호출했다면 \u003Ccode>fetch\u003C/code>가 참조하는\n\u003Ccode>AbortController\u003C/code>는 새 인스턴스일 수 있으며 그렇다면\n방금 호출한 \u003Ccode>abort\u003C/code>는 리퀘스트를 취소하지 못합니다.\n따라서 \u003Ccode>fetch\u003C/code> 호출 직전 \u003Ccode>controllerRef.current\u003C/code>를 다른 변수에\n저장해 사용해야 합니다.\u003C/p>\n\u003Ch1 id=\"6-AbortController를-콜백의-파라미터로-전달하기\">AbortController를 콜백의 파라미터로 전달하기\u003C/h1>\n\u003Cp>유연성을 더 높이기 위해 url이 아니라, \u003Ccode>AbortController\u003C/code>를 받는 콜백을\n훅의 파라미터로 받을 수도 있습니다.\n이렇게 되면 \u003Ccode>url\u003C/code>, \u003Ccode>params\u003C/code>, \u003Ccode>onFetchComplete\u003C/code>, \u003Ccode>onError\u003C/code>\n이렇게 파라미터 여러 개가 아닌 파라미터로 넘겨줄 콜백 하나에서 전부 처리가 가능합니다.\u003C/p>\n\u003Cpre class=\"language-js\">\u003Ccode class=\"language-js code-highlight\">\u003Cspan class=\"code-line line-number\" line=\"1\">\u003Cspan class=\"token keyword\">const\u003C/span> searchWithAbortController \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token function\">useCallback\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"2\">  \u003Cspan class=\"token keyword\">async\u003C/span> \u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token parameter\">abortController\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token arrow operator\">=>\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"3\">    \u003Cspan class=\"token keyword control-flow\">try\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"4\">      \u003Cspan class=\"token keyword\">const\u003C/span> result \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token keyword control-flow\">await\u003C/span> axios\u003Cspan class=\"token punctuation\">.\u003C/span>\u003Cspan class=\"token method function property-access\">get\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token string\">'/search'\u003C/span>\u003Cspan class=\"token punctuation\">,\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"5\">        \u003Cspan class=\"token literal-property property\">signal\u003C/span>\u003Cspan class=\"token operator\">:\u003C/span> abortController\u003Cspan class=\"token punctuation\">.\u003C/span>\u003Cspan class=\"token property-access\">signal\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"6\">      \u003Cspan class=\"token punctuation\">}\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"7\">      \u003Cspan class=\"token comment\">// Handle result\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"8\">    \u003Cspan class=\"token punctuation\">}\u003C/span> \u003Cspan class=\"token keyword control-flow\">catch\u003C/span> \u003Cspan class=\"token punctuation\">(\u003C/span>e\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"9\">      \u003Cspan class=\"token comment\">// Handle errors\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"10\">    \u003Cspan class=\"token punctuation\">}\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"11\">  \u003Cspan class=\"token punctuation\">}\u003C/span>\u003Cspan class=\"token punctuation\">,\u003C/span> \u003Cspan class=\"token punctuation\">[\u003C/span>\u003Cspan class=\"token punctuation\">]\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"12\">\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"13\">\u003Cspan class=\"token keyword\">const\u003C/span> \u003Cspan class=\"token punctuation\">[\u003C/span>search\u003Cspan class=\"token punctuation\">,\u003C/span> abortSearch\u003Cspan class=\"token punctuation\">]\u003C/span> \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token function\">useAbortController\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>searchWithAbortController\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>이러한 훅은 다음과 같이 정의할 수 있습니다.\n이 훅의 역할은 파라미터로 받은 콜백에 \u003Ccode>AbortController\u003C/code>를 바르는 게 다입니다.\n훅을 호출하는 쪽에 응답과 에러를 처리하도록 역할을 넘겼기 때문에 훅의 코드가 굉장히 간결합니다.\n하지만 반대로 호출하는 쪽의 코드가 더 복잡해지겠죠.\u003C/p>\n\u003Cpre class=\"language-js\">\u003Ccode class=\"language-js code-highlight\">\u003Cspan class=\"code-line line-number\" line=\"1\">\u003Cspan class=\"token keyword\">const\u003C/span> useAbortController \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token parameter\">cb\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token arrow operator\">=>\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"2\">  \u003Cspan class=\"token keyword\">const\u003C/span> controllerRef \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token function\">useRef\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token keyword\">new\u003C/span> \u003Cspan class=\"token class-name\">AbortController\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"3\">\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"4\">  \u003Cspan class=\"token keyword\">const\u003C/span> callback \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token function\">useCallback\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token arrow operator\">=>\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"5\">    \u003Cspan class=\"token keyword\">const\u003C/span> controller \u003Cspan class=\"token operator\">=\u003C/span> controllerRef\u003Cspan class=\"token punctuation\">.\u003C/span>\u003Cspan class=\"token property-access\">current\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"6\">    \u003Cspan class=\"token keyword control-flow\">return\u003C/span> \u003Cspan class=\"token function\">cb\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>controller\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"7\">  \u003Cspan class=\"token punctuation\">}\u003C/span>\u003Cspan class=\"token punctuation\">,\u003C/span> \u003Cspan class=\"token punctuation\">[\u003C/span>cb\u003Cspan class=\"token punctuation\">]\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"8\">\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"9\">  \u003Cspan class=\"token keyword\">const\u003C/span> abort \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token function\">useCallback\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token arrow operator\">=>\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"10\">    controllerRef\u003Cspan class=\"token punctuation\">.\u003C/span>\u003Cspan class=\"token property-access\">current\u003C/span>\u003Cspan class=\"token punctuation\">.\u003C/span>\u003Cspan class=\"token method function property-access\">abort\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"11\">    controllerRef\u003Cspan class=\"token punctuation\">.\u003C/span>\u003Cspan class=\"token property-access\">current\u003C/span> \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token keyword\">new\u003C/span> \u003Cspan class=\"token class-name\">AbortController\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"12\">  \u003Cspan class=\"token punctuation\">}\u003C/span>\u003Cspan class=\"token punctuation\">,\u003C/span> \u003Cspan class=\"token punctuation\">[\u003C/span>\u003Cspan class=\"token punctuation\">]\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"13\">\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"14\">  \u003Cspan class=\"token keyword control-flow\">return\u003C/span> \u003Cspan class=\"token punctuation\">[\u003C/span>callback\u003Cspan class=\"token punctuation\">,\u003C/span> abort\u003Cspan class=\"token punctuation\">]\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"15\">\u003Cspan class=\"token punctuation\">}\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch2 id=\"7-파라미터의-콜백에-다른-인자도-전달하기\">파라미터의 콜백에 다른 인자도 전달하기\u003C/h2>\n\u003Cp>여기서 더 고도화를 해보죠. 콜백이 \u003Ccode>AbortController\u003C/code> 뿐 아니라\n다른 인자도 받을 수 있으면 얼마나 좋을까요?\u003C/p>\n\u003Cpre class=\"language-js\">\u003Ccode class=\"language-js code-highlight\">\u003Cspan class=\"code-line line-number\" line=\"1\">\u003Cspan class=\"token keyword\">const\u003C/span> useAbortController \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token parameter\">cb\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token arrow operator\">=>\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"2\">  \u003Cspan class=\"token keyword\">const\u003C/span> controllerRef \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token function\">useRef\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token keyword\">new\u003C/span> \u003Cspan class=\"token class-name\">AbortController\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"3\">\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"4\">  \u003Cspan class=\"token keyword\">const\u003C/span> callback \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token function\">useCallback\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token parameter\">\u003Cspan class=\"token spread operator\">...\u003C/span>args\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token arrow operator\">=>\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"5\">    \u003Cspan class=\"token keyword\">const\u003C/span> controller \u003Cspan class=\"token operator\">=\u003C/span> controllerRef\u003Cspan class=\"token punctuation\">.\u003C/span>\u003Cspan class=\"token property-access\">current\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"6\">    \u003Cspan class=\"token keyword control-flow\">return\u003C/span> \u003Cspan class=\"token function\">cb\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>controller\u003Cspan class=\"token punctuation\">,\u003C/span> \u003Cspan class=\"token spread operator\">...\u003C/span>args\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"7\">  \u003Cspan class=\"token punctuation\">}\u003C/span>\u003Cspan class=\"token punctuation\">,\u003C/span> \u003Cspan class=\"token punctuation\">[\u003C/span>cb\u003Cspan class=\"token punctuation\">]\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"8\">\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"9\">  \u003Cspan class=\"token keyword\">const\u003C/span> abort \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token function\">useCallback\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token arrow operator\">=>\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"10\">    controllerRef\u003Cspan class=\"token punctuation\">.\u003C/span>\u003Cspan class=\"token property-access\">current\u003C/span>\u003Cspan class=\"token punctuation\">.\u003C/span>\u003Cspan class=\"token method function property-access\">abort\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"11\">    controllerRef\u003Cspan class=\"token punctuation\">.\u003C/span>\u003Cspan class=\"token property-access\">current\u003C/span> \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token keyword\">new\u003C/span> \u003Cspan class=\"token class-name\">AbortController\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"12\">  \u003Cspan class=\"token punctuation\">}\u003C/span>\u003Cspan class=\"token punctuation\">,\u003C/span> \u003Cspan class=\"token punctuation\">[\u003C/span>\u003Cspan class=\"token punctuation\">]\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"13\">\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"14\">  \u003Cspan class=\"token keyword control-flow\">return\u003C/span> \u003Cspan class=\"token punctuation\">[\u003C/span>callback\u003Cspan class=\"token punctuation\">,\u003C/span> abort\u003Cspan class=\"token punctuation\">]\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"15\">\u003Cspan class=\"token punctuation\">}\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>이러한 패턴은 \u003Ccode>useAbortController\u003C/code> 훅으로 감싸기 전의 원래 함수와\n파라미터가 일치하기 때문에 호출 시 굉장히 편리합니다.\u003C/p>\n\u003Cpre class=\"language-js\">\u003Ccode class=\"language-js code-highlight\">\u003Cspan class=\"code-line line-number\" line=\"1\">\u003Cspan class=\"token keyword\">const\u003C/span> searchWithAbortController \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token function\">useCallback\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"2\">  \u003Cspan class=\"token keyword\">async\u003C/span> \u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token parameter\">abortController\u003Cspan class=\"token punctuation\">,\u003C/span> keyword\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token arrow operator\">=>\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"3\">    \u003Cspan class=\"token keyword control-flow\">try\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"4\">      \u003Cspan class=\"token keyword\">const\u003C/span> result \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token keyword control-flow\">await\u003C/span> axios\u003Cspan class=\"token punctuation\">.\u003C/span>\u003Cspan class=\"token method function property-access\">get\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token string\">'/search'\u003C/span>\u003Cspan class=\"token punctuation\">,\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"5\">        \u003Cspan class=\"token literal-property property\">params\u003C/span>\u003Cspan class=\"token operator\">:\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>keyword\u003Cspan class=\"token punctuation\">}\u003C/span>\u003Cspan class=\"token punctuation\">,\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"6\">        \u003Cspan class=\"token literal-property property\">signal\u003C/span>\u003Cspan class=\"token operator\">:\u003C/span> abortController\u003Cspan class=\"token punctuation\">.\u003C/span>\u003Cspan class=\"token property-access\">signal\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"7\">      \u003Cspan class=\"token punctuation\">}\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"8\">      \u003Cspan class=\"token comment\">// Handle result\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"9\">    \u003Cspan class=\"token punctuation\">}\u003C/span> \u003Cspan class=\"token keyword control-flow\">catch\u003C/span> \u003Cspan class=\"token punctuation\">(\u003C/span>e\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"10\">      \u003Cspan class=\"token comment\">// Handle errors\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"11\">    \u003Cspan class=\"token punctuation\">}\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"12\">  \u003Cspan class=\"token punctuation\">}\u003C/span>\u003Cspan class=\"token punctuation\">,\u003C/span> \u003Cspan class=\"token punctuation\">[\u003C/span>\u003Cspan class=\"token punctuation\">]\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"13\">\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"14\">\u003Cspan class=\"token keyword\">const\u003C/span> \u003Cspan class=\"token punctuation\">[\u003C/span>search\u003Cspan class=\"token punctuation\">,\u003C/span> abortSearch\u003Cspan class=\"token punctuation\">]\u003C/span> \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token function\">useAbortController\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>searchWithAbortController\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"15\">\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"16\">\u003Cspan class=\"token comment\">// Like this. No need to care AbortController, just your arguments.\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"17\">\u003Cspan class=\"token function\">search\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token string\">'keyword'\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>만약 \u003Ccode>AbortController\u003C/code>가 파라미터의 마지막에 오길 바란다면, 다음과 같이 보내면 됩니다.\u003C/p>\n\u003Cpre class=\"language-js\">\u003Ccode class=\"language-js code-highlight\">\u003Cspan class=\"code-line line-number\" line=\"1\">\u003Cspan class=\"token keyword\">const\u003C/span> useAbortController \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token parameter\">cb\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token arrow operator\">=>\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"2\">  \u003Cspan class=\"token keyword\">const\u003C/span> controllerRef \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token function\">useRef\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token keyword\">new\u003C/span> \u003Cspan class=\"token class-name\">AbortController\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"3\">\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"4\">  \u003Cspan class=\"token keyword\">const\u003C/span> callback \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token function\">useCallback\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token parameter\">\u003Cspan class=\"token spread operator\">...\u003C/span>args\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token arrow operator\">=>\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"5\">    \u003Cspan class=\"token keyword\">const\u003C/span> controller \u003Cspan class=\"token operator\">=\u003C/span> controllerRef\u003Cspan class=\"token punctuation\">.\u003C/span>\u003Cspan class=\"token property-access\">current\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"6\">    \u003Cspan class=\"token keyword control-flow\">return\u003C/span> \u003Cspan class=\"token function\">cb\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token spread operator\">...\u003C/span>args\u003Cspan class=\"token punctuation\">,\u003C/span> controller\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"7\">  \u003Cspan class=\"token punctuation\">}\u003C/span>\u003Cspan class=\"token punctuation\">,\u003C/span> \u003Cspan class=\"token punctuation\">[\u003C/span>cb\u003Cspan class=\"token punctuation\">]\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"8\">\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"9\">  \u003Cspan class=\"token keyword\">const\u003C/span> abort \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token function\">useCallback\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token arrow operator\">=>\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"10\">    controllerRef\u003Cspan class=\"token punctuation\">.\u003C/span>\u003Cspan class=\"token property-access\">current\u003C/span>\u003Cspan class=\"token punctuation\">.\u003C/span>\u003Cspan class=\"token method function property-access\">abort\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"11\">    controllerRef\u003Cspan class=\"token punctuation\">.\u003C/span>\u003Cspan class=\"token property-access\">current\u003C/span> \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token keyword\">new\u003C/span> \u003Cspan class=\"token class-name\">AbortController\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"12\">  \u003Cspan class=\"token punctuation\">}\u003C/span>\u003Cspan class=\"token punctuation\">,\u003C/span> \u003Cspan class=\"token punctuation\">[\u003C/span>\u003Cspan class=\"token punctuation\">]\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"13\">\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"14\">  \u003Cspan class=\"token keyword control-flow\">return\u003C/span> \u003Cspan class=\"token punctuation\">[\u003C/span>callback\u003Cspan class=\"token punctuation\">,\u003C/span> abort\u003Cspan class=\"token punctuation\">]\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"15\">\u003Cspan class=\"token punctuation\">}\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"16\">\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"17\">\u003Cspan class=\"token keyword\">const\u003C/span> searchWithAbortController \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token function\">useCallback\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"18\">  \u003Cspan class=\"token keyword\">async\u003C/span> \u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token parameter\">keyword\u003Cspan class=\"token punctuation\">,\u003C/span> abortController\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token arrow operator\">=>\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"19\">    \u003Cspan class=\"token keyword control-flow\">try\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"20\">      \u003Cspan class=\"token keyword\">const\u003C/span> result \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token keyword control-flow\">await\u003C/span> axios\u003Cspan class=\"token punctuation\">.\u003C/span>\u003Cspan class=\"token method function property-access\">get\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token string\">'/search'\u003C/span>\u003Cspan class=\"token punctuation\">,\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"21\">        \u003Cspan class=\"token literal-property property\">params\u003C/span>\u003Cspan class=\"token operator\">:\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>keyword\u003Cspan class=\"token punctuation\">}\u003C/span>\u003Cspan class=\"token punctuation\">,\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"22\">        \u003Cspan class=\"token literal-property property\">signal\u003C/span>\u003Cspan class=\"token operator\">:\u003C/span> abortController\u003Cspan class=\"token punctuation\">.\u003C/span>\u003Cspan class=\"token property-access\">signal\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"23\">      \u003Cspan class=\"token punctuation\">}\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"24\">      \u003Cspan class=\"token comment\">// Handle result\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"25\">    \u003Cspan class=\"token punctuation\">}\u003C/span> \u003Cspan class=\"token keyword control-flow\">catch\u003C/span> \u003Cspan class=\"token punctuation\">(\u003C/span>e\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"26\">      \u003Cspan class=\"token comment\">// Handle errors\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"27\">    \u003Cspan class=\"token punctuation\">}\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"28\">  \u003Cspan class=\"token punctuation\">}\u003C/span>\u003Cspan class=\"token punctuation\">,\u003C/span> \u003Cspan class=\"token punctuation\">[\u003C/span>\u003Cspan class=\"token punctuation\">]\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch3 id=\"8-Typescript로-타이핑-하기\">Typescript로 타이핑 하기\u003C/h3>\n\u003Cp>이제 이 훅을 어떻게 타입스크립트로 짤 수 있을지 봅시다.\ncurrying 함수 작성 시 타입이 Deprecated 되지 않게 하는 것은 DX에 적지 않은 영향을 미칩니다.\n신경 써서 작성하지 않으면 currying 함수의 타입은 날라가게 되죠.\n다음 타입스크립트 코드를 봅시다.\n동작은 하지만 모든 타입이 \u003Ccode>unknown\u003C/code>입니다. 이건 아니죠.\u003C/p>\n\u003Cpre class=\"language-ts\">\u003Ccode class=\"language-ts code-highlight\">\u003Cspan class=\"code-line line-number\" line=\"1\">\u003Cspan class=\"token keyword\">const\u003C/span> \u003Cspan class=\"token function-variable function\">useAbortController\u003C/span> \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token punctuation\">(\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"2\">  \u003Cspan class=\"token function-variable function\">cb\u003C/span>\u003Cspan class=\"token operator\">:\u003C/span> \u003Cspan class=\"token punctuation\">(\u003C/span>controller\u003Cspan class=\"token operator\">:\u003C/span> AbortController\u003Cspan class=\"token punctuation\">,\u003C/span> \u003Cspan class=\"token operator\">...\u003C/span>args\u003Cspan class=\"token operator\">:\u003C/span> \u003Cspan class=\"token builtin\">unknown\u003C/span>\u003Cspan class=\"token punctuation\">[\u003C/span>\u003Cspan class=\"token punctuation\">]\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token operator\">=>\u003C/span> \u003Cspan class=\"token builtin\">unknown\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"3\">\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token operator\">=>\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"4\">  \u003Cspan class=\"token keyword\">const\u003C/span> controllerRef \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token function\">useRef\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token keyword\">new\u003C/span> \u003Cspan class=\"token class-name\">AbortController\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"5\">\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"6\">  \u003Cspan class=\"token keyword\">const\u003C/span> callback \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token function\">useCallback\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token operator\">...\u003C/span>cbArgs\u003Cspan class=\"token operator\">:\u003C/span> \u003Cspan class=\"token builtin\">unknown\u003C/span>\u003Cspan class=\"token punctuation\">[\u003C/span>\u003Cspan class=\"token punctuation\">]\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token operator\">=>\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"7\">    \u003Cspan class=\"token keyword\">const\u003C/span> controller \u003Cspan class=\"token operator\">=\u003C/span> controllerRef\u003Cspan class=\"token punctuation\">.\u003C/span>current\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"8\">    \u003Cspan class=\"token keyword\">return\u003C/span> \u003Cspan class=\"token function\">cb\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>controller\u003Cspan class=\"token punctuation\">,\u003C/span> \u003Cspan class=\"token operator\">...\u003C/span>cbArgs\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"9\">  \u003Cspan class=\"token punctuation\">}\u003C/span>\u003Cspan class=\"token punctuation\">,\u003C/span> \u003Cspan class=\"token punctuation\">[\u003C/span>cb\u003Cspan class=\"token punctuation\">]\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"10\">\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"11\">  \u003Cspan class=\"token keyword\">const\u003C/span> abort \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token function\">useCallback\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token operator\">=>\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"12\">    controllerRef\u003Cspan class=\"token punctuation\">.\u003C/span>current\u003Cspan class=\"token punctuation\">.\u003C/span>\u003Cspan class=\"token function\">abort\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"13\">    controllerRef\u003Cspan class=\"token punctuation\">.\u003C/span>current \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token keyword\">new\u003C/span> \u003Cspan class=\"token class-name\">AbortController\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"14\">  \u003Cspan class=\"token punctuation\">}\u003C/span>\u003Cspan class=\"token punctuation\">,\u003C/span> \u003Cspan class=\"token punctuation\">[\u003C/span>\u003Cspan class=\"token punctuation\">]\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"15\">\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"16\">  \u003Cspan class=\"token keyword\">return\u003C/span> \u003Cspan class=\"token punctuation\">[\u003C/span>callback\u003Cspan class=\"token punctuation\">,\u003C/span> abort\u003Cspan class=\"token punctuation\">]\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"17\">\u003Cspan class=\"token punctuation\">}\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>여기서 필요한 것은 \u003Cem>generics\u003C/em>입니다.\n제네릭 타입을 훅에 추가함으로써 리턴 하는 함수는 자동으로 상세한 타입을 가지게 됩니다.\u003C/p>\n\u003Cpre class=\"language-ts\">\u003Ccode class=\"language-ts code-highlight\">\u003Cspan class=\"code-line line-number\" line=\"1\">\u003Cspan class=\"token keyword\">const\u003C/span> useAbortController \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token operator\">&#x3C;\u003C/span>Args \u003Cspan class=\"token keyword\">extends\u003C/span> \u003Cspan class=\"token class-name\">\u003Cspan class=\"token builtin\">unknown\u003C/span>\u003C/span>\u003Cspan class=\"token punctuation\">[\u003C/span>\u003Cspan class=\"token punctuation\">]\u003C/span>\u003Cspan class=\"token punctuation\">,\u003C/span> Ret\u003Cspan class=\"token operator\">>\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"2\">  \u003Cspan class=\"token punctuation\">(\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"3\">    \u003Cspan class=\"token function-variable function\">cb\u003C/span>\u003Cspan class=\"token operator\">:\u003C/span> \u003Cspan class=\"token punctuation\">(\u003C/span>controller\u003Cspan class=\"token operator\">:\u003C/span> AbortController\u003Cspan class=\"token punctuation\">,\u003C/span> \u003Cspan class=\"token operator\">...\u003C/span>args\u003Cspan class=\"token operator\">:\u003C/span> Args\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token operator\">=>\u003C/span> Ret\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"4\">  \u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token operator\">=>\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"5\">  \u003Cspan class=\"token keyword\">const\u003C/span> controllerRef \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token function\">useRef\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token keyword\">new\u003C/span> \u003Cspan class=\"token class-name\">AbortController\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"6\">\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"7\">  \u003Cspan class=\"token keyword\">const\u003C/span> callback \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token function\">useCallback\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token operator\">...\u003C/span>cbArgs\u003Cspan class=\"token operator\">:\u003C/span> Args\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token operator\">=>\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"8\">    \u003Cspan class=\"token keyword\">const\u003C/span> controller \u003Cspan class=\"token operator\">=\u003C/span> controllerRef\u003Cspan class=\"token punctuation\">.\u003C/span>current\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"9\">    \u003Cspan class=\"token keyword\">return\u003C/span> \u003Cspan class=\"token function\">cb\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>controller\u003Cspan class=\"token punctuation\">,\u003C/span> \u003Cspan class=\"token operator\">...\u003C/span>cbArgs\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"10\">  \u003Cspan class=\"token punctuation\">}\u003C/span>\u003Cspan class=\"token punctuation\">,\u003C/span> \u003Cspan class=\"token punctuation\">[\u003C/span>cb\u003Cspan class=\"token punctuation\">]\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"11\">\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"12\">  \u003Cspan class=\"token keyword\">const\u003C/span> abort \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token function\">useCallback\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token operator\">=>\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"13\">    controllerRef\u003Cspan class=\"token punctuation\">.\u003C/span>current\u003Cspan class=\"token punctuation\">.\u003C/span>\u003Cspan class=\"token function\">abort\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"14\">    controllerRef\u003Cspan class=\"token punctuation\">.\u003C/span>current \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token keyword\">new\u003C/span> \u003Cspan class=\"token class-name\">AbortController\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"15\">  \u003Cspan class=\"token punctuation\">}\u003C/span>\u003Cspan class=\"token punctuation\">,\u003C/span> \u003Cspan class=\"token punctuation\">[\u003C/span>\u003Cspan class=\"token punctuation\">]\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"16\">\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"17\">  \u003Cspan class=\"token keyword\">return\u003C/span> \u003Cspan class=\"token punctuation\">[\u003C/span>callback\u003Cspan class=\"token punctuation\">,\u003C/span> abort\u003Cspan class=\"token punctuation\">]\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"18\">\u003Cspan class=\"token punctuation\">}\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>이제 노출되는 콜백 파라미터는 자세한 타입을 가지게 되나 함수 자체의 타이핑은\n모호한데요.\n이 훅의 리턴 타입이 무엇인지 명시하지 않았기 때문입니다.\u003C/p>\n\u003Cp>\u003Cimg src=\"/img/2023-10-26-en-useAbortController-hook/useAbortController-typescript-1.png\" alt=\"useAbortController-typescript-wrong-types\">\u003C/p>\n\u003Cp>\u003Cimg src=\"/img/2023-10-26-en-useAbortController-hook/useAbortController-typescript-2.png\" alt=\"useAbortController-typescript-wrong-types\">\u003C/p>\n\u003Cp>다음과 같이 상세한 타입을 줌으로써 해결하거나,\u003C/p>\n\u003Cpre class=\"language-ts\">\u003Ccode class=\"language-ts code-highlight\">\u003Cspan class=\"code-line line-number\" line=\"1\">\u003Cspan class=\"token keyword\">const\u003C/span> useAbortController \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token operator\">&#x3C;\u003C/span>Args \u003Cspan class=\"token keyword\">extends\u003C/span> \u003Cspan class=\"token class-name\">\u003Cspan class=\"token builtin\">unknown\u003C/span>\u003C/span>\u003Cspan class=\"token punctuation\">[\u003C/span>\u003Cspan class=\"token punctuation\">]\u003C/span>\u003Cspan class=\"token punctuation\">,\u003C/span> Ret\u003Cspan class=\"token operator\">>\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"2\">  \u003Cspan class=\"token punctuation\">(\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"3\">    \u003Cspan class=\"token function-variable function\">cb\u003C/span>\u003Cspan class=\"token operator\">:\u003C/span> \u003Cspan class=\"token punctuation\">(\u003C/span>controller\u003Cspan class=\"token operator\">:\u003C/span> AbortController\u003Cspan class=\"token punctuation\">,\u003C/span> \u003Cspan class=\"token operator\">...\u003C/span>args\u003Cspan class=\"token operator\">:\u003C/span> Args\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token operator\">=>\u003C/span> Ret\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"4\">  \u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token operator\">:\u003C/span> \u003Cspan class=\"token punctuation\">[\u003C/span>\u003Cspan class=\"token function-variable function\">callback\u003C/span>\u003Cspan class=\"token operator\">:\u003C/span> \u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token operator\">...\u003C/span>args\u003Cspan class=\"token operator\">:\u003C/span> Args\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token operator\">=>\u003C/span> Ret\u003Cspan class=\"token punctuation\">,\u003C/span> \u003Cspan class=\"token function-variable function\">abortCallback\u003C/span>\u003Cspan class=\"token operator\">:\u003C/span> \u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token operator\">=>\u003C/span> \u003Cspan class=\"token keyword\">void\u003C/span>\u003Cspan class=\"token punctuation\">]\u003C/span> \u003Cspan class=\"token operator\">=>\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>리턴하는 콜백 어레이에 \u003Ccode>as const\u003C/code>를 줘서 해결할 수 있습니다.\u003C/p>\n\u003Cpre class=\"language-ts\">\u003Ccode class=\"language-ts code-highlight\">\u003Cspan class=\"code-line line-number\" line=\"1\">  \u003Cspan class=\"token keyword\">return\u003C/span> \u003Cspan class=\"token punctuation\">[\u003C/span>callback\u003Cspan class=\"token punctuation\">,\u003C/span> abort\u003Cspan class=\"token punctuation\">]\u003C/span> \u003Cspan class=\"token keyword\">as\u003C/span> \u003Cspan class=\"token keyword\">const\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>이제 콜백은 자세한 타입을 갖게 되었습니다.  :)\u003C/p>\n\u003Cp>만약 훅에서 \u003Ccode>AbortController\u003C/code>가 마지막 파라미터로 오게 만들고 싶다면\n타입스크립트로 작성하긴 까다롭긴 하나 100% 가능합니다.\u003C/p>\n\u003Cpre class=\"language-ts\">\u003Ccode class=\"language-ts code-highlight\">\u003Cspan class=\"code-line line-number\" line=\"1\">\u003Cspan class=\"token keyword\">type\u003C/span> \u003Cspan class=\"token class-name\">ArgsWithController\u003Cspan class=\"token operator\">&#x3C;\u003C/span>\u003Cspan class=\"token constant\">T\u003C/span> \u003Cspan class=\"token keyword\">extends\u003C/span> \u003Cspan class=\"token builtin\">unknown\u003C/span>\u003Cspan class=\"token punctuation\">[\u003C/span>\u003Cspan class=\"token punctuation\">]\u003C/span>\u003Cspan class=\"token operator\">>\u003C/span>\u003C/span> \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token punctuation\">[\u003C/span>\u003Cspan class=\"token operator\">...\u003C/span>\u003Cspan class=\"token constant\">T\u003C/span>\u003Cspan class=\"token punctuation\">,\u003C/span> AbortController\u003Cspan class=\"token punctuation\">]\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"2\">\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"3\">\u003Cspan class=\"token keyword\">const\u003C/span> useAbortController \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token operator\">&#x3C;\u003C/span>Args \u003Cspan class=\"token keyword\">extends\u003C/span> \u003Cspan class=\"token class-name\">\u003Cspan class=\"token builtin\">unknown\u003C/span>\u003C/span>\u003Cspan class=\"token punctuation\">[\u003C/span>\u003Cspan class=\"token punctuation\">]\u003C/span>\u003Cspan class=\"token punctuation\">,\u003C/span> Ret\u003Cspan class=\"token operator\">>\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"4\">  \u003Cspan class=\"token punctuation\">(\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"5\">    \u003Cspan class=\"token function-variable function\">cb\u003C/span>\u003Cspan class=\"token operator\">:\u003C/span> \u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token operator\">...\u003C/span>args\u003Cspan class=\"token operator\">:\u003C/span> ArgsWithController\u003Cspan class=\"token operator\">&#x3C;\u003C/span>Args\u003Cspan class=\"token operator\">>\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token operator\">=>\u003C/span> Ret\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"6\">  \u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token operator\">:\u003C/span> \u003Cspan class=\"token punctuation\">[\u003C/span>\u003Cspan class=\"token function-variable function\">callback\u003C/span>\u003Cspan class=\"token operator\">:\u003C/span> \u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token operator\">...\u003C/span>args\u003Cspan class=\"token operator\">:\u003C/span> Args\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token operator\">=>\u003C/span> Ret\u003Cspan class=\"token punctuation\">,\u003C/span> \u003Cspan class=\"token function-variable function\">abortCallback\u003C/span>\u003Cspan class=\"token operator\">:\u003C/span> \u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token operator\">=>\u003C/span> \u003Cspan class=\"token keyword\">void\u003C/span>\u003Cspan class=\"token punctuation\">]\u003C/span> \u003Cspan class=\"token operator\">=>\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"7\">  \u003Cspan class=\"token keyword\">const\u003C/span> controllerRef \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token function\">useRef\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token keyword\">new\u003C/span> \u003Cspan class=\"token class-name\">AbortController\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"8\">\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"9\">  \u003Cspan class=\"token keyword\">const\u003C/span> callback \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token function\">useCallback\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token operator\">...\u003C/span>cbArgs\u003Cspan class=\"token operator\">:\u003C/span> Args\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token operator\">=>\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"10\">    \u003Cspan class=\"token keyword\">const\u003C/span> controller \u003Cspan class=\"token operator\">=\u003C/span> controllerRef\u003Cspan class=\"token punctuation\">.\u003C/span>current\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"11\">    \u003Cspan class=\"token keyword\">return\u003C/span> \u003Cspan class=\"token function\">cb\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token operator\">...\u003C/span>cbArgs\u003Cspan class=\"token punctuation\">,\u003C/span> controller\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"12\">  \u003Cspan class=\"token punctuation\">}\u003C/span>\u003Cspan class=\"token punctuation\">,\u003C/span> \u003Cspan class=\"token punctuation\">[\u003C/span>cb\u003Cspan class=\"token punctuation\">]\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"13\">\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"14\">  \u003Cspan class=\"token keyword\">const\u003C/span> abort \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token function\">useCallback\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token operator\">=>\u003C/span> \u003Cspan class=\"token punctuation\">{\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"15\">    controllerRef\u003Cspan class=\"token punctuation\">.\u003C/span>current\u003Cspan class=\"token punctuation\">.\u003C/span>\u003Cspan class=\"token function\">abort\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"16\">    controllerRef\u003Cspan class=\"token punctuation\">.\u003C/span>current \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token keyword\">new\u003C/span> \u003Cspan class=\"token class-name\">AbortController\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"17\">  \u003Cspan class=\"token punctuation\">}\u003C/span>\u003Cspan class=\"token punctuation\">,\u003C/span> \u003Cspan class=\"token punctuation\">[\u003C/span>\u003Cspan class=\"token punctuation\">]\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"18\">\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"19\">  \u003Cspan class=\"token keyword\">return\u003C/span> \u003Cspan class=\"token punctuation\">[\u003C/span>callback\u003Cspan class=\"token punctuation\">,\u003C/span> abort\u003Cspan class=\"token punctuation\">]\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003Cspan class=\"code-line line-number\" line=\"20\">\u003Cspan class=\"token punctuation\">}\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>타입스크립트는 개발자를 돕기 위해 탄생한 언어라는 것을 말씀 드리고 싶습니다.\n만약 같은 로직을 재활용할 일이 없거나, 타입스크립트가 그다지 유용하다고 느끼지 않는다면\n타입스크립트를 사용하지 않아도 괜찮습니다.\n하지만 상세한 타이핑과 함께 한번 작성된 타입스크립트 코드는 여러분을 여러 번 구할 것입니다.\u003C/p>",frontmatter:{toc:true,title:"useAbortController 훅",category:["Programming"],tags:["web","react","javascript","typescript"],author:["이현재"]},date:"2023-10-26",lang:"ko",id:"10-26-ko-useAbortController-hook",tocData:[{depth:1,id:"1-useEffect-내-AbortController",text:"useEffect 내 AbortController"},{depth:1,id:"2-AbortController-커스텀-훅으로-만들기",text:"AbortController 커스텀 훅으로 만들기"},{depth:1,id:"3-더-고도화된-AbortController-커스텀-훅-만들기",text:"더 고도화된 AbortController 커스텀 훅 만들기"},{depth:2,id:"4-콜백과-Abort-함수를-리턴하기",text:"콜백과 Abort 함수를 리턴하기"},{depth:2,id:"5-useRef로-AbortController-관리하기",text:"useRef로 AbortController 관리하기"},{depth:1,id:"6-AbortController를-콜백의-파라미터로-전달하기",text:"AbortController를 콜백의 파라미터로 전달하기"},{depth:2,id:"7-파라미터의-콜백에-다른-인자도-전달하기",text:"파라미터의 콜백에 다른 인자도 전달하기"},{depth:3,id:"8-Typescript로-타이핑-하기",text:"Typescript로 타이핑 하기"}],langs:["ko","en"]},"uses":{"params":["year","slug"]}}];

					Promise.all([
						import("../../../_app/immutable/entry/start.7b02dd09.js"),
						import("../../../_app/immutable/entry/app.beba005d.js")
					]).then(([kit, app]) => {
						kit.start(app, element, {
							node_ids: [0, 5],
							data,
							form: null,
							error: null
						});
					});
				}
			</script>
		</div>
	</body>
</html>
